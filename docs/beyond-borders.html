<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Models for areal spatial structure | Bayesian spatio-temporal methods for small-area estimation of HIV indicators</title>
  <meta name="description" content="4 Models for areal spatial structure | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Models for areal spatial structure | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Models for areal spatial structure | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  
  
  

<meta name="author" content="Adam Howes" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bayes-st.html"/>
<link rel="next" href="multi-agyw.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="templates/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abbreviations"><i class="fa fa-check"></i>Abbreviations</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#notations"><i class="fa fa-check"></i>Notations</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#chapter-overview"><i class="fa fa-check"></i><b>1.1</b> Chapter overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="hiv-aids.html"><a href="hiv-aids.html"><i class="fa fa-check"></i><b>2</b> The HIV/AIDS epidemic</a>
<ul>
<li class="chapter" data-level="2.1" data-path="hiv-aids.html"><a href="hiv-aids.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a></li>
<li class="chapter" data-level="2.2" data-path="hiv-aids.html"><a href="hiv-aids.html#surveillance"><i class="fa fa-check"></i><b>2.2</b> HIV surveillance</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="hiv-aids.html"><a href="hiv-aids.html#hiv-data"><i class="fa fa-check"></i><b>2.2.1</b> Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="hiv-aids.html"><a href="hiv-aids.html#challenges"><i class="fa fa-check"></i><b>2.2.2</b> Challenges</a></li>
<li class="chapter" data-level="2.2.3" data-path="hiv-aids.html"><a href="hiv-aids.html#statistical-approaches"><i class="fa fa-check"></i><b>2.2.3</b> Statistical approaches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayes-st.html"><a href="bayes-st.html"><i class="fa fa-check"></i><b>3</b> Bayesian spatio-temporal statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-statistics"><i class="fa fa-check"></i><b>3.1</b> Bayesian statistics</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-modelling"><i class="fa fa-check"></i><b>3.1.1</b> Bayesian modelling</a></li>
<li class="chapter" data-level="3.1.2" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-computation"><i class="fa fa-check"></i><b>3.1.2</b> Bayesian computation</a></li>
<li class="chapter" data-level="3.1.3" data-path="bayes-st.html"><a href="bayes-st.html#interplay-between-modelling-and-computation"><i class="fa fa-check"></i><b>3.1.3</b> Interplay between modelling and computation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="bayes-st.html"><a href="bayes-st.html#st-statistics"><i class="fa fa-check"></i><b>3.2</b> Spatio-temporal statistics</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bayes-st.html"><a href="bayes-st.html#properties"><i class="fa fa-check"></i><b>3.2.1</b> Properties of spatio-temporal data</a></li>
<li class="chapter" data-level="3.2.2" data-path="bayes-st.html"><a href="bayes-st.html#small-area-estimation"><i class="fa fa-check"></i><b>3.2.2</b> Small-area estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="bayes-st.html"><a href="bayes-st.html#model-structure"><i class="fa fa-check"></i><b>3.3</b> Model structure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="bayes-st.html"><a href="bayes-st.html#linear-model"><i class="fa fa-check"></i><b>3.3.1</b> Linear model</a></li>
<li class="chapter" data-level="3.3.2" data-path="bayes-st.html"><a href="bayes-st.html#generalised-linear-model"><i class="fa fa-check"></i><b>3.3.2</b> Generalised linear model</a></li>
<li class="chapter" data-level="3.3.3" data-path="bayes-st.html"><a href="bayes-st.html#generalised-linear-mixed-effects-model"><i class="fa fa-check"></i><b>3.3.3</b> Generalised linear mixed effects model</a></li>
<li class="chapter" data-level="3.3.4" data-path="bayes-st.html"><a href="bayes-st.html#lgm"><i class="fa fa-check"></i><b>3.3.4</b> Latent Gaussian model</a></li>
<li class="chapter" data-level="3.3.5" data-path="bayes-st.html"><a href="bayes-st.html#elgm"><i class="fa fa-check"></i><b>3.3.5</b> Extended latent Gaussian model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="bayes-st.html"><a href="bayes-st.html#model-comparison"><i class="fa fa-check"></i><b>3.4</b> Model comparison</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="bayes-st.html"><a href="bayes-st.html#information-criteria"><i class="fa fa-check"></i><b>3.4.1</b> Information criteria</a></li>
<li class="chapter" data-level="3.4.2" data-path="bayes-st.html"><a href="bayes-st.html#cross-validation"><i class="fa fa-check"></i><b>3.4.2</b> Cross-validation</a></li>
<li class="chapter" data-level="3.4.3" data-path="bayes-st.html"><a href="bayes-st.html#scoring-rules"><i class="fa fa-check"></i><b>3.4.3</b> Scoring rules</a></li>
<li class="chapter" data-level="3.4.4" data-path="bayes-st.html"><a href="bayes-st.html#bayes-factors"><i class="fa fa-check"></i><b>3.4.4</b> Bayes factors</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="bayes-st.html"><a href="bayes-st.html#survey"><i class="fa fa-check"></i><b>3.5</b> Survey methods</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="bayes-st.html"><a href="bayes-st.html#background-1"><i class="fa fa-check"></i><b>3.5.1</b> Background</a></li>
<li class="chapter" data-level="3.5.2" data-path="bayes-st.html"><a href="bayes-st.html#survey-design"><i class="fa fa-check"></i><b>3.5.2</b> Survey design</a></li>
<li class="chapter" data-level="3.5.3" data-path="bayes-st.html"><a href="bayes-st.html#survey-analysis"><i class="fa fa-check"></i><b>3.5.3</b> Survey analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="beyond-borders.html"><a href="beyond-borders.html"><i class="fa fa-check"></i><b>4</b> Models for areal spatial structure</a>
<ul>
<li class="chapter" data-level="4.1" data-path="beyond-borders.html"><a href="beyond-borders.html#adjacency-models"><i class="fa fa-check"></i><b>4.1</b> Models based on adjacency</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="beyond-borders.html"><a href="beyond-borders.html#besag"><i class="fa fa-check"></i><b>4.1.1</b> The Besag model</a></li>
<li class="chapter" data-level="4.1.2" data-path="beyond-borders.html"><a href="beyond-borders.html#best-practises-for-the-besag-model"><i class="fa fa-check"></i><b>4.1.2</b> Best practises for the Besag model</a></li>
<li class="chapter" data-level="4.1.3" data-path="beyond-borders.html"><a href="beyond-borders.html#concerns"><i class="fa fa-check"></i><b>4.1.3</b> Concerns about the Besag model</a></li>
<li class="chapter" data-level="4.1.4" data-path="beyond-borders.html"><a href="beyond-borders.html#weighted-icar-models"><i class="fa fa-check"></i><b>4.1.4</b> Weighted ICAR models</a></li>
<li class="chapter" data-level="4.1.5" data-path="beyond-borders.html"><a href="beyond-borders.html#bym2"><i class="fa fa-check"></i><b>4.1.5</b> The reparameterised Besag-York-Mollié model</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="beyond-borders.html"><a href="beyond-borders.html#kernel-models"><i class="fa fa-check"></i><b>4.2</b> Models using kernels</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="beyond-borders.html"><a href="beyond-borders.html#centroid-kernel"><i class="fa fa-check"></i><b>4.2.1</b> Centroid kernel</a></li>
<li class="chapter" data-level="4.2.2" data-path="beyond-borders.html"><a href="beyond-borders.html#integrated-kernel"><i class="fa fa-check"></i><b>4.2.2</b> Integrated kernel</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="beyond-borders.html"><a href="beyond-borders.html#simulation-study"><i class="fa fa-check"></i><b>4.3</b> Simulation study</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="beyond-borders.html"><a href="beyond-borders.html#synthetic-data"><i class="fa fa-check"></i><b>4.3.1</b> Synthetic data</a></li>
<li class="chapter" data-level="4.3.2" data-path="beyond-borders.html"><a href="beyond-borders.html#inferential-models"><i class="fa fa-check"></i><b>4.3.2</b> Inferential models</a></li>
<li class="chapter" data-level="4.3.3" data-path="beyond-borders.html"><a href="beyond-borders.html#model-assessment"><i class="fa fa-check"></i><b>4.3.3</b> Model assessment</a></li>
<li class="chapter" data-level="4.3.4" data-path="beyond-borders.html"><a href="beyond-borders.html#results"><i class="fa fa-check"></i><b>4.3.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="beyond-borders.html"><a href="beyond-borders.html#hiv-study"><i class="fa fa-check"></i><b>4.4</b> HIV prevalence study</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="beyond-borders.html"><a href="beyond-borders.html#household-survey-data"><i class="fa fa-check"></i><b>4.4.1</b> Household survey data</a></li>
<li class="chapter" data-level="4.4.2" data-path="beyond-borders.html"><a href="beyond-borders.html#inferential-models-1"><i class="fa fa-check"></i><b>4.4.2</b> Inferential models</a></li>
<li class="chapter" data-level="4.4.3" data-path="beyond-borders.html"><a href="beyond-borders.html#model-comparison-1"><i class="fa fa-check"></i><b>4.4.3</b> Model comparison</a></li>
<li class="chapter" data-level="4.4.4" data-path="beyond-borders.html"><a href="beyond-borders.html#results-1"><i class="fa fa-check"></i><b>4.4.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="beyond-borders.html"><a href="beyond-borders.html#discussion"><i class="fa fa-check"></i><b>4.5</b> Discussion</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="beyond-borders.html"><a href="beyond-borders.html#modelling"><i class="fa fa-check"></i><b>4.5.1</b> Modelling</a></li>
<li class="chapter" data-level="4.5.2" data-path="beyond-borders.html"><a href="beyond-borders.html#model-comparison-2"><i class="fa fa-check"></i><b>4.5.2</b> Model comparison</a></li>
<li class="chapter" data-level="4.5.3" data-path="beyond-borders.html"><a href="beyond-borders.html#inference-1"><i class="fa fa-check"></i><b>4.5.3</b> Inference</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multi-agyw.html"><a href="multi-agyw.html"><i class="fa fa-check"></i><b>5</b> A model for risk group proportions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="multi-agyw.html"><a href="multi-agyw.html#background-2"><i class="fa fa-check"></i><b>5.1</b> Background</a></li>
<li class="chapter" data-level="5.2" data-path="multi-agyw.html"><a href="multi-agyw.html#data"><i class="fa fa-check"></i><b>5.2</b> Data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="multi-agyw.html"><a href="multi-agyw.html#behavioural-data-from-household-surveys"><i class="fa fa-check"></i><b>5.2.1</b> Behavioural data from household surveys</a></li>
<li class="chapter" data-level="5.2.2" data-path="multi-agyw.html"><a href="multi-agyw.html#other-data"><i class="fa fa-check"></i><b>5.2.2</b> Other data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="multi-agyw.html"><a href="multi-agyw.html#risk-group-model"><i class="fa fa-check"></i><b>5.3</b> Model for risk group proportions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="multi-agyw.html"><a href="multi-agyw.html#st-multinomial"><i class="fa fa-check"></i><b>5.3.1</b> Spatio-temporal multinomial logistic regression</a></li>
<li class="chapter" data-level="5.3.2" data-path="multi-agyw.html"><a href="multi-agyw.html#s-logistic"><i class="fa fa-check"></i><b>5.3.2</b> Spatial logistic regression</a></li>
<li class="chapter" data-level="5.3.3" data-path="multi-agyw.html"><a href="multi-agyw.html#female-sex-worker-population-size-adjustment"><i class="fa fa-check"></i><b>5.3.3</b> Female sex worker population size adjustment</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multi-agyw.html"><a href="multi-agyw.html#prevalence-and-incidence-by-risk-group"><i class="fa fa-check"></i><b>5.4</b> Prevalence and incidence by risk group</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="multi-agyw.html"><a href="multi-agyw.html#disaggregation-of-naomi-prevalence-estimates"><i class="fa fa-check"></i><b>5.4.1</b> Disaggregation of Naomi prevalence estimates</a></li>
<li class="chapter" data-level="5.4.2" data-path="multi-agyw.html"><a href="multi-agyw.html#disaggregation-of-naomi-incidence-estimates"><i class="fa fa-check"></i><b>5.4.2</b> Disaggregation of Naomi incidence estimates</a></li>
<li class="chapter" data-level="5.4.3" data-path="multi-agyw.html"><a href="multi-agyw.html#expected-new-infections-reached"><i class="fa fa-check"></i><b>5.4.3</b> Expected new infections reached</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multi-agyw.html"><a href="multi-agyw.html#results-2"><i class="fa fa-check"></i><b>5.5</b> Results</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="multi-agyw.html"><a href="multi-agyw.html#model-for-risk-group-proportions"><i class="fa fa-check"></i><b>5.5.1</b> Model for risk group proportions</a></li>
<li class="chapter" data-level="5.5.2" data-path="multi-agyw.html"><a href="multi-agyw.html#prevalence-and-incidence-by-risk-group-1"><i class="fa fa-check"></i><b>5.5.2</b> Prevalence and incidence by risk group</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="multi-agyw.html"><a href="multi-agyw.html#discussion-1"><i class="fa fa-check"></i><b>5.6</b> Discussion</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="multi-agyw.html"><a href="multi-agyw.html#limitations"><i class="fa fa-check"></i><b>5.6.1</b> Limitations</a></li>
<li class="chapter" data-level="5.6.2" data-path="multi-agyw.html"><a href="multi-agyw.html#conclusion"><i class="fa fa-check"></i><b>5.6.2</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="naomi-aghq.html"><a href="naomi-aghq.html"><i class="fa fa-check"></i><b>6</b> Fast approximate Bayesian inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-inference"><i class="fa fa-check"></i><b>6.1</b> Inference methods and software</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#la"><i class="fa fa-check"></i><b>6.1.1</b> The Laplace approximation</a></li>
<li class="chapter" data-level="6.1.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#quadrature"><i class="fa fa-check"></i><b>6.1.2</b> Quadrature</a></li>
<li class="chapter" data-level="6.1.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#inla"><i class="fa fa-check"></i><b>6.1.3</b> Integrated nested Laplace approximation</a></li>
<li class="chapter" data-level="6.1.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#software"><i class="fa fa-check"></i><b>6.1.4</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#universal"><i class="fa fa-check"></i><b>6.2</b> A universal INLA implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#epil"><i class="fa fa-check"></i><b>6.2.1</b> Epilepsy GLMM</a></li>
<li class="chapter" data-level="6.2.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#loaloa"><i class="fa fa-check"></i><b>6.2.2</b> Loa loa ELGM</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi"><i class="fa fa-check"></i><b>6.3</b> The Naomi model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-model"><i class="fa fa-check"></i><b>6.3.1</b> Model structure</a></li>
<li class="chapter" data-level="6.3.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-elgm"><i class="fa fa-check"></i><b>6.3.2</b> Naomi as an ELGM</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#pca-aghq"><i class="fa fa-check"></i><b>6.4</b> AGHQ in moderate dimensions</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#aghq-with-variable-levels"><i class="fa fa-check"></i><b>6.4.1</b> AGHQ with variable levels</a></li>
<li class="chapter" data-level="6.4.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#principal-components-analysis"><i class="fa fa-check"></i><b>6.4.2</b> Principal components analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="naomi-aghq.html"><a href="naomi-aghq.html#malawi"><i class="fa fa-check"></i><b>6.5</b> Malawi case-study</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-nuts"><i class="fa fa-check"></i><b>6.5.1</b> NUTS convergence and suitability</a></li>
<li class="chapter" data-level="6.5.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#use-of-pca-aghq"><i class="fa fa-check"></i><b>6.5.2</b> Use of PCA-AGHQ</a></li>
<li class="chapter" data-level="6.5.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#inference-comparison"><i class="fa fa-check"></i><b>6.5.3</b> Inference comparison</a></li>
<li class="chapter" data-level="6.5.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#exceedance-probabilities"><i class="fa fa-check"></i><b>6.5.4</b> Exceedance probabilities</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="naomi-aghq.html"><a href="naomi-aghq.html#discussion-2"><i class="fa fa-check"></i><b>6.6</b> Discussion</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#a-universal-inla-implementation"><i class="fa fa-check"></i><b>6.6.1</b> A universal INLA implementation</a></li>
<li class="chapter" data-level="6.6.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#pca-aghq-with-application-to-inla-for-naomi"><i class="fa fa-check"></i><b>6.6.2</b> PCA-AGHQ with application to INLA for Naomi</a></li>
<li class="chapter" data-level="6.6.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#suggestions-for-future-work"><i class="fa fa-check"></i><b>6.6.3</b> Suggestions for future work</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>7</b> Conclusions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="conclusions.html"><a href="conclusions.html#contributions"><i class="fa fa-check"></i><b>7.1</b> Contributions</a></li>
<li class="chapter" data-level="7.2" data-path="conclusions.html"><a href="conclusions.html#limitations-1"><i class="fa fa-check"></i><b>7.2</b> Limitations</a></li>
<li class="chapter" data-level="7.3" data-path="conclusions.html"><a href="conclusions.html#future-work"><i class="fa fa-check"></i><b>7.3</b> Future work</a></li>
<li class="chapter" data-level="7.4" data-path="conclusions.html"><a href="conclusions.html#broader-reflections"><i class="fa fa-check"></i><b>7.4</b> Broader reflections</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html"><i class="fa fa-check"></i><b>A</b> Models for areal spatial structure</a>
<ul>
<li class="chapter" data-level="A.1" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#aghq-nuts"><i class="fa fa-check"></i><b>A.1</b> Comparison of AGHQ to NUTS</a></li>
<li class="chapter" data-level="A.2" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#lengthscale-prior"><i class="fa fa-check"></i><b>A.2</b> Lengthscale prior sensitivity</a></li>
<li class="chapter" data-level="A.3" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#simulation-appendix"><i class="fa fa-check"></i><b>A.3</b> Simulation study</a>
<ul>
<li class="chapter" data-level="A.3.1" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#lengthscale"><i class="fa fa-check"></i><b>A.3.1</b> Lengthscale recovery</a></li>
<li class="chapter" data-level="A.3.2" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#bym2-proportion"><i class="fa fa-check"></i><b>A.3.2</b> BYM2 proportion</a></li>
<li class="chapter" data-level="A.3.3" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#mean-squared-error"><i class="fa fa-check"></i><b>A.3.3</b> Mean squared error</a></li>
<li class="chapter" data-level="A.3.4" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#continuous-ranked-probability-score"><i class="fa fa-check"></i><b>A.3.4</b> Continuous ranked probability score</a></li>
<li class="chapter" data-level="A.3.5" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#calibration"><i class="fa fa-check"></i><b>A.3.5</b> Calibration</a></li>
</ul></li>
<li class="chapter" data-level="A.4" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#hiv-appendix"><i class="fa fa-check"></i><b>A.4</b> HIV study</a>
<ul>
<li class="chapter" data-level="A.4.1" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#lengthscale-1"><i class="fa fa-check"></i><b>A.4.1</b> Lengthscale</a></li>
<li class="chapter" data-level="A.4.2" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#bym2-proportion-1"><i class="fa fa-check"></i><b>A.4.2</b> BYM2 proportion</a></li>
<li class="chapter" data-level="A.4.3" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#estimates-1"><i class="fa fa-check"></i><b>A.4.3</b> Estimates</a></li>
<li class="chapter" data-level="A.4.4" data-path="models-for-areal-spatial-structure.html"><a href="models-for-areal-spatial-structure.html#cross-validation-1"><i class="fa fa-check"></i><b>A.4.4</b> Cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="B" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html"><i class="fa fa-check"></i><b>B</b> A model for risk group proportions</a>
<ul>
<li class="chapter" data-level="B.1" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#the-global-aids-strategy"><i class="fa fa-check"></i><b>B.1</b> The Global AIDS Strategy</a></li>
<li class="chapter" data-level="B.2" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#household-survey-data-1"><i class="fa fa-check"></i><b>B.2</b> Household survey data</a></li>
<li class="chapter" data-level="B.3" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#spatial-analysis-levels"><i class="fa fa-check"></i><b>B.3</b> Spatial analysis levels</a></li>
<li class="chapter" data-level="B.4" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#survey-questions"><i class="fa fa-check"></i><b>B.4</b> Survey questions and risk group allocation</a></li>
<li class="chapter" data-level="B.5" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#additional-figures"><i class="fa fa-check"></i><b>B.5</b> Additional figures</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html"><i class="fa fa-check"></i><b>C</b> Fast approximate Bayesian inference</a>
<ul>
<li class="chapter" data-level="C.1" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#epilepsy-example"><i class="fa fa-check"></i><b>C.1</b> Epilepsy example</a>
<ul>
<li class="chapter" data-level="C.1.1" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#tmb-epil"><i class="fa fa-check"></i><b>C.1.1</b> <code>TMB</code> C++ template</a></li>
<li class="chapter" data-level="C.1.2" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#tmb-modified-epil"><i class="fa fa-check"></i><b>C.1.2</b> Modified <code>TMB</code> C++ template</a></li>
<li class="chapter" data-level="C.1.3" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#stan-epil"><i class="fa fa-check"></i><b>C.1.3</b> <code>Stan</code> C++ template</a></li>
<li class="chapter" data-level="C.1.4" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#nuts-convergence-and-suitability"><i class="fa fa-check"></i><b>C.1.4</b> NUTS convergence and suitability</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#loa-loa-example"><i class="fa fa-check"></i><b>C.2</b> Loa loa example</a>
<ul>
<li class="chapter" data-level="C.2.1" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#nuts-convergence-and-suitability-1"><i class="fa fa-check"></i><b>C.2.1</b> NUTS convergence and suitability</a></li>
<li class="chapter" data-level="C.2.2" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#inference-comparison-1"><i class="fa fa-check"></i><b>C.2.2</b> Inference comparison</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#naomi-math"><i class="fa fa-check"></i><b>C.3</b> Simplified Naomi model description</a>
<ul>
<li class="chapter" data-level="C.3.1" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#naomi-process"><i class="fa fa-check"></i><b>C.3.1</b> Process specification</a></li>
<li class="chapter" data-level="C.3.2" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#naomi-likelihood"><i class="fa fa-check"></i><b>C.3.2</b> Additional likelihood specification</a></li>
<li class="chapter" data-level="C.3.3" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#naomi-identifiability"><i class="fa fa-check"></i><b>C.3.3</b> Identifiability constraints</a></li>
<li class="chapter" data-level="C.3.4" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#naomi-implementation"><i class="fa fa-check"></i><b>C.3.4</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="C.4" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#nuts-convergence-and-suitability-2"><i class="fa fa-check"></i><b>C.4</b> NUTS convergence and suitability</a></li>
<li class="chapter" data-level="C.5" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#use-of-pca-aghq-1"><i class="fa fa-check"></i><b>C.5</b> Use of PCA-AGHQ</a></li>
<li class="chapter" data-level="C.6" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#normalising-constant-estimation"><i class="fa fa-check"></i><b>C.6</b> Normalising constant estimation</a></li>
<li class="chapter" data-level="C.7" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#inference-comparison-2"><i class="fa fa-check"></i><b>C.7</b> Inference comparison</a>
<ul>
<li class="chapter" data-level="C.7.1" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#point-estimates-1"><i class="fa fa-check"></i><b>C.7.1</b> Point estimates</a></li>
<li class="chapter" data-level="C.7.2" data-path="naomi-aghq-appendix.html"><a href="naomi-aghq-appendix.html#distributional-quantities-1"><i class="fa fa-check"></i><b>C.7.2</b> Distributional quantities</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><p>Bayesian spatio-temporal methods for small-area estimation of HIV indicators</p></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="beyond-borders" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Models for areal spatial structure<a href="beyond-borders.html#beyond-borders" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- For PDF output, include these two LaTeX commands after unnumbered chapter headings, otherwise the mini table of contents and the running header will show the previous chapter -->
<p>This chapter is about spatial random effect model specifications for areal data.
A simple model based on the adjacency structure between areas is popular in HIV small-area estimation and beyond.
The analysis aimed to determine if using a more complex model would result in more accurate predictions.</p>
<p>Modelling spatial correlation is particularly important for the small-area estimation of HIV.
This is because the covariates which are most strongly associated with HIV, such as sexual behaviour and STI status <span class="citation">(<a href="#ref-mayala2020predicting">Mayala, Bhatt, and Gething 2020</a>)</span>, are themselves difficult to measure.
As a result, previous small-area models of HIV have found including covariates only modestly improve predictive performance <span class="citation">(Supplementary Figure 20, <a href="#ref-dwyer2019mapping">Dwyer-Lindgren et al. 2019</a>)</span>.
The lack of predictive covariates emphasises the role of modelling spatial variation.
For mapping of other infectious diseases, such as Malaria where transmission is driven by more predictive and easily-measurable environmental factors, explanatory covariates are more easily available and directly modelling spatial correlation is less important <span class="citation">(<a href="#ref-weiss2015re">Weiss et al. 2015</a>; <a href="#ref-bhatt2015effect">Bhatt et al. 2015</a>)</span>.</p>
<p>Spatial variation in areal data is often modelled using spatial random effects <span class="citation">(<a href="#ref-haining2003spatial">Haining 2003</a>; <a href="#ref-cramb2018investigation">Cramb et al. 2018</a>)</span>.
The most common class of models used to specify spatial random effects are Gaussian Markov random fields [GMRFs; <span class="citation">Havard Rue and Held (<a href="#ref-rue2005gaussian">2005</a>)</span>].
These models combine a Gaussian distribution with Markov conditional independence assumptions between areas.
Observations in areas close together are assumed to be related, with more distant relationships not directly accounted for.
Perhaps the simplest GMRF model is that of <span class="citation">Besag, York, and Mollié (<a href="#ref-besag1991bayesian">1991</a>)</span> in which information is borrowed equally from each adjacent area, based on a binary relationship.
The Besag model is attractive as it requires minimal additional modelling choices and is accessibly implemented in software such as <code>R-INLA</code> <span class="citation">(<a href="#ref-blangiardo2013spatial">Blangiardo et al. 2013</a>)</span>, <code>rstan</code> <span class="citation">(<a href="#ref-morris2019bayesian">Morris et al. 2019</a>; <a href="#ref-conegan2022geostan">Donegan 2022</a>)</span>, <code>NIMBLE</code> [Chapter 9; <span class="citation">de Valpine et al. (<a href="#ref-nimblemanual">2023</a>)</span>] and <code>PyMC</code> <span class="citation">(<a href="#ref-saunders2023pymc">Saunders 2023</a>)</span>, among others.
As a result, it has been widely used, including to model bird population dynamics from capture-recapture data <span class="citation">(<a href="#ref-saracco2010modeling">Saracco et al. 2010</a>)</span>; for the analysis of magnetic resonance images <span class="citation">(<a href="#ref-gossl2001bayesian">Gössl, Auer, and Fahrmeir 2001</a>; <a href="#ref-schmid2006bayesian">Schmid et al. 2006</a>)</span>; to map mortality from cancers <span class="citation">(<a href="#ref-rashid2023inequalities">Rashid et al. 2023</a>)</span>, injuries <span class="citation">(<a href="#ref-parks2020anomalously">Parks et al. 2020</a>)</span>, and air pollution <span class="citation">(<a href="#ref-bennett2019particulate">Bennett et al. 2019</a>)</span>; and to model alcohol use patterns <span class="citation">(<a href="#ref-dwyer2015drinking">Dwyer-Lindgren et al. 2015</a>)</span>.</p>
<p>The Besag model was designed for image analysis, on a regular grid.
However, for more irregular geometries, the assumptions made are unrealistic and appear to be violated.
The administrative divisions of a country used in small-area estimation are one example of a more irregular geometry.
This chapter tests the hypothesis that using more realistic assumptions about spatial structure improves the performance of small-area estimation models.
Performance in this context refers to accurate forecasts of parameters as measured by scoring rules.
In doing so, practical recommendations for modelling areal spatial structure are offered.
Code for the analysis in this chapter is available from <a href="https://github.com/athowes/beyond-borders"><code>https://github.com/athowes/beyond-borders</code></a>, and supported by the <code>arealutils</code> R package <span class="citation">(<a href="#ref-howes2023arealutils">Howes 2023</a>)</span>.</p>
<div id="adjacency-models" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Models based on adjacency<a href="beyond-borders.html#adjacency-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section discusses spatial random effect models based on a symmetric adjacency relation <span class="math inline">\(i \sim j\)</span> between areas <span class="math inline">\(A_i\)</span> and <span class="math inline">\(A_j\)</span>.
Adjacency is typically defined by a shared border, though other choices are possible <span class="citation">(<a href="#ref-paciorek2013spatial">Paciorek et al. 2013</a>)</span>.</p>
<div id="besag" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> The Besag model<a href="beyond-borders.html#besag" class="anchor-section" aria-label="Anchor link to header"></a></h3>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:geometry-graph"></span>
<img src="figures/beyond-borders/geometry-graph.png" alt="Panel A shows the districts of Zimbabwe. Panel B shows the corresponding adjacency graph \(\mathcal{G}\) with vertices positioned at the centre of the area they correspond to, and edges between adjacent areas." width="95%" />
<p class="caption">
Figure 4.1: Panel A shows the districts of Zimbabwe. Panel B shows the corresponding adjacency graph <span class="math inline">\(\mathcal{G}\)</span> with vertices positioned at the centre of the area they correspond to, and edges between adjacent areas.
</p>
</div>
<p>The Besag model <span class="citation">(<a href="#ref-besag1991bayesian">Besag, York, and Mollié 1991</a>)</span> is an improper conditional auto-regressive (ICAR) model where the conditional mean of the random effect <span class="math inline">\(u_i\)</span> is the average of its neighbours <span class="math inline">\(\{u_j\}_{j \sim i}\)</span> and the precision is proportional to the number of neighbours.
The full conditional distribution of the <span class="math inline">\(i\)</span>th spatial random effect is given by
<span class="math display" id="eq:besag">\[\begin{equation}
    u_i \, | \, \mathbf{u}_{-i} \sim \mathcal{N} \left(\frac{1}{n_{\delta i}} \sum_{j: j \sim i} u_j, \frac{1}{n_{\delta i}\tau_u}\right), \tag{4.1}
\end{equation}\]</span>
where <span class="math inline">\(\delta i\)</span> is the set of neighbours of <span class="math inline">\(A_i\)</span> with cardinality <span class="math inline">\(n_{\delta i} = |\delta i|\)</span> and <span class="math inline">\(\mathbf{u}_{-i}\)</span> is the vector of spatial random effects with the <span class="math inline">\(i\)</span>th entry removed.
By Brook’s lemma <span class="citation">(<a href="#ref-rue2005gaussian">Havard Rue and Held 2005</a>)</span> the set of full conditionals of the Besag model are equivalent to the Gaussian Markov random field (GMRF) given by
<span class="math display" id="eq:gmrf">\[\begin{equation}
    \mathbf{u} \sim \mathcal{N}(\mathbf{0}, \tau_u^{-1} \mathbf{R}^{-}). \tag{4.2}
\end{equation}\]</span>
The matrix <span class="math inline">\(\mathbf{R}^{-}\)</span> is the generalised inverse of the rank-deficient structure matrix <span class="math inline">\(\mathbf{R}\)</span> with entries
<span class="math display">\[\begin{equation}
    R_{ij} =
    \begin{cases}
        n_{\delta i}, &amp; i = j \\
        -1, &amp; i \sim j \\
        0, &amp; \text{otherwise.}
    \end{cases}
\end{equation}\]</span>
The Markov property arises due to the conditional independence structure <span class="math inline">\(p(u_i \, | \, \mathbf{u}_{-i}) = p(u_i \, | \, \mathbf{u}_{\delta i})\)</span> whereby each area only depends on its neighbours.
This is reflected in the sparsity of <span class="math inline">\(\mathbf{R}\)</span> such that <span class="math inline">\(u_i \perp u_j \, | \, \mathbf{u}_{-ij}\)</span> if and only if <span class="math inline">\(R_{ij} = 0\)</span>.
The structure matrix <span class="math inline">\(\mathbf{R}\)</span> may also be expressed as the Laplacian matrix of the adjacency graph <span class="math inline">\(\mathcal{G} = (\mathcal{V}, \mathcal{E})\)</span> with vertices <span class="math inline">\(v \in \mathcal{V}\)</span> corresponding to each area and edges <span class="math inline">\(e \in \mathcal{E}\)</span> between vertices <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> when <span class="math inline">\(i \sim j\)</span>.
Figure <a href="beyond-borders.html#fig:geometry-graph">4.1</a> shows the districts of Zimbabwe with corresponding adjacency graph.</p>
<p>Rewriting Equation <a href="beyond-borders.html#eq:gmrf">(4.2)</a>, the probability density function of <span class="math inline">\(\mathbf{u}\)</span> is
<span class="math display" id="eq:pdfu">\[\begin{equation}
    p(\mathbf{u})
    \propto \exp \left( -\frac{\tau_u}{2} \mathbf{u}^\top \mathbf{R} \mathbf{u} \right)
    \propto \exp \left( -\frac{\tau_u}{2} \sum_{i \sim j} (u_i - u_j)^2 \right). \tag{4.3}
\end{equation}\]</span>
This density is a function of the pairwise differences <span class="math inline">\(u_i - u_j\)</span> and so is invariant to the addition of a constant <span class="math inline">\(c\)</span> to each entry <span class="math inline">\(p(\mathbf{u}) = p(\mathbf{u} + c\mathbf{1})\)</span>.
As a result, there is an improper uniform distribution on the average of the <span class="math inline">\(u_i\)</span>.
If <span class="math inline">\(\mathcal{G}\)</span> is connected, in that by traversing the edges, any vertex can be reached from any other vertex, then there is only one impropriety in the model and <span class="math inline">\(\text{rank}(\mathbf{R}) = n - 1\)</span>, while if <span class="math inline">\(\mathcal{G}\)</span> is disconnected, and composed of <span class="math inline">\(n_c \geq 2\)</span> connected components with index sets <span class="math inline">\(I_1, \ldots, I_{n_c}\)</span>, then the corresponding structure matrix <span class="math inline">\(\mathbf{R}\)</span> has rank <span class="math inline">\(n - n_c\)</span> and the density is invariant to the addition of a constant to each of the connected components <span class="math inline">\(p(\mathbf{u}_{I}) = p(\mathbf{u}_{I} + c\mathbf{1})\)</span> where <span class="math inline">\(I = I_1, \ldots, I_{n_c}\)</span>.</p>
</div>
<div id="best-practises-for-the-besag-model" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Best practises for the Besag model<a href="beyond-borders.html#best-practises-for-the-besag-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Directly implementing the Besag model as described in Section <a href="beyond-borders.html#besag">4.1.1</a> in recommended against.
<span class="citation">Freni-Sterrantino, Ventrucci, and Rue (<a href="#ref-freni2018note">2018</a>)</span> provide three best practices:</p>
<ol style="list-style-type: decimal">
<li><p>The structure matrix <span class="math inline">\(\mathbf{R}\)</span> should be rescaled to have generalised variance equal to one.
The generalised variance of a matrix is defined by the geometric mean of the diagonal elements of its generalised inverse.
For the structure matrix that is
<span class="math display">\[\begin{equation}
\sigma^2_{\text{GV}}(\mathbf{R}) = \prod_{i = 1}^n (\mathbf{R}^-_{ii})^{1/n} = \exp \left( \frac{1}{n} \sum_{i = 1}^n \log (R^-_{ii}) \right).
\end{equation}\]</span>
The scaled structure matrix <span class="math inline">\(\mathbf{R}^\star\)</span> is given by
<span class="math display">\[\begin{equation}
\mathbf{R}^\star = \mathbf{R} / \sigma^2_{\text{GV}}(\mathbf{R}).
\end{equation}\]</span>
As the diagonal elements <span class="math inline">\(R^-_{ii}\)</span> correspond to marginal variances, the generalised variance gives a measure of the average marginal variance.
This measure, introduced by <span class="citation">Sørbye and Rue (<a href="#ref-sorbye2014scaling">2014</a>)</span>, ignores off-diagonal entries.
More broadly, other measures of typical variance could be used.</p>
<p>Scaling mitigates the influence of the adjacency graph on the variance of <span class="math inline">\(\mathbf{u}\)</span>.
For consistent and interpretable prior distribution selection, it is important to allow the variance to be controlled by <span class="math inline">\(\tau_u\)</span> alone.</p>
<p>When the adjacency graph is disconnected it is not appropriate to scale the structure matrix <span class="math inline">\(\mathbf{R}\)</span> uniformly.
This is because, given the precision <span class="math inline">\(\tau_u\)</span>, local smoothing operates on each connected component independently.
As such, each connected component <span class="math inline">\(I = I_1, \ldots, I_{n_c}\)</span> should be scaled independently to have generalised variance one
<span class="math display">\[\begin{equation}
   \mathbf{R}^\star_I = \mathbf{R}_I / \sigma^2_{\text{GV}}(\mathbf{R}_I)
\end{equation}\]</span>
where <span class="math inline">\(\mathbf{R}_I\)</span> is the sub-matrix of the structure matrix corresponding to index set <span class="math inline">\(I\)</span>.</p></li>
<li><p>When one of the connected components is a single area, known either as a singleton or an island, the probability density
<span class="math display">\[\begin{equation}
  p(u_i) \propto  \exp \left( -\frac{\tau_u}{2} \sum_{i \sim j} (u_i - u_j)^2 \right) \propto 1
\end{equation}\]</span>
has no dependence on <span class="math inline">\(u_i\)</span>.
This is equivalent to using an improper prior.
To avoid this, each singleton should be set to have independent Gaussian noise <span class="math inline">\(p(u_i) \sim \mathcal{N}(0, 1)\)</span>.</p></li>
<li><p>To avoid confounding of the spatial random effects with the intercept, it is recommended to place a sum-to-zero constraint on each non-singleton connected component.
In other words,
<span class="math display">\[\begin{equation}
  \sum_{i \in I} u_i = 0, \quad |I| &gt; 1.
\end{equation}\]</span>
As such, in total the number of sum-to-zero constraints equals to the number of non-singleton connected components.</p></li>
</ol>
</div>
<div id="concerns" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Concerns about the Besag model<a href="beyond-borders.html#concerns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Besag model was originally proposed by <span class="citation">Besag, York, and Mollié (<a href="#ref-besag1991bayesian">1991</a>)</span> for use in image analysis.
In this setting, areas correspond to pixels arranged in a regular lattice structure.
Since then, it has seen wider use.
In some situations, like small-area estimation of HIV, the spatial structure is less regular than a lattice.
This raises concerns about the Besag model’s applicability to this broader setting.
The discussion in this section is closely linked to:</p>
<ul>
<li>the modifiable areal unit problem <span class="citation">(<a href="#ref-openshow1979million">Openshaw and Taylor 1979</a>)</span>, whereby statistical conclusions change as a result of seemingly arbitrary changes in data aggregation;</li>
<li>the challenge of ecological inference and the ecological fallacy <span class="citation">(<a href="#ref-wakefield2010aggregation">Jonathan Wakefield and Lyons 2010</a>)</span>.</li>
</ul>
<div id="compression-to-adjacency" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Compression to adjacency<a href="beyond-borders.html#compression-to-adjacency" class="anchor-section" aria-label="Anchor link to header"></a></h4>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maup1"></span>
<img src="figures/beyond-borders/maup1.png" alt="Though they are quite different, the geometries shown in panels A, B, C, and D each have the same adjacency graph. Therefore, each geometries would have the same distribution under the Besag model." width="95%" />
<p class="caption">
Figure 4.2: Though they are quite different, the geometries shown in panels A, B, C, and D each have the same adjacency graph. Therefore, each geometries would have the same distribution under the Besag model.
</p>
</div>
<p>A fundamental objection is that summarising a geometry by an adjacency graph represents a loss of information.
Many geometries share the same adjacency graph, and as such are isomorphic under the Besag model (Figure <a href="beyond-borders.html#fig:maup1">4.2</a>).
Though not in itself a problem, this fact prompts consideration as to whether the class of geometries with the same adjacency graph is sufficiently similar to merit identical models.</p>
<p>Intuitively, the more regular the spatial structure, the less information is lost in compression to an adjacency graph.
In image analysis, very little spatial information is lost in compression of a lattice structure to an adjacency graph.
On the other hand, the regions of a country, determined by political and geographic forces, tend to display greater irregularity.
The appropriateness of adjacency compression therefore varies by the type of geometry common to the application setting.</p>
<p>The regularity of realistic geometries may help to constrain each class to be similar.
In other words, although pathological geometries can be constructed, they might be implausible in statistical practice and so of limited concern.</p>
</div>
<div id="mean-structure" class="section level4 hasAnchor" number="4.1.3.2">
<h4><span class="header-section-number">4.1.3.2</span> Mean structure<a href="beyond-borders.html#mean-structure" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the Besag model all adjacent areas count equally in the equation for the conditional mean.
This assumption is unsatisfying: for most geometries, we expect different amounts of correlation between neighbouring areas.
Figure <a href="beyond-borders.html#fig:maup1">4.2</a> illustrates a number of heuristic features for neighbour importance.
In Panel <a href="beyond-borders.html#fig:maup1">4.2</a>C, the area with a longer shared border would be expected to be more highly correlated.
In Panel <a href="beyond-borders.html#fig:maup1">4.2</a>D, the area with a closer centre would be expected to be more highly correlated.</p>
</div>
<div id="variance-structure" class="section level4 hasAnchor" number="4.1.3.3">
<h4><span class="header-section-number">4.1.3.3</span> Variance structure<a href="beyond-borders.html#variance-structure" class="anchor-section" aria-label="Anchor link to header"></a></h4>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maup2"></span>
<img src="figures/beyond-borders/maup2.png" alt="A sequence of geometries where the number of neighbours of area one grows by one at each iteration, as the shaded area is split into more areas. In the limit, the precision of the spatial random effect in the first area tends to infinity. This is not reasonable behaviour if the amount of information being shared is not also increasing." width="95%" />
<p class="caption">
Figure 4.3: A sequence of geometries where the number of neighbours of area one grows by one at each iteration, as the shaded area is split into more areas. In the limit, the precision of the spatial random effect in the first area tends to infinity. This is not reasonable behaviour if the amount of information being shared is not also increasing.
</p>
</div>
<p>In Equation <a href="beyond-borders.html#eq:besag">(4.1)</a> the precision of <span class="math inline">\(u_i\)</span> is proportional to its number of neighbours <span class="math inline">\(n_{\delta i}\)</span>.
It follow that as <span class="math inline">\(n_{\delta i} \to \infty\)</span> then <span class="math inline">\(\text{Var}(u_i) \to 0\)</span>.
This is illustrated by Figure <a href="beyond-borders.html#fig:maup2">4.3</a> where the area on the right is repeatedly divided such that its number of neighbours increases.
This property is a consequence of averaging the conditional mean over a greater number of areas, which, in certain situations, can correspond to a greater amount of information.
However, if the amount of information in the shaded area remains fixed, it is inappropriate that <span class="math inline">\(\text{Var}(u_1)\)</span> should tend to zero as a result of drawing additional, arbitrary, boundaries.
In the image analysis setting this modelling assumption is reasonable: each pixel represents a fixed amount of information and a higher pixel density represents a greater amount of information.
On the other hand, in public health and epidemiology, drawing boundaries to create additional areas is not expected to correspond to a greater amount of information.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maup3"></span>
<img src="figures/beyond-borders/maup3.png" alt="Each of the shaded areas in the geometry in Panel A are split into two in Panel B." width="95%" />
<p class="caption">
Figure 4.4: Each of the shaded areas in the geometry in Panel A are split into two in Panel B.
</p>
</div>
<p>As a second example of undesirable behaviour, suppose we fit a Besag model upon identical data using each of the two geometries in Figure <a href="beyond-borders.html#fig:maup3">4.4</a>.
If the spatial variation is relatively smooth, dividing the shaded areas into two will result in a lower estimated variance <span class="math inline">\(\sigma^2_u\)</span> in Panel <a href="beyond-borders.html#fig:maup3">4.4</a>B as compared with Panel <a href="beyond-borders.html#fig:maup3">4.4</a>A because there will appear to be less variation between neighbouring areas.
This problem does not only apply locally: since the effect of <span class="math inline">\(\sigma^2_u\)</span> applies everywhere, the smoothing will change even in unaltered parts of the study region.</p>
</div>
</div>
<div id="weighted-icar-models" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Weighted ICAR models<a href="beyond-borders.html#weighted-icar-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Besag model is a special case of a more general class of (zero-mean) weighted ICAR models.
These models can be specified in terms of scaled weights <span class="math inline">\(\{b_{ij}\}_{j \sim i}\)</span> and a precision vector <span class="math inline">\(\boldsymbol{\mathbf{\kappa}} = (\kappa_i)_{i \in [n]}\)</span>.
The full conditionals are then
<span class="math display" id="eq:weighted-icar-fc">\[\begin{equation}
  u_i \, | \, \mathbf{u}_{-i} \sim \mathcal{N} \left( \sum_{j: j \sim i} b_{ij} u_j, \frac{1}{\kappa_i \tau_u} \right). \tag{4.4}
\end{equation}\]</span>
Setting <span class="math inline">\(b_{ij} = 1 / n_{\delta i}\)</span> and <span class="math inline">\(\kappa_i = n_{\delta i}\)</span> recovers the Besag model in Equation <a href="beyond-borders.html#eq:besag">(4.1)</a>.
The structure matrix <span class="math inline">\(\mathbf{R}\)</span> corresponding to the more general full conditionals in Equation <a href="beyond-borders.html#eq:weighted-icar-fc">(4.4)</a> is
<span class="math display">\[\begin{equation}
  \mathbf{R} = \mathbf{D}_\kappa(\mathbf{I} - \mathbf{B}),
\end{equation}\]</span>
where the unscaled weights matrix <span class="math inline">\(\mathbf{B}\)</span> has elements
<span class="math display">\[\begin{equation}
  \mathbf{B}_{ij} =
  \begin{cases}
  b_{ij}, &amp; \text{for } i \sim j, \\
  0, &amp; \text{for } i = j, i \nsim j.
  \end{cases},
\end{equation}\]</span>
and the matrix <span class="math inline">\(\mathbf{D}_\kappa\)</span> is given by <span class="math inline">\(\text{diag}(\kappa_1, \ldots, \kappa_n)\)</span>.
Ensuring that the structure matrix is symmetric requires that for all <span class="math inline">\(i, j \in [n]\)</span>
<span class="math display">\[\begin{equation}
- b_{ij} \kappa_i = - b_{ji} \kappa_j.
\end{equation}\]</span>
To meet this condition, it can be simpler to directly consider symmetry of the unscaled weights matrix
<span class="math display">\[\begin{equation}
  \mathbf{W} = \mathbf{D}_\kappa \mathbf{B},
\end{equation}\]</span>
such that <span class="math inline">\(\mathbf{R} = \mathbf{D}_\kappa - \mathbf{W}\)</span>.
For the Besag model the unscaled weights matrix <span class="math inline">\(\mathbf{W}\)</span> corresponds to the adjacency matrix.
Scaled weights can be recovered by <span class="math inline">\(b_{ij} = w_{ij} / \kappa_i\)</span> where <span class="math inline">\(\kappa_i = \sum_{k: k \sim i} w_{ik}\)</span>.
<span class="citation">Duncan, White, and Mengersen (<a href="#ref-duncan2017spatial">2017</a>)</span> provide discussion of methods for specifying <span class="math inline">\(\mathbf{W}\)</span>, including
<span class="math display">\[\begin{align}
w_{ij} &amp;= \left( \frac{1}{d_{ij}} \right), \\
w_{ij} &amp;= \exp (-d_{ij}).
\end{align}\]</span>
Weighted ICAR models appear to overcome some of the limitations discussed in Section <a href="beyond-borders.html#concerns">4.1.3</a>.</p>
</div>
<div id="bym2" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> The reparameterised Besag-York-Mollié model<a href="beyond-borders.html#bym2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often, as well as spatial correlation, there exists IID over-dispersion in the residuals and it is inappropriate to use purely spatially structured random effects in the model.
The Besag-York-Mollié (BYM) model of <span class="citation">Besag, York, and Mollié (<a href="#ref-besag1991bayesian">1991</a>)</span> accounts for this in a natural way by decomposing the spatial random effect <span class="math inline">\(\mathbf{u} = \mathbf{v} + \mathbf{w}\)</span> into a sum of an unstructured IID component <span class="math inline">\(\mathbf{v}\)</span> and a spatially structured Besag component <span class="math inline">\(\mathbf{w}\)</span>.
Each component has its own respective precision parameter <span class="math inline">\(\tau_v\)</span> and <span class="math inline">\(\tau_w\)</span>.
The resulting distribution is
<span class="math display" id="eq:bym">\[\begin{equation}
  \mathbf{u} \sim \mathcal{N}(0, \tau_v^{-1} \mathbf{I} + \tau_w^{-1} \mathbf{R}^{-}) \tag{4.5}.
\end{equation}\]</span>
Including both <span class="math inline">\(\mathbf{v}\)</span> and <span class="math inline">\(\mathbf{w}\)</span> is intended to enable the model to learn the relative extent of the unstructured and structured components via <span class="math inline">\(\tau_v\)</span> and <span class="math inline">\(\tau_w\)</span>.</p>
<p>However, in the BYM model, scaling of the Besag precision matrix <span class="math inline">\(\mathbf{Q}\)</span> is not taken into account despite this issue being particularly pertinent when dealing with multiple sources of noise.
In particular, placing a joint prior distribution
<span class="math display">\[\begin{equation}
(\tau_v, \tau_w) \sim p(\tau_v, \tau_w)
\end{equation}\]</span>
which does not privilege either component is more easily accomplished if <span class="math inline">\(\mathbf{Q}\)</span> and <span class="math inline">\(\mathbf{I}\)</span> have the same scale.
Additionally, supposing one has a prior belief that the over-dispersion is primarily IID and <span class="math inline">\(\mathbf{v}\)</span> accounts for the majority of the dispersion, then it is not immediately obvious how to represent this belief, without inadvertently altering the prior distribution on the amount of overall variation.
This highlights identifiability issues of the parameters <span class="math inline">\((\tau_v, \tau_w)\)</span> resulting from them being non-orthogonal.</p>
<p>Building on the models of <span class="citation">Leroux, Lei, and Breslow (<a href="#ref-leroux2000estimation">2000</a>)</span> and <span class="citation">Dean, Ugarte, and Militino (<a href="#ref-dean2001detecting">2001</a>)</span> which tackle this identifiability problem, but do not scale the spatially structured noise, <span class="citation">Simpson et al. (<a href="#ref-simpson2017penalising">2017</a>)</span> propose a reparameterisation <span class="math inline">\((\tau_v, \tau_w) \mapsto (\tau_u, \phi)\)</span> of the BYM model.
This is known as the BYM2 model and given by
<span class="math display" id="eq:bym2">\[\begin{align}
  \mathbf{u} = \frac{1}{\tau_u} \left( \sqrt{1- \phi} \, \mathbf{v} + \sqrt{\phi} \, \mathbf{w}^\star \right), \tag{4.6}
\end{align}\]</span>
where <span class="math inline">\(\tau_u\)</span> is the marginal precision of <span class="math inline">\(\mathbf{u}\)</span>, <span class="math inline">\(\phi \in [0, 1]\)</span> gives the proportion of the marginal variance explained by each component, and <span class="math inline">\(\mathbf{w}^\star\)</span> is a scaled version of <span class="math inline">\(\mathbf{w}\)</span> with precision matrix given by the scaled structure matrix <span class="math inline">\(\mathbf{R}^\star\)</span>.
When <span class="math inline">\(\phi = 0\)</span> the random effects are IID, and when <span class="math inline">\(\phi = 1\)</span> the random effects follow the Besag model.
To borrow an analogy <span class="citation">(<a href="#ref-rue2020comment">Håvard Rue 2020</a>)</span> the parameterisation <span class="math inline">\((\tau_v, \tau_w)\)</span> is like having one hot water and one cold water tap, whereas the parameterisation <span class="math inline">\((\tau_u, \phi)\)</span> is like a mixer tap where the amount of water and its temperature can be adjusted separately.</p>
<p>Although the BYM and BYM2 models were originally proposed using the Besag model as spatially structured component, this need not be the case.
Indeed, more broadly it is reasonable to consider convolution random effects (of a form analogous to that in Equation <a href="beyond-borders.html#eq:bym">(4.5)</a> or <a href="beyond-borders.html#eq:bym2">(4.6)</a>) with any model for spatially structured noise.
Any limitations of the model for spatially structured random effects are inherited by the convolution random effects.</p>
</div>
</div>
<div id="kernel-models" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Models using kernels<a href="beyond-borders.html#kernel-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Section <a href="beyond-borders.html#adjacency-models">4.1</a> reviewed ways to construct spatial random effect precision matrices using an adjacency relation.
An alternate approach is to define the covariance matrix using an areal kernel function which gives a measure of similarity between two areas.
Such a function may be specified as
<span class="math display" id="eq:areal-kernel-function">\[\begin{equation}
K: \mathcal{P}(\mathcal{S}) \times \mathcal{P}(\mathcal{S}) \to \mathbb{R}, \tag{4.7}
\end{equation}\]</span>
where <span class="math inline">\(\mathcal{P}\)</span> denotes the power set such that <span class="math inline">\(\mathcal{P}(\mathcal{S})\)</span> is the space of subsets of the study region.
If the function <span class="math inline">\(K\)</span> is positive semi-definite, then define areal kernel spatial random effects by
<span class="math display" id="eq:areal-kernel-sre">\[\begin{equation}
    \mathbf{u} \sim \mathcal{N} \left( 0, \frac{1}{\tau_u} \mathbf{K} \right), \tag{4.8}
\end{equation}\]</span>
where the <span class="math inline">\(n \times n\)</span> Gram matrix <span class="math inline">\(\mathbf{K}\)</span> with entries <span class="math inline">\(K_{ij} = K(A_i, A_j)\)</span> is a valid covariance matrix.
The precision parameter <span class="math inline">\(\tau_u\)</span> is placed outside of the Gram matrix, analogous to the relation of the precision and structure matrices, but could be omitted.
Areal kernels may be thought of as a type of kernels on sets <span class="citation">(<a href="#ref-gartner2002multi">Gärtner et al. 2002</a>)</span>.</p>
<p>It is challenging to think directly about the correlation structure between areas.
Instead, most well-known spatial process models define the correlation structure between points using a kernel function
<span class="math display" id="eq:kernel-function">\[\begin{equation}
k: \mathcal{S} \times \mathcal{S} \to \mathbb{R}. \tag{4.9}
\end{equation}\]</span>
A simple method, and the one considered here henceforth, is to construct <span class="math inline">\(K\)</span> (Equation <a href="beyond-borders.html#eq:areal-kernel-function">(4.7)</a>) from <span class="math inline">\(k\)</span> (Equation <a href="beyond-borders.html#eq:kernel-function">(4.9)</a>) by averaging the kernel <span class="math inline">\(k\)</span> computed on some number of points representing each area.
In Section <a href="beyond-borders.html#centroid-kernel">4.2.1</a> one point is used, and in Section <a href="beyond-borders.html#integrated-kernel">4.2.2</a> multiple points are used.</p>
<div id="centroid-kernel" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Centroid kernel<a href="beyond-borders.html#centroid-kernel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest approach is to use a single point to represent each area such that
<span class="math display">\[\begin{equation}
  K(A_i, A_j) = k(p_i, p_j).
\end{equation}\]</span>
A natural choice is the centroid <span class="math inline">\(p_i = c_i\)</span>, given by the arithmetic mean of the latitude and longitude.
(Note that it is not guaranteed for the centroid to lie within the area i.e. it is possible <span class="math inline">\(c_i \notin A_i\)</span>, and more generally points representing an area may not be contained by that area.)
This choice results in the centroid kernel
<span class="math display" id="eq:ck">\[\begin{equation}
    K(A_i, A_j) = k(c_i, c_j). \tag{4.10}
\end{equation}\]</span>
The centroid kernel has been used:</p>
<ul>
<li>in environmental epidemiology <span class="citation">(<a href="#ref-wakefield1999spatial">J. Wakefield and Morris 1999</a>)</span>;</li>
<li>for US election modelling <span class="citation">(<a href="#ref-flaxman2015supported">Flaxman, Wang, and Smola 2015</a>)</span>;</li>
<li>to model the reproduction number of COVID-19 <span class="citation">(<a href="#ref-teh2021efficient">Teh et al. 2022</a>)</span>.</li>
</ul>
<p>In a model comparison study <span class="citation">Nicky Best, Richardson, and Thomson (<a href="#ref-best2005comparison">2005</a>)</span> (Section 3) simulated data representing heterogeneous exposure to air pollution, including elevated rates of exposure near two hypothetical point source locations, and found that the centroid kernel tended to over-smooth the high-risk areas.
That said, it unsurprising that a stationary covariance function would struggle to recover non-stationary structure.</p>
</div>
<div id="integrated-kernel" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Integrated kernel<a href="beyond-borders.html#integrated-kernel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Rather than choosing a single representative point, an alternative is to more completely represent the area by integrating the kernel over the areas of interest.
This results in the integrated kernel
<span class="math display" id="eq:ik1">\[\begin{equation}
  K(A_i, A_j) = \frac{1}{|A_i||A_j|} \int_{A_i} \int_{A_j} k(s, s&#39;) \text{d} s \text{d} s&#39;. \tag{4.11}
\end{equation}\]</span>
Unlike for the centroid kernel where <span class="math inline">\(K_{ii} = 1\)</span> for all <span class="math inline">\(i\)</span>, the marginal variance of the <span class="math inline">\(i\)</span>th spatial random effect <span class="math inline">\(K_{ii} = K(A_i, A_i)\)</span> varies depending on the area: becoming smaller for more compact areas and larger for areas which are of greater extent or more spread out.</p>
<p>This covariance structure is equivalent to that obtained by aggregating a spatially continuous Gaussian process with kernel <span class="math inline">\(k\)</span> over the areal partition.
In the machine learning literature, models of this kind have been studied under the name aggregated Gaussian processes <span class="citation">(<a href="#ref-law2018variational">Law et al. 2018</a>; <a href="#ref-tanaka2019spatially">Tanaka et al. 2019</a>; <a href="#ref-yousefi2019multi">Yousefi, Smith, and Alvarez 2019</a>; <a href="#ref-hamelijnck2019multi">Hamelijnck et al. 2019</a>; <a href="#ref-chau2021deconditional">Chau, Bouabid, and Sejdinovic 2021</a>)</span>.
Examples of use of this model in statistical practice are rare.</p>
<div id="accounting-for-heterogeneity" class="section level4 hasAnchor" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Accounting for heterogeneity<a href="beyond-borders.html#accounting-for-heterogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Additional information accounting for heterogeneity over <span class="math inline">\(A_i\)</span> may be incorporated into the integrated kernel.
This can be accomplished using weighting distributions <span class="math inline">\(\{w_i\}\)</span> which represent an unequal contribution of each point to the similarity measure.
The weighted integrated kernel is given by
<span class="math display" id="eq:ik2">\[\begin{equation}
  K(A_i, A_j) = \frac{1}{|A_i||A_j|}\int_{A_i} \int_{A_j} w_i(s) w_j(s&#39;) k(s, s&#39;) \text{d} s \text{d} s&#39;, \tag{4.12}
\end{equation}\]</span>
This areal kernel may be useful in disease mapping.
For example, areas with populations who live close to a shared border are likely to be more strongly correlated than areas whose populations live far apart.
This detail could be accounted for by weighting according to a high resolution measure of population density.
Though e.g. weighted centroids may also be used in Equation <a href="beyond-borders.html#eq:ck">(4.10)</a>, accounting for heterogeneity over an area is more natural within the integrated kernel than the centroid kernel.</p>
</div>
<div id="computation" class="section level4 hasAnchor" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Computation<a href="beyond-borders.html#computation" class="anchor-section" aria-label="Anchor link to header"></a></h4>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:integration-strategy"></span>
<img src="figures/beyond-borders/integration-strategy.png" alt="The \(n = 33\) districts of Malawi. Panel A shows the centroids as in Section 4.2.1. Panel B shows \(L_i = 10\) randomly chosen points, Panel C hexagonal points, and Panel D grid points in each area, each generated using the sf::st_sample function (E. Pebesma 2018)." width="95%" />
<p class="caption">
Figure 4.5: The <span class="math inline">\(n = 33\)</span> districts of Malawi. Panel A shows the centroids as in Section <a href="beyond-borders.html#centroid-kernel">4.2.1</a>. Panel B shows <span class="math inline">\(L_i = 10\)</span> randomly chosen points, Panel C hexagonal points, and Panel D grid points in each area, each generated using the <code>sf::st_sample</code> function <span class="citation">(<a href="#ref-pebesma2018sf">E. Pebesma 2018</a>)</span>.
</p>
</div>
<p>Most of the time it is not possible to calculate Equation <a href="beyond-borders.html#eq:ik2">(4.12)</a> analytically.
<!-- Exceptions include @rasmussen2003bayesian. -->
Instead, consider <span class="math inline">\(n\)</span> collections of <span class="math inline">\(L_i\)</span> samples <span class="math inline">\(\{s^{(i)}_l \}_{l = 1}^{L_i} \sim \mathcal{U}(A_i)\)</span> drawn uniformly from each area.
Then the integral may be approximated using Monte Carlo by the double sum
<span class="math display" id="eq:mcintegratedkernel">\[\begin{equation}
  K(A_i, A_j) \approx \frac{1}{L_i L_j} \sum_{l = 1}^{L_i} \sum_{m = 1}^{L_j}
  w_i \left( s^{(i)}_l \right) w_j \left( s^{(j)}_m \right)
  k \left( s^{(i)}_l, s^{(j)}_m \right). \tag{4.13}
\end{equation}\]</span>
Equivalently, samples drawn from <span class="math inline">\(W_i\)</span> may be used without weighting by <span class="math inline">\(w_i(s)\)</span>.
Nodes may also be selected deterministically to give a numerical quadrature estimate of the kernel.
Figure <a href="beyond-borders.html#fig:integration-strategy">4.5</a> shows three possible ways of choosing points <span class="math inline">\(s^{(i)}_l\)</span>, together with the centroids approach.</p>
<p>Computing the <span class="math inline">\(n \times n\)</span> Gram matrix <span class="math inline">\(K\)</span> requires
<span class="math display">\[\begin{equation}
\mathcal{O}(\sum_{i = 1}^n \sum_{j = 1}^n L_i L_j)
\end{equation}\]</span>
evaluations of the kernel <span class="math inline">\(k\)</span>.
This imposes a significant computational cost if the Gram matrix is often recomputed during inference.
For example, during MCMC when the kernel has hyperparameters which are learnt then the Gram matrix is recomputed for each proposed set of hyperparameters.
As such, there is a limit on the size of <span class="math inline">\(L_i\)</span> which it is feasible to use.
<span class="citation">Kelsall and Wakefield (<a href="#ref-kelsall2002modeling">2002</a>)</span> encounter this challenge, and take the approach of using a discrete hyperparameter prior to reduce the number of Gram matrix constructions and inversions required.</p>
</div>
<div id="connection-to-log-gaussian-cox-processes" class="section level4 hasAnchor" number="4.2.2.3">
<h4><span class="header-section-number">4.2.2.3</span> Connection to log-Gaussian Cox processes<a href="beyond-borders.html#connection-to-log-gaussian-cox-processes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The log-Gaussian Cox Process framework <span class="citation">(<a href="#ref-diggle2013spatial">Diggle et al. 2013</a>)</span> arrives naturally at the integrated kernel formulation.
A Cox process is an inhomogeneous Poisson process with a continuous stochastic intensity function <span class="math inline">\(\{ x(s), s \in \mathcal{S} \}\)</span> such that conditional on the realisation of <span class="math inline">\(x(s)\)</span> the number of points in any area <span class="math inline">\(A_i\)</span> follows a Poisson distribution.
The rate parameter of this Poisson distribution is explicitly aggregated as follows
<span class="math display">\[\begin{equation}
  y_i \, | \, x(s) \sim \text{Poisson} \left(\int_{s \in A_i} x(s) \text{d}s \right).
\end{equation}\]</span>
In a LGCP the log intensity <span class="math inline">\(\log x(s) = \eta(s)\)</span> is modelled using a Gaussian process prior <span class="math inline">\(\eta(s) \sim \mathcal{GP}(\mu(s), k(s, s&#39;))\)</span>.
<span class="citation">O. Johnson, Diggle, and Giorgi (<a href="#ref-johnson2019spatially">2019</a>)</span> obtain Equation <a href="beyond-borders.html#eq:ik2">(4.12)</a> by considering a discrete Poisson log-linear mixed model approximation to a continuous LGCP, whereby <span class="math inline">\(\eta(s)\)</span> is approximated by a piecewise constant <span class="math inline">\(\eta_i = \mu_i + u_i\)</span> in each area <span class="math inline">\(A_i\)</span>.
The <span class="math inline">\(i\)</span>th discrete spatial random effect is then <span class="math inline">\(u_i = \int_{A_i} w_i(s) u(s) \text{d}s\)</span>,
with covariance structure
<span class="math display">\[\begin{equation}
  \text{Cov} \left( \int_{A_i} w_i(s) u(s) \text{d}s, \int_{A_j} w_j(s&#39;) u(s&#39;) \text{d}s&#39; \right)
  = \int_{A_i} \int_{A_j} w_i(s) w_j(s&#39;) k(s, s&#39;) \text{d}s\text{d}s&#39;,
\end{equation}\]</span>
corresponding to an areal integrated kernel with a logarithmic link function and Poisson likelihood.</p>
</div>
<div id="connection-to-disaggregation-regression" class="section level4 hasAnchor" number="4.2.2.4">
<h4><span class="header-section-number">4.2.2.4</span> Connection to disaggregation regression<a href="beyond-borders.html#connection-to-disaggregation-regression" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Disaggregation regression, also known as downscaling or interpolation, is another closely related approach.
Rather than focusing on the aggregate nature of areal observations as a route towards better area-level estimates, disaggregation regression aims to produce high-resolution or point-level estimates from areal observations <span class="citation">(<a href="#ref-utazi2019spatial">Utazi et al. 2019</a>; <a href="#ref-arambepola2022simulation">Arambepola et al. 2022</a>; <a href="#ref-nandi2023disaggregation">Nandi et al. 2023</a>)</span>
These two tasks are similar, and indeed it could be argued that accurate point-level estimates are a necessary intermediate step towards accurate area-level estimates.
However, disaggregation regression is challenging without auxiliary covariate information, and therefore unlikely to be applicable to small-area estimation of HIV.</p>
</div>
</div>
</div>
<div id="simulation-study" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Simulation study<a href="beyond-borders.html#simulation-study" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This simulation study tests the ability of inferential models with varying spatial random effect specifications to accurately recover small-area quantities.
The data and modelling choices were designed with a spatial epidemiology application in mind.</p>
<div id="synthetic-data" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Synthetic data<a href="beyond-borders.html#synthetic-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<caption><span id="tab:simulation-models">Table 4.1: </span> The three spatial random effect models used to generate synthetic data in the simulation study (Section <a href="beyond-borders.html#simulation-study">4.3</a>).</caption>
<colgroup>
<col width="31%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>IID</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \mathbf{I}_n)\)</span></td>
</tr>
<tr class="even">
<td>Besag</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, {\mathbf{R}^\star}^{-})\)</span> as in Section <a href="beyond-borders.html#besag">4.1.1</a></td>
</tr>
<tr class="odd">
<td>Integrated kernel (IK)</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \mathbf{K}^\star)\)</span> as in Section <a href="beyond-borders.html#integrated-kernel">4.2.2</a> with Matérn kernel, <span class="math inline">\(\nu = 3/2, l = 2.5\)</span> and <span class="math inline">\(L_i = 100\)</span> points per area</td>
</tr>
</tbody>
</table>
<p>Data <span class="math inline">\(\mathbf{y} = (y_i)_{i \in [n]}\)</span> were simulated from a binomial likelihood <span class="math inline">\(y_i \sim \text{Bin}(m_i, \rho_i)\)</span>.
The probabilities <span class="math inline">\(\rho_i \in [0, 1]\)</span> were linked to linear predictors <span class="math inline">\(\eta_i \in \mathbb{R}\)</span> via
<span class="math display">\[\begin{equation}
\log \left( \frac{\rho_i}{1 - \rho_i} \right) = \eta_i = \beta_0 + u_i, \quad i \in [n].
\end{equation}\]</span>
Spatial random effects were generated according to three different models (Table <a href="beyond-borders.html#tab:simulation-models">4.1</a>).
Sample sizes were fixed as <span class="math inline">\(m_i = 25\)</span> for all <span class="math inline">\(i \in [n]\)</span>, the intercept parameter as <span class="math inline">\(\beta_0 = -2\)</span> and the spatial random effect precision parameter as <span class="math inline">\(\tau_u = 1\)</span>.</p>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:geometries"></span>
<img src="figures/beyond-borders/geometries.png" alt="Seven geometries were considered in the simulation study. These were the four geometries from Figure 4.2 shown in Panel A, B, C and D, and three more realistic geometries shown in Panel E, F and G." width="95%" />
<p class="caption">
Figure 4.6: Seven geometries were considered in the simulation study. These were the four geometries from Figure <a href="beyond-borders.html#fig:maup1">4.2</a> shown in Panel A, B, C and D, and three more realistic geometries shown in Panel E, F and G.
</p>
</div>
<p>Seven geometries were considered (Figure <a href="beyond-borders.html#fig:geometries">4.6</a>).
These included the four vignette geometries from Figure <a href="beyond-borders.html#fig:maup1">4.2</a> which share an adjacency graph.
Three more realistic geometries were included to represent plausible variation over spatial regularity for the small-area estimation setting.
From the most to the least spatially regular, these geometries were:</p>
<ul>
<li>a <span class="math inline">\(6 \times 6\)</span> lattice grid;</li>
<li>the 33 districts of Côte d’Ivoire;</li>
<li>the 36 congressional districts of Texas.</li>
</ul>
<p>For each of the three spatial random effect models and seven geometries 250 synthetic data were generated, resulting in a total of 5250 synthetic data.</p>
</div>
<div id="inferential-models" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Inferential models<a href="beyond-borders.html#inferential-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<caption><span id="tab:inferential-models">Table 4.2: </span> The spatial random effect models used for inference. Each model is implemented in the <code>arealutils</code> package. The BYM2 model was implemented using the sparsity preserving parameterisation described in Section 3.2 of <span class="citation">Riebler et al. (<a href="#ref-riebler2016intuitive">2016</a>)</span>.</caption>
<colgroup>
<col width="31%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Constant</td>
<td>Without spatial random effects <span class="math inline">\(\mathbf{u} = \mathbf{0}\)</span></td>
</tr>
<tr class="even">
<td>IID</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} \mathbf{I}_n)\)</span></td>
</tr>
<tr class="odd">
<td>Besag</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} {\mathbf{R}^\star}^{-})\)</span> as in Section <a href="beyond-borders.html#besag">4.1.1</a></td>
</tr>
<tr class="even">
<td>BYM2</td>
<td><span class="math inline">\(\mathbf{u} = \tau_u^{-1} ( \sqrt{1 - \pi} \, \mathbf{v} + \sqrt{\pi} \, \mathbf{w}^\star)\)</span> as in Section <a href="beyond-borders.html#bym2">4.1.5</a> with <span class="math inline">\(\pi \sim \text{Beta}(0.5, 0.5)\)</span></td>
</tr>
<tr class="odd">
<td>FCK</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} \mathbf{K})\)</span> with <span class="math inline">\(K_{ij} = k(c_i, c_j)\)</span> as in Section <a href="beyond-borders.html#centroid-kernel">4.2.1</a> with fixed length-scale <span class="math inline">\(l\)</span></td>
</tr>
<tr class="even">
<td>CK</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} \mathbf{K})\)</span> with <span class="math inline">\(K_{ij} = k(c_i, c_j)\)</span> as in Section <a href="beyond-borders.html#centroid-kernel">4.2.1</a> with length-scale prior distribution <span class="math inline">\(l \sim \mathrm{Inv{\text-}Gamma}(a, b)\)</span> with <span class="math inline">\(a, b\)</span> set based on the geometry</td>
</tr>
<tr class="odd">
<td>FIK</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} \mathbf{K})\)</span> with <span class="math inline">\(K_{ij} = K(A_i, A_j)\)</span> as in Section <a href="beyond-borders.html#integrated-kernel">4.2.2</a> with hexagonal points (Panel <a href="beyond-borders.html#fig:integration-strategy">4.5</a>C), <span class="math inline">\(L_i = 10\)</span>, and fixed length-scale <span class="math inline">\(l\)</span></td>
</tr>
<tr class="even">
<td>IK</td>
<td><span class="math inline">\(\mathbf{u} \sim \mathcal{N}(0, \tau_u^{-1} \mathbf{K})\)</span> with <span class="math inline">\(K_{ij} = K(A_i, A_j)\)</span> as in Section <a href="beyond-borders.html#integrated-kernel">4.2.2</a> with hexagonal points (Panel <a href="beyond-borders.html#fig:integration-strategy">4.5</a>C), <span class="math inline">\(L_i = 10\)</span>, and length-scale prior distribution <span class="math inline">\(l \sim \mathrm{Inv{\text-}Gamma}(a, b)\)</span> with <span class="math inline">\(a, b\)</span> set based on the geometry</td>
</tr>
</tbody>
</table>
<p>Eight inferential models were fit to the synthetic data (Table <a href="beyond-borders.html#tab:inferential-models">4.2</a>).
Apart from the spatial random effect specification, each inferential model corresponded exactly to the simulation model.</p>
<div id="kernels" class="section level4 hasAnchor" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Kernels<a href="beyond-borders.html#kernels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Gram matrices were computed using the Matérn kernel <span class="math inline">\(k: \mathcal{S} \times \mathcal{S} \to \mathbb{R}\)</span> <span class="citation">(<a href="#ref-stein1999interpolation">Stein 1999</a>)</span> given by
<span class="math display" id="eq:matern">\[\begin{equation}
k(s, s&#39;) =
\frac{1}{2^{\nu - 1}\Gamma(\nu)} \left(\frac{\sqrt{2\nu}\lvert s - s&#39; \rvert}{l}\right)^\nu
B_\nu\left(\frac{\sqrt{2\nu}\lvert s - s&#39; \rvert}{l}\right). \tag{4.14}
\end{equation}\]</span>
In Equation <a href="beyond-borders.html#eq:matern">(4.14)</a>:</p>
<ul>
<li><span class="math inline">\(B_\nu\)</span> is the modified Bessel function of the second kind;</li>
<li><span class="math inline">\(|s - s&#39;|\)</span> is the Euclidean distance between the point locations <span class="math inline">\(s\)</span> and <span class="math inline">\(s&#39;\)</span>;</li>
<li><span class="math inline">\(\nu\)</span> is the smoothness hyperparameter;</li>
<li><span class="math inline">\(l\)</span> is the length-scale hyperparameter on the latitude-longitude scale.</li>
</ul>
<p>The smoothness parameter <span class="math inline">\(\nu\)</span> is difficult to identify from data and so was fixed at <span class="math inline">\(3/2\)</span>.
This value matches that used to simulate data, and simplifies Equation <a href="beyond-borders.html#eq:matern">(4.14)</a> as follows
<span class="math display">\[\begin{equation}
k(s, s&#39;) = \left(1 + \frac{\sqrt{3} \lvert s - s&#39; \rvert}{l} \right) \exp \left(- \frac{\sqrt{3} \lvert s - s&#39; \rvert}{l} \right).
\end{equation}\]</span></p>
<p>The number of points per area <span class="math inline">\(L_i\)</span> was set to 10 with a hexagonal spacing structure (Panel <a href="beyond-borders.html#fig:integration-strategy">4.5</a>C).
The actual values of <span class="math inline">\(L_i\)</span> sometimes differed from 10 because <code>sf::st_sample</code> with <code>type = "hexagonal"</code> does not guarantee exactly the specified number of samples are returned <span class="citation">(<a href="#ref-pebesma2018sf">E. Pebesma 2018</a>)</span>.</p>
</div>
<div id="priors" class="section level4 hasAnchor" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> Priors<a href="beyond-borders.html#priors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A weakly informative half-Gaussian prior was placed on the standard deviation such that <span class="math inline">\(\sigma_u \sim \mathcal{N}_+(0, 2.5^2)\)</span> <span class="citation">(<a href="#ref-gelman2006prior">Gelman 2006</a>)</span>.
The value 2.5 avoids placing significant prior density on the region <span class="math inline">\(\sigma_u &gt; 5\)</span>, which after logistic transformation would facilitate undesirable variation on the probability scale very close to zero or one.
A weakly informative <span class="math inline">\(\mathcal{N}(-2, 1)\)</span> prior was placed on <span class="math inline">\(\beta_0\)</span>, setting most of the prior probability density for <span class="math inline">\(\text{logit}^{-1}(\beta_0)\)</span> within a range typical for a disease prevalence.</p>
<p>In cases where the length-scale <span class="math inline">\(l\)</span> was fixed, it was set based on the geometry such that points an average distance apart had 1% correlation <span class="citation">(<a href="#ref-best1999bayesian">N. Best et al. 1999</a>)</span>.
In cases where a prior distribution was set on the length-scale it was <span class="math inline">\(l \sim \mathrm{Inv{\text-}Gamma}(a, b)\)</span>, with <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> chosen for each geometry such that 5% of the prior mass was below the 5% quantile for distance between points and 5% of the prior mass was above the 95% quantile <span class="citation">(<a href="#ref-betancourt2017robust">Betancourt 2017</a>)</span>.
The sensitivity analysis in Appendix <a href="models-for-areal-spatial-structure.html#lengthscale-prior">A.2</a> illustrates the extent to which six possible lengthscale prior distributions (Figure <a href="models-for-areal-spatial-structure.html#fig:lengthscale-prior">A.9</a>) effect the lengthscale posterior distribution (Figure <a href="models-for-areal-spatial-structure.html#fig:lengthscale-posterior">A.10</a>).</p>
</div>
<div id="inference" class="section level4 hasAnchor" number="4.3.2.3">
<h4><span class="header-section-number">4.3.2.3</span> Inference<a href="beyond-borders.html#inference" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Approximate Bayesian inference was conducted using adaptive Gauss-Hermite quadrature [AGHQ; <span class="citation">Stringer, Brown, and Stafford (<a href="#ref-stringer2022fast">2022</a>)</span>] with <span class="math inline">\(k = 3\)</span> quadrature points over a marginal Laplace approximation via the <code>aghq</code> package <span class="citation">(<a href="#ref-stringer2021implementing">Stringer 2021</a>)</span>.
Models were implemented using a Template Model Builder C++ template for the log-posterior via the <code>TMB</code> package <span class="citation">(<a href="#ref-kristensen2016tmb">Kristensen et al. 2016</a>)</span>.
Appendix <a href="models-for-areal-spatial-structure.html#aghq-nuts">A.1</a> compares posterior mean and standard deviations from AGHQ to those obtained using the No-U-Turn Sampling (NUTS) Hamiltonian Monte Carlo (HMC) algorithm run using <code>Stan</code> <span class="citation">(<a href="#ref-carpenter2017stan">Carpenter et al. 2017</a>)</span> via the <code>tmbstan</code> package <span class="citation">(<a href="#ref-monnahan2018no">Monnahan and Kristensen 2018</a>)</span>.</p>
</div>
</div>
<div id="model-assessment" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Model assessment<a href="beyond-borders.html#model-assessment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let the parameter <span class="math inline">\(\phi\)</span> have posterior marginal <span class="math inline">\(f(\phi) = p(\phi \, | \, \mathbf{y})\)</span> with cumulative distribution function <span class="math inline">\(F\)</span>.
Let <span class="math inline">\(\phi_s\)</span> be samples <span class="math inline">\(s \in [S]\)</span> from <span class="math inline">\(f\)</span>.
Here, the number of samples per posterior marginal was <span class="math inline">\(S = 200\)</span>.
Let <span class="math inline">\(\omega\)</span> be the true value of <span class="math inline">\(\phi\)</span> used in the simulation.</p>
<p>The accuracy of latent field parameter and hyperparameter posterior marginals from each model were assessed using three methods.
These were the mean squared error (MSE), the continuous ranked probability score [CRPS; <span class="citation">Matheson and Winkler (<a href="#ref-matheson1976scoring">1976</a>)</span>], and the calibration.</p>
<p>The MSE is a simple and popular measure given by
<span class="math display">\[\begin{equation}
\text{MSE}(f, \omega) \approx \frac{1}{S} \sum_{s = 1}^S (\phi_s - \omega)^2.
\end{equation}\]</span></p>
<p>The CRPS is a strictly proper scoring rule (SPSR) which has favourable properties and is regarded as a default choice <span class="citation">(<a href="#ref-gneiting2007strictly">Gneiting and Raftery 2007</a>)</span>.
Any scoring rule which is not strictly proper rewards a misrepresentation of beliefs.
The CRPS is
<span class="math display" id="eq:crps">\[\begin{equation}
\text{CRPS}(f, \omega) = \int_{-\infty}^{\infty} (F(\phi) - \mathbb{I} \{\phi \geq \omega \} )^2 \text{d}\phi. \tag{4.15}
\end{equation}\]</span>
The CRPS may be estimated using samples by
<span class="math display" id="eq:crps-approx">\[\begin{equation}
\text{CRPS}(f, \omega) \approx \frac{1}{S} \sum_{s = 1}^S | \phi_s - \omega | - \frac{1}{2S^2} \sum_{s = 1}^S \sum_{l = 1}^S | \phi_s - \phi_l |. \tag{4.16}
\end{equation}\]</span></p>
<p>A posterior marginal is calibrated if over repeated simulations the quantile of the true value is uniformly distributed such that
<span class="math display" id="eq:unif">\[\begin{equation}
F(\omega) \approx \frac{1}{S} \sum_{s = 1}^S \mathbb{I} \{\phi_i \geq \omega \} = q \sim \mathcal{U}[0, 1]. \tag{4.17}
\end{equation}\]</span>
If Equation <a href="beyond-borders.html#eq:unif">(4.17)</a> holds then at any given nominal coverage <span class="math inline">\(1 - \alpha\)</span> the proportion of quantile-based credible intervals containing <span class="math inline">\(\omega\)</span> is also <span class="math inline">\(1 - \alpha\)</span>.
Uniformity was assessed using probability integral transform (PIT) histograms <span class="citation">(<a href="#ref-dawid1984present">Dawid 1984</a>)</span> and empirical cumulative distribution function (ECDF) difference plots <span class="citation">(<a href="#ref-aldor2013power">Aldor-Noiman et al. 2013</a>)</span> with simultaneous confidence bands as described in <span class="citation">Säilynoja, Bürkner, and Vehtari (<a href="#ref-sailynoja2022graphical">2022</a>)</span>.</p>
</div>
<div id="results" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Results<a href="beyond-borders.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="vignette-geometries" class="section level4 hasAnchor" number="4.3.4.1">
<h4><span class="header-section-number">4.3.4.1</span> Vignette geometries<a href="beyond-borders.html#vignette-geometries" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As each geometry only had three areas, the sample size of 250 synthetic data was insufficient to distinguish between inferential models for the vignette geometries.
Figures <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-1">A.13</a>, <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-2">A.14</a>, <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-3">A.15</a> and <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-4">A.16</a> show that almost all 95% credible intervals for the mean CRPS overlap.
Additionally for the vignette geometries, both the heuristic method for fixing a lengthscale, and lengthscale prior distribution, were misspecified.
Three points was insufficient to learn the lengthscale, and as such misspecification of the prior distribution propagated to the posterior distribution (Figure <a href="models-for-areal-spatial-structure.html#fig:lengthscale-recovery">A.11</a>).
Hence, to produce higher resolution and more meaningful results, the simulation study for the vignette geometries should be rerun.
Two changes should be made.
First, an increase to the sample size.
Second, more careful specification of study with regard to the lengthscale.</p>
</div>
<div id="realistic-geometries" class="section level4 hasAnchor" number="4.3.4.2">
<h4><span class="header-section-number">4.3.4.2</span> Realistic geometries<a href="beyond-borders.html#realistic-geometries" class="anchor-section" aria-label="Anchor link to header"></a></h4>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crps-mean-se-grid"></span>
<img src="resources/beyond-borders/20231229-092307-f1156802/depends/crps-mean-se-grid.png" alt="The mean CRPS and its standard error for each inferential model and simulation model on the grid geometry (Panel 4.6E)." width="95%" />
<p class="caption">
Figure 4.7: The mean CRPS and its standard error for each inferential model and simulation model on the grid geometry (Panel <a href="beyond-borders.html#fig:geometries">4.6</a>E).
</p>
</div>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crps-mean-se-civ"></span>
<img src="resources/beyond-borders/20231229-092307-f1156802/depends/crps-mean-se-civ.png" alt="The mean CRPS and its standard error for each inferential model and simulation model on the Côte d’Ivoire geometry (Panel 4.6F)." width="95%" />
<p class="caption">
Figure 4.8: The mean CRPS and its standard error for each inferential model and simulation model on the Côte d’Ivoire geometry (Panel <a href="beyond-borders.html#fig:geometries">4.6</a>F).
</p>
</div>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crps-mean-se-tex"></span>
<img src="resources/beyond-borders/20231229-092307-f1156802/depends/crps-mean-se-tex.png" alt="The mean CRPS and its standard error for each inferential model and simulation model on the Texas geometry (Panel 4.6G)." width="95%" />
<p class="caption">
Figure 4.9: The mean CRPS and its standard error for each inferential model and simulation model on the Texas geometry (Panel <a href="beyond-borders.html#fig:geometries">4.6</a>G).
</p>
</div>
<p>The two problems with the vignette geometry study did not apply to the more realistic geometries.
Figures <a href="beyond-borders.html#fig:crps-mean-se-grid">4.7</a>, <a href="beyond-borders.html#fig:crps-mean-se-civ">4.8</a> and <a href="beyond-borders.html#fig:crps-mean-se-tex">4.9</a> show mean CRPS values with 95% credible intervals that often do not overlap.</p>
<p>The difficulty of the forecasting problem varied by spatial random effect model used to simulate synthetic data (Table <a href="beyond-borders.html#tab:simulation-models">4.1</a>).
IID structure is harder to predict than spatial structure.
To a lesser extent, Besag structure is harder to predict than IK.
This is explained by forecasting being made easier by additional correlation structure.</p>
<p>For IID synthetic data, the IID and BYM2 models performed well.
The BYM2 model also performed almost as well as the Besag model on the spatially structured synthetic data (Besag or IK).
Meanwhile, the IID model performed poorly on spatially structured synthetic data.
Appendix <a href="models-for-areal-spatial-structure.html#bym2-proportion">A.3.2</a> shows that the BYM2 proportion parameter successfully recovers either IID or spatial structure.</p>
<p>The performance of kernel models on Besag synthetic data diminished with increasingly spatially irregular geometry.</p>
<p>For the most part, differences between the centroid and integrated versions of the kernel models were small.</p>
</div>
</div>
</div>
<div id="hiv-study" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> HIV prevalence study<a href="beyond-borders.html#hiv-study" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simulation studies are a valuable tool for experimenting on models in controlled environments.
However, it is difficult to capture the complexity of a realistic applied scenario using simulation.
Therefore, it is important to complement simulation studies with studies conducted on real data.
To this end, model performance was compared in estimating district-level HIV prevalence <span class="math inline">\(\rho_i \in [0, 1]\)</span> in adults aged 15-49.
Household survey data was used from across four countries in sub-Saharan Africa (Table <a href="beyond-borders.html#tab:hiv-surveys">4.3</a>, Figure <a href="beyond-borders.html#fig:hiv-surveys">4.10</a>).</p>
<table>
<caption><span id="tab:hiv-surveys">Table 4.3: </span> The four PHIA household surveys included in the HIV prevalence study (Section <a href="beyond-borders.html#hiv-study">4.4</a>).</caption>
<colgroup>
<col width="26%" />
<col width="16%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<thead>
<tr class="header">
<th>Country</th>
<th>Survey</th>
<th>Number of areas</th>
<th>Analysis level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Côte d’Ivoire</td>
<td>PHIA 2017</td>
<td>33</td>
<td>Regions</td>
</tr>
<tr class="even">
<td>Malawi</td>
<td>PHIA 2016</td>
<td>31</td>
<td>Health districts and cities, with islands removed</td>
</tr>
<tr class="odd">
<td>Tanzania</td>
<td>PHIA 2017</td>
<td>26</td>
<td>Regions, with islands removed</td>
</tr>
<tr class="even">
<td>Zimbabwe</td>
<td>PHIA 2016</td>
<td>60</td>
<td>Districts</td>
</tr>
</tbody>
</table>
<div id="household-survey-data" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Household survey data<a href="beyond-borders.html#household-survey-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hiv-surveys"></span>
<img src="resources/beyond-borders/20231229-092307-f1156802/depends/hiv-surveys.png" alt="Adult (15-49) HIV prevalence from the most recent PHIA survey conducted in Côte d’Ivoire (Panel A), Malawi (Panel B), Tanzania (Panel C), and Zimbabwe (Panel D). These estimates survey weighted according to Equation (4.18)." width="95%" />
<p class="caption">
Figure 4.10: Adult (15-49) HIV prevalence from the most recent PHIA survey conducted in Côte d’Ivoire (Panel A), Malawi (Panel B), Tanzania (Panel C), and Zimbabwe (Panel D). These estimates survey weighted according to Equation <a href="beyond-borders.html#eq:survey-weighted-prevalence">(4.18)</a>.
</p>
</div>
<p>Data from the most recent publicly available Population Health Impact Assessment (PHIA) survey were used in each country.
Let <span class="math inline">\(y_{ij} \in \{0, 1\}\)</span> be the survey response for individual <span class="math inline">\(j\)</span> in area <span class="math inline">\(i\)</span>.
The survey designs used were complex in that each individual had potentially unequal probabilities <span class="math inline">\(\pi_{ij}\)</span> of being included in the survey.
Sampling weights
<span class="math display">\[\begin{equation}
w_{ij} = \frac{1}{\pi_{ij}}
\end{equation}\]</span>
were used to account for the complex survey design.
The survey weighted prevalence in area <span class="math inline">\(i\)</span> is
<span class="math display" id="eq:survey-weighted-prevalence">\[\begin{equation}
\rho_i^\star = \frac{\sum_{j} w_{ij} y_{ij}}{\sum_{j} w_{ij}}. \tag{4.18}
\end{equation}\]</span>
The effective number of cases <span class="math inline">\(y_i^\star = \rho_i^\star \cdot m_i^\star\)</span> is given by the product of the weighted prevalence, and the Kish effective sample size <span class="citation">(<a href="#ref-kish1965survey">Kish 1965</a>)</span>
<span class="math display">\[\begin{equation}
m_i^\star = \frac{(\sum_j w_{ij})^2}{\sum_j w_{ij}^2},
\end{equation}\]</span>
and may be intuitively thought of as what would have been observed had the survey been a simple random sample.</p>
</div>
<div id="inferential-models-1" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Inferential models<a href="beyond-borders.html#inferential-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The inferential models used correspond to those in Section <a href="beyond-borders.html#simulation-study">4.3</a> with a small modification.
As before, prevalences <span class="math inline">\(\rho_i\)</span> were modelled via <span class="math inline">\(\text{logit}(\rho_i) = \beta_0 + u_i\)</span> with spatial random effect specification varied according to Table <a href="beyond-borders.html#tab:inferential-models">4.2</a>.
Due to survey weighting, the effective number of cases <span class="math inline">\(y_i^\star \in \mathbb{R}\)</span> and effective sample size <span class="math inline">\(m_i^\star \in \mathbb{R}\)</span> may not be integers.
Following <span class="citation">Chen, Wakefield, and Lumely (<a href="#ref-chen2014use">2014</a>)</span> a generalised binomial distribution <span class="math inline">\(y_i^\star \sim \text{xBin}(m_i^\star, \rho_i)\)</span> was used, with working likelihood for <span class="math inline">\(m^\star_i \geq y^\star_i\)</span> given by
<span class="math display" id="eq:xbinomial">\[\begin{equation}
p(y_i^\star \, | \, m_i^\star, \rho_i) =
\frac{\Gamma(m_i^\star + 1)}{\Gamma(y_i^\star + 1) \Gamma(m_i^\star - y_i^\star + 1)}  \rho_i ^{y_i^\star}  (1 - \rho_i)^{(m_i^\star - y_i^\star)}. \tag{4.19}
\end{equation}\]</span></p>
</div>
<div id="model-comparison-1" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Model comparison<a href="beyond-borders.html#model-comparison-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cv"></span>
<img src="figures/beyond-borders/cv.png" alt="In leave-one-out (LOO) cross-validation, one observation is left out of the training data and predicted upon in each fold. The spatial-leave-one-out (SLOO) cross-validation scheme considered here is similar, only differing in that observations corresponding to adjacent areas are also left out of the training data." width="95%" />
<p class="caption">
Figure 4.11: In leave-one-out (LOO) cross-validation, one observation is left out of the training data and predicted upon in each fold. The spatial-leave-one-out (SLOO) cross-validation scheme considered here is similar, only differing in that observations corresponding to adjacent areas are also left out of the training data.
</p>
</div>
<p>Each model was assessed using (Figure <a href="beyond-borders.html#fig:cv">4.11</a>):</p>
<ol style="list-style-type: decimal">
<li>a regular leave-one-out cross-validation (LOO-CV);</li>
<li>a spatial leave-one-out cross-validation (SLOO-CV).</li>
</ol>
<p>At each fold the CRPS, MSE and quantile (as in Section <a href="beyond-borders.html#model-assessment">4.3.3</a>) of posterior predictive samples as compared with the observed data were computed.
In this section, the number of samples per posterior marginal was <span class="math inline">\(S = 1000\)</span>.</p>
<!-- To contrast approaches to model comparison, the DIC and WAIC measures of model fit were also computed. -->
<!-- Given pointwise log-likelihood evaluations, these measures were obtained via the `loo` R package [@loo]. -->
</div>
<div id="results-1" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Results<a href="beyond-borders.html#results-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>

<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crps-mean-se-surveys"></span>
<img src="resources/beyond-borders/20231229-092307-f1156802/depends/crps-mean-se-surveys.png" alt="The mean pointwise leave-one-out and spatial leave-one-out CRPS in estimating \(\rho_i\) using each inferential model for the four PHIA surveys described in Table 4.3. The 95% credible intervals shown are generated using 1.96 times the standard error." width="95%" />
<p class="caption">
Figure 4.12: The mean pointwise leave-one-out and spatial leave-one-out CRPS in estimating <span class="math inline">\(\rho_i\)</span> using each inferential model for the four PHIA surveys described in Table <a href="beyond-borders.html#tab:hiv-surveys">4.3</a>. The 95% credible intervals shown are generated using 1.96 times the standard error.
</p>
</div>
<div id="dzoozqkaae" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dzoozqkaae .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dzoozqkaae .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dzoozqkaae .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dzoozqkaae .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dzoozqkaae .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dzoozqkaae .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzoozqkaae .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dzoozqkaae .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dzoozqkaae .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dzoozqkaae .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dzoozqkaae .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dzoozqkaae .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dzoozqkaae .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dzoozqkaae .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dzoozqkaae .gt_from_md > :first-child {
  margin-top: 0;
}

#dzoozqkaae .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dzoozqkaae .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dzoozqkaae .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dzoozqkaae .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dzoozqkaae .gt_row_group_first td {
  border-top-width: 2px;
}

#dzoozqkaae .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzoozqkaae .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dzoozqkaae .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dzoozqkaae .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzoozqkaae .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzoozqkaae .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dzoozqkaae .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dzoozqkaae .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dzoozqkaae .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dzoozqkaae .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzoozqkaae .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dzoozqkaae .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dzoozqkaae .gt_left {
  text-align: left;
}

#dzoozqkaae .gt_center {
  text-align: center;
}

#dzoozqkaae .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dzoozqkaae .gt_font_normal {
  font-weight: normal;
}

#dzoozqkaae .gt_font_bold {
  font-weight: bold;
}

#dzoozqkaae .gt_font_italic {
  font-style: italic;
}

#dzoozqkaae .gt_super {
  font-size: 65%;
}

#dzoozqkaae .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#dzoozqkaae .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dzoozqkaae .gt_indent_1 {
  text-indent: 5px;
}

#dzoozqkaae .gt_indent_2 {
  text-indent: 10px;
}

#dzoozqkaae .gt_indent_3 {
  text-indent: 15px;
}

#dzoozqkaae .gt_indent_4 {
  text-indent: 20px;
}

#dzoozqkaae .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <caption><span id="tab:cv-crps">Table 4.4: </span>The mean pointwise leave-one-out and spatial leave-one-out CRPS, with standard errors, for each inferential model across the four considered PHIA surveys. The units used in this table are thousandths.</caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="Survey">Survey</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="7" scope="colgroup" id="Continuous ranked probability score (units: 1/1000)">
        <span class="gt_column_spanner">Continuous ranked probability score (units: 1/1000)</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="IID">IID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="Besag">Besag</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="BYM2">BYM2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="FCK">FCK</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="FIK">FIK</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="CK">CK</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="text-align: center;" scope="col" id="IK">IK</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <th colspan="8" class="gt_group_heading" scope="colgroup" id="LOO">LOO</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="LOO  Survey" class="gt_row gt_left">Côte d’Ivoire, PHIA 2017</td>
<td headers="LOO  IID" class="gt_row gt_right">6.6 (0.3)</td>
<td headers="LOO  Besag" class="gt_row gt_right">6.6 (0.3)</td>
<td headers="LOO  BYM2" class="gt_row gt_right">6.7 (0.3)</td>
<td headers="LOO  FCK" class="gt_row gt_right">6.7 (0.3)</td>
<td headers="LOO  FIK" class="gt_row gt_right">6.9 (0.3)</td>
<td headers="LOO  CK" class="gt_row gt_right">6.9 (0.3)</td>
<td headers="LOO  IK" class="gt_row gt_right">6.9 (0.3)</td></tr>
    <tr><td headers="LOO  Survey" class="gt_row gt_left">Malawi, PHIA 2016</td>
<td headers="LOO  IID" class="gt_row gt_right">31.7 (0.6)</td>
<td headers="LOO  Besag" class="gt_row gt_right">19.5 (0.4)</td>
<td headers="LOO  BYM2" class="gt_row gt_right">19.6 (0.4)</td>
<td headers="LOO  FCK" class="gt_row gt_right">22.7 (0.5)</td>
<td headers="LOO  FIK" class="gt_row gt_right">21.4 (0.4)</td>
<td headers="LOO  CK" class="gt_row gt_right">22.8 (0.5)</td>
<td headers="LOO  IK" class="gt_row gt_right">21.0 (0.4)</td></tr>
    <tr><td headers="LOO  Survey" class="gt_row gt_left">Tanzania, PHIA 2017</td>
<td headers="LOO  IID" class="gt_row gt_right">14.9 (0.5)</td>
<td headers="LOO  Besag" class="gt_row gt_right">12.1 (0.4)</td>
<td headers="LOO  BYM2" class="gt_row gt_right">13.4 (0.4)</td>
<td headers="LOO  FCK" class="gt_row gt_right">10.7 (0.3)</td>
<td headers="LOO  FIK" class="gt_row gt_right">10.3 (0.3)</td>
<td headers="LOO  CK" class="gt_row gt_right">9.5 (0.3)</td>
<td headers="LOO  IK" class="gt_row gt_right">10.6 (0.3)</td></tr>
    <tr><td headers="LOO  Survey" class="gt_row gt_left">Zimbabwe, PHIA 2016</td>
<td headers="LOO  IID" class="gt_row gt_right">28.9 (0.4)</td>
<td headers="LOO  Besag" class="gt_row gt_right">20.8 (0.3)</td>
<td headers="LOO  BYM2" class="gt_row gt_right">20.9 (0.3)</td>
<td headers="LOO  FCK" class="gt_row gt_right">21.7 (0.3)</td>
<td headers="LOO  FIK" class="gt_row gt_right">21.4 (0.3)</td>
<td headers="LOO  CK" class="gt_row gt_right">21.6 (0.3)</td>
<td headers="LOO  IK" class="gt_row gt_right">22.0 (0.3)</td></tr>
    <tr class="gt_group_heading_row">
      <th colspan="8" class="gt_group_heading" scope="colgroup" id="SLOO">SLOO</th>
    </tr>
    <tr class="gt_row_group_first"><td headers="SLOO  Survey" class="gt_row gt_left">Côte d’Ivoire, PHIA 2017</td>
<td headers="SLOO  IID" class="gt_row gt_right">6.5 (0.3)</td>
<td headers="SLOO  Besag" class="gt_row gt_right">6.6 (0.3)</td>
<td headers="SLOO  BYM2" class="gt_row gt_right">6.6 (0.3)</td>
<td headers="SLOO  FCK" class="gt_row gt_right">6.4 (0.2)</td>
<td headers="SLOO  FIK" class="gt_row gt_right">6.4 (0.2)</td>
<td headers="SLOO  CK" class="gt_row gt_right">6.9 (0.2)</td>
<td headers="SLOO  IK" class="gt_row gt_right">6.8 (0.2)</td></tr>
    <tr><td headers="SLOO  Survey" class="gt_row gt_left">Malawi, PHIA 2016</td>
<td headers="SLOO  IID" class="gt_row gt_right">31.6 (0.5)</td>
<td headers="SLOO  Besag" class="gt_row gt_right">19.3 (0.4)</td>
<td headers="SLOO  BYM2" class="gt_row gt_right">19.9 (0.4)</td>
<td headers="SLOO  FCK" class="gt_row gt_right">26.5 (0.4)</td>
<td headers="SLOO  FIK" class="gt_row gt_right">25.1 (0.4)</td>
<td headers="SLOO  CK" class="gt_row gt_right">29.0 (0.6)</td>
<td headers="SLOO  IK" class="gt_row gt_right">28.3 (0.5)</td></tr>
    <tr><td headers="SLOO  Survey" class="gt_row gt_left">Tanzania, PHIA 2017</td>
<td headers="SLOO  IID" class="gt_row gt_right">14.9 (0.5)</td>
<td headers="SLOO  Besag" class="gt_row gt_right">12.1 (0.4)</td>
<td headers="SLOO  BYM2" class="gt_row gt_right">18.1 (0.7)</td>
<td headers="SLOO  FCK" class="gt_row gt_right">16.0 (0.6)</td>
<td headers="SLOO  FIK" class="gt_row gt_right">15.4 (0.6)</td>
<td headers="SLOO  CK" class="gt_row gt_right">17.6 (0.5)</td>
<td headers="SLOO  IK" class="gt_row gt_right">16.9 (0.5)</td></tr>
    <tr><td headers="SLOO  Survey" class="gt_row gt_left">Zimbabwe, PHIA 2016</td>
<td headers="SLOO  IID" class="gt_row gt_right">29.1 (0.4)</td>
<td headers="SLOO  Besag" class="gt_row gt_right">20.8 (0.3)</td>
<td headers="SLOO  BYM2" class="gt_row gt_right">25.2 (0.4)</td>
<td headers="SLOO  FCK" class="gt_row gt_right">26.7 (0.4)</td>
<td headers="SLOO  FIK" class="gt_row gt_right">26.1 (0.4)</td>
<td headers="SLOO  CK" class="gt_row gt_right">26.2 (0.4)</td>
<td headers="SLOO  IK" class="gt_row gt_right">26.3 (0.4)</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The results (Figure <a href="beyond-borders.html#fig:crps-mean-se-surveys">4.12</a> and Table <a href="beyond-borders.html#tab:cv-crps">4.4</a>) for each survey were as follows:</p>
<ol style="list-style-type: decimal">
<li><p>For the 2017 PHIA survey in Côte d’Ivoire, all of the models performed similarly, using both LOO and SLOO cross-validation (Figure <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-civ2017phia">A.37</a>)
The pointwise CRPS for all models was high at one outlying district in the survey, Grand-Ponts.
It is difficult to see how any spatial random model would perform well in this situation, without additional covariates or using a distribution with heavier tails than the Gaussian.</p>
<p>The CK and IK models had lengthscale posterior distributions largely unchanged from their prior distribution (Figure <a href="models-for-areal-spatial-structure.html#fig:lengthscale-posteriors">A.31</a>).
This uncertainty in lengthscale resulted wide prevalence 95% credible intervals for the CK and IK models in Figure <a href="models-for-areal-spatial-structure.html#fig:ladder-civ2017phia">A.33</a>.
This example shows the importance of being careful using kernel models, and the prior distributions set on their hyperparameters.
It is suprisingly that this behaviour appears not to have resulted in poor LOO or SLOO performance.</p>
<p>For this survey the BYM2 proportion posterior distribution was also similar to its prior distribution, in contrast to each of the other surveys which had BYM2 proportion posteriors peaked at one, corresponding to spatially structured noise (Figure <a href="models-for-areal-spatial-structure.html#fig:proportion-posteriors">A.32</a>).</p></li>
<li><p>For the 2017 PHIA survey in Malawi the Besag and BYM2 models performed the best, followed by the kernel models, and then the IID model (Figure <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-mwi2016phia">A.38</a>).
While the LOO and SLOO CRPS values for IID, Besag and BYM2 models were similar, for the kernel models forecasting performance was substantially reduced by leaving out adjacent districts.
This finding is suprising, as the kernel models make use of more distant correlations, and it is the adjacency-based models that one would intuitively expect to be hampered more by the SLOO cross-validation.
For the IID model, that LOO and SLOO performance are similar is no surprise as in all cases the IID model should be predicting the mean.
Though less data is available in the SLOO case, this should be of little consequence.</p></li>
<li><p>For the 2017 PHIA survey in Tanzania (Figure <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-tza2017phia">A.39</a>), under LOO cross-validation the kernel models performed better, but under SLOO cross-validation there was a significant drop in performance.</p></li>
<li><p>Finally, for the 2016 PHIA survey in Zimbabwe, performance for each of the spatially structured models was similar (Figure <a href="models-for-areal-spatial-structure.html#fig:crps-mean-se-zwe2016phia">A.40</a>).
Again, under SLOO cross-validation, performance of the BYM2 and kernel-based models dropped.
Differences within the kernel-based models for this survey, and throughout this study, were limited.</p></li>
</ol>
</div>
</div>
<div id="discussion" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Discussion<a href="beyond-borders.html#discussion" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="modelling" class="section level3 hasAnchor" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Modelling<a href="beyond-borders.html#modelling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Though there are situations were other models perform better, on the whole this study supports the use of adjacency-based spatial random effect models.
For the study on HIV survey data, adjacency-based models performed well, if not the best, in all cases.</p>
<p>Under data truly generated from a kernel model, there is a significant benefit to using a corresponding kernel model for inference.
However, the transferability of this finding to applied settings is limited by the following factors.
First and foremost, it is usually impossible to know that real data was generated from any particular process.
Second, the synthetic data study used the same kernel, Matérn with <span class="math inline">\(\nu = 3/2\)</span> (Equation), for both simulation and inference, and as such represents a best-case.
Third, specification of the lengthscale prior distribution is challenging, and easy to do badly.</p>
<p>In the simulation study, aggregation via the integrated kernel occured at the level of the latent field.
However, most of the time we expect aggregation to occur at the level of the data.
If the link function <span class="math inline">\(g\)</span> is the identity or linear then the two are equivalent, but for non-linear link functions there is a discrepancy.
<!-- Add equations for mean $\mathbb{E}(y_i)$ and variance $\mathbb{V}(y_i)$ of under this model, as a function of $g$. -->
<!-- Explain under what circumstances we believe this approximation to be acceptable. --></p>
<!-- * What are my suggestions for new models to develop on the basis of this work -->
<!-- * GMRFs perform smoothing more locally -->
<!-- * Related work to discuss includes @follestad2003modelling and @konstantinoudis2020discrete. -->
<!-- * Discussion of the overall area versus point question. Papers of Sam using point level. -->
<!-- * @li2012spatial and @li2012lgcp. -->
<!-- * Discussion of non-stationarity [@paciorek2006spatial]. -->
<!-- * The stochastic partial differential equation approximation as a more computationally efficient way to implement integrated kernels [@wilson2018pointless]. -->
<!-- * BYM2 proportion parameter in the case where there is an outlier ends up too IID. Urban rural or other covariates. Heavier tail than Gaussian. -->
<!-- * How does the weighted GMRF connect? -->
<!-- * Lengthscale and noise. I wonder if kernel models might be defined where there hyperparameters are orthogonal. -->
</div>
<div id="model-comparison-2" class="section level3 hasAnchor" number="4.5.2">
<h3><span class="header-section-number">4.5.2</span> Model comparison<a href="beyond-borders.html#model-comparison-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Previous spatial random effect comparison studies <span class="citation">(<a href="#ref-best2005comparison">Nicky Best, Richardson, and Thomson 2005</a>; <a href="#ref-lee2011comparison">Lee 2011</a>)</span> were limited to the DIC measure of model performance.
Use of the DIC is strongly discouraged by <span class="citation">Vehtari, Gelman, and Gabry (<a href="#ref-vehtari2017practical">2017</a>)</span>.
This study used less flawed measures of model performance, such as the cross-validated CRPS.
It would be beneficial to compute the DIC and WAIC in Section <a href="beyond-borders.html#hiv-study">4.4</a> as a comparison.
Additionally, the measures presented in this work are disaggregated by area.
With refinements to the sample sizes used, these disaggregated measures could enable nuanced findings about spatial random effect models.</p>
<p>Cross-validation was performed using <span class="math inline">\(\phi\)</span> as the forecasting target, rather than <span class="math inline">\(y\)</span> as is typical.
I made this decision because applied interest is in forecasting HIV prevlance at a district level, not in the outcome of a household survey.
It could be argued that a district does not become more important to forecast well by virtue of surveying a larger sample size in that district.
That said, an alternative viewpoint is that forecast accuracy should be incentivised more for districts with large populations, such that PLHIV is accurately estimated.
If sample size corresponds to population size, then forecasting <span class="math inline">\(y\)</span> could be a useful proxy.
In general, choice of the particular paramter, or transformation of that parameter, to score is an ongoing topic of research <span class="citation">(<a href="#ref-bosse2023scoring">Nikos I. Bosse et al. 2023</a>)</span>.</p>
<p>The CRPS was used in preference to the log-score primarily because of computational difficulties with the log-score.
Whereas the log-score requires a kernel density estimate of the posterior distribution, and is therefore sensitive to tuning parameters, the CRPS can be estimated from samples alone.</p>
<p>One downside of use of the CRPS and MSE is their relative lack of interpretability.
For example, it is difficult to determine whether a forecast is good, or suitable for practical use, on the basis of its CRPS or MSE.
Measures such as the skill score have been used to contrast forecast performance with some baseline.
A constant model, with no random effects, could be used as such a baseline.</p>
</div>
<div id="inference-1" class="section level3 hasAnchor" number="4.5.3">
<h3><span class="header-section-number">4.5.3</span> Inference<a href="beyond-borders.html#inference-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>All of the inferential models (Table <a href="beyond-borders.html#tab:inferential-models">4.2</a>) in this chapter were implemented in <code>TMB</code>.
Inference was then conducted using AGHQ over the marginal Laplace approximation using the <code>aghq</code> package.
The accuracy of inferences was compared to gold-standard results from NUTS obtained using the <code>tmbstan</code> package.
An earlier version of this study used <code>R-INLA</code>.
Not all of the inferential models were compatible with <code>R-INLA</code>, so <code>rstan</code> was used in some cases.
However, due to the difference in inference algorithm, this study design did not allow for direct model comparison.
Consistent use of <code>TMB</code>, a fast and flexible tool for spatial modelling <span class="citation">(<a href="#ref-osgood2023statistical">Osgood-Zimmerman and Wakefield 2023</a>)</span>, overcame this limitation.
Chapter <a href="naomi-aghq.html#naomi-aghq">6</a> extends <code>TMB</code> to implement the INLA algorithm of <code>R-INLA</code>.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-aldor2013power" class="csl-entry">
Aldor-Noiman, Sivan, Lawrence D Brown, Andreas Buja, Wolfgang Rolke, and Robert A Stine. 2013. <span>“<span class="nocase">The power to see: A new graphical test of normality</span>.”</span> <em>The American Statistician</em> 67 (4): 249–60.
</div>
<div id="ref-arambepola2022simulation" class="csl-entry">
Arambepola, Rohan, Tim CD Lucas, Anita K Nandi, Peter W Gething, and Ewan Cameron. 2022. <span>“<span class="nocase">A simulation study of disaggregation regression for spatial disease mapping</span>.”</span> <em>Statistics in Medicine</em> 41 (1): 1–16.
</div>
<div id="ref-bennett2019particulate" class="csl-entry">
Bennett, James E, Helen Tamura-Wicks, Robbie M Parks, Richard T Burnett, C Arden Pope III, Matthew J Bechle, Julian D Marshall, Goodarz Danaei, and Majid Ezzati. 2019. <span>“<span class="nocase">Particulate matter air pollution and national and county life expectancy loss in the USA: A spatiotemporal analysis</span>.”</span> <em>PLoS Medicine</em> 16 (7): e1002856.
</div>
<div id="ref-besag1991bayesian" class="csl-entry">
Besag, Julian, Jeremy York, and Annie Mollié. 1991. <span>“<span class="nocase">Bayesian image restoration, with two applications in spatial statistics</span>.”</span> <em>Annals of the Institute of Statistical Mathematics</em> 43 (1): 1–20.
</div>
<div id="ref-best1999bayesian" class="csl-entry">
Best, N, N Arnold, A Thomas, L Waller, and E Conlon. 1999. <span>“<span class="nocase">Bayesian models for spatially correlated disease and exposure data</span>.”</span> In <em>Bayesian Statistics 6: Proceedings of the Sixth Valencia International Meeting</em>, 6:131. Oxford University Press.
</div>
<div id="ref-best2005comparison" class="csl-entry">
Best, Nicky, Sylvia Richardson, and Andrew Thomson. 2005. <span>“<span class="nocase">A comparison of Bayesian spatial models for disease mapping</span>.”</span> <em>Statistical Methods in Medical Research</em> 14 (1): 35–59.
</div>
<div id="ref-betancourt2017robust" class="csl-entry">
Betancourt, Michael. 2017. <span>“<span class="nocase">Robust Gaussian processes in Stan</span>.”</span> <a href="https://betanalpha.github.io/assets/case\%5Fstudies/gp\%5Fpart3/part3.html">https://betanalpha.github.io/assets/case\%5Fstudies/gp\%5Fpart3/part3.html</a>.
</div>
<div id="ref-bhatt2015effect" class="csl-entry">
Bhatt, Samir, DJ Weiss, E Cameron, D Bisanzio, B Mappin, U Dalrymple, KE Battle, et al. 2015. <span>“<span class="nocase">The effect of malaria control on Plasmodium falciparum in Africa between 2000 and 2015</span>.”</span> <em>Nature</em> 526 (7572): 207–11.
</div>
<div id="ref-blangiardo2013spatial" class="csl-entry">
Blangiardo, Marta, Michela Cameletti, Gianluca Baio, and Håvard Rue. 2013. <span>“<span class="nocase">Spatial and spatio-temporal models with R-INLA</span>.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 4: 33–49.
</div>
<div id="ref-bosse2023scoring" class="csl-entry">
Bosse, Nikos I, Sam Abbott, Anne Cori, Edwin van Leeuwen, Johannes Bracher, and Sebastian Funk. 2023. <span>“<span class="nocase">Scoring epidemiological forecasts on transformed scales</span>.”</span> <em>PLoS Computational Biology</em> 19 (8): e1011393.
</div>
<div id="ref-carpenter2017stan" class="csl-entry">
Carpenter, Bob, Andrew Gelman, Matthew D Hoffman, Daniel Lee, Ben Goodrich, Michael Betancourt, Marcus Brubaker, Jiqiang Guo, Peter Li, and Allen Riddell. 2017. <span>“<span class="nocase">Stan: A probabilistic programming language</span>.”</span> <em>Journal of Statistical Software</em> 76 (1).
</div>
<div id="ref-chau2021deconditional" class="csl-entry">
Chau, Siu Lun, Shahine Bouabid, and Dino Sejdinovic. 2021. <span>“<span class="nocase">Deconditional downscaling with Gaussian processes</span>.”</span> <em>Advances in Neural Information Processing Systems</em> 34: 17813–25.
</div>
<div id="ref-chen2014use" class="csl-entry">
Chen, Cici, Jon Wakefield, and Thomas Lumely. 2014. <span>“<span class="nocase">The use of sampling weights in Bayesian hierarchical models for small area estimation</span>.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 11: 33–43.
</div>
<div id="ref-cramb2018investigation" class="csl-entry">
Cramb, SM, EW Duncan, PD Baade, and KL Mengersen. 2018. <span>“<span class="nocase">Investigation of Bayesian spatial models</span>.”</span> Cancer Council Queensland; Queensland University of Technology (QUT).
</div>
<div id="ref-dawid1984present" class="csl-entry">
Dawid, A Philip. 1984. <span>“<span class="nocase">Present position and potential developments: Some personal views statistical theory the prequential approach</span>.”</span> <em>Journal of the Royal Statistical Society: Series A (General)</em> 147 (2): 278–90.
</div>
<div id="ref-nimblemanual" class="csl-entry">
de Valpine, Perry, Christopher Paciorek, Daniel Turek, Nick Michaud, Cliff Anderson-Bergman, Fritz Obermeyer, Claudia Wehrhahn Cortes, Abel Rodrìguez, Duncan Temple Lang, and Sally Paganin. 2023. <em><span>NIMBLE User Manual</span></em> (version 1.0.1). <a href="https://doi.org/10.5281/zenodo.1211190">https://doi.org/10.5281/zenodo.1211190</a>.
</div>
<div id="ref-dean2001detecting" class="csl-entry">
Dean, CB, MD Ugarte, and AF Militino. 2001. <span>“<span class="nocase">Detecting interaction between random region and fixed age effects in disease mapping</span>.”</span> <em>Biometrics</em> 57 (1): 197–202.
</div>
<div id="ref-diggle2013spatial" class="csl-entry">
Diggle, Peter J, Paula Moraga, Barry Rowlingson, Benjamin M Taylor, et al. 2013. <span>“<span class="nocase">Spatial and spatio-temporal log-Gaussian Cox processes: extending the geostatistical paradigm</span>.”</span> <em>Statistical Science</em> 28 (4): 542–63.
</div>
<div id="ref-conegan2022geostan" class="csl-entry">
Donegan, Connor. 2022. <span>“<span class="nocase">geostan: An R package for Bayesian spatial analysis</span>.”</span> <em>The Journal of Open Source Software</em> 7 (79): 4716. <a href="https://doi.org/10.21105/joss.04716">https://doi.org/10.21105/joss.04716</a>.
</div>
<div id="ref-duncan2017spatial" class="csl-entry">
Duncan, Earl W, Nicole M White, and Kerrie Mengersen. 2017. <span>“<span class="nocase">Spatial smoothing in Bayesian models: a comparison of weights matrix specifications and their impact on inference</span>.”</span> <em>International Journal of Health Geographics</em> 16 (1): 1–16.
</div>
<div id="ref-dwyer2019mapping" class="csl-entry">
Dwyer-Lindgren, Laura, Michael A Cork, Amber Sligar, Krista M Steuben, Kate F Wilson, Naomi R Provost, Benjamin K Mayala, et al. 2019. <span>“<span class="nocase">Mapping HIV prevalence in sub-Saharan Africa between 2000 and 2017</span>.”</span> <em>Nature</em> 570 (7760): 189–93.
</div>
<div id="ref-dwyer2015drinking" class="csl-entry">
Dwyer-Lindgren, Laura, Abraham D Flaxman, Marie Ng, Gillian M Hansen, Christopher JL Murray, and Ali H Mokdad. 2015. <span>“<span class="nocase">Drinking patterns in US counties from 2002 to 2012</span>.”</span> <em>American Journal of Public Health</em> 105 (6): 1120–27.
</div>
<div id="ref-flaxman2015supported" class="csl-entry">
Flaxman, Seth R, Yu-Xiang Wang, and Alexander J Smola. 2015. <span>“<span class="nocase">Who supported Obama in 2012? Ecological inference through distribution regression</span>.”</span> In <em>Proceedings of the 21th ACM SIGKDD International Conference on Knowledge Discovery and Data Mining</em>, 289–98.
</div>
<div id="ref-freni2018note" class="csl-entry">
Freni-Sterrantino, Anna, Massimo Ventrucci, and Håvard Rue. 2018. <span>“<span class="nocase">A note on intrinsic conditional autoregressive models for disconnected graphs</span>.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 26: 25–34.
</div>
<div id="ref-gartner2002multi" class="csl-entry">
Gärtner, Thomas, Peter A Flach, Adam Kowalczyk, and Alexander J Smola. 2002. <span>“<span class="nocase">Multi-instance kernels</span>.”</span> In <em>ICML</em>, 2:7. 3.
</div>
<div id="ref-gelman2006prior" class="csl-entry">
———. 2006. <span>“<span class="nocase">Prior distributions for variance parameters in hierarchical models (comment on article by Browne and Draper)</span>.”</span> <em>Bayesian Analysis</em> 1 (3): 515–34.
</div>
<div id="ref-gneiting2007strictly" class="csl-entry">
Gneiting, Tilmann, and Adrian E Raftery. 2007. <span>“<span class="nocase">Strictly proper scoring rules, prediction, and estimation</span>.”</span> <em>Journal of the American Statistical Association</em> 102 (477): 359–78.
</div>
<div id="ref-gossl2001bayesian" class="csl-entry">
Gössl, Christoff, Dorothee P Auer, and Ludwig Fahrmeir. 2001. <span>“<span class="nocase">Bayesian spatiotemporal inference in functional magnetic resonance imaging</span>.”</span> <em>Biometrics</em> 57 (2): 554–62.
</div>
<div id="ref-haining2003spatial" class="csl-entry">
Haining, Robert P. 2003. <em><span class="nocase">Spatial data analysis: theory and practice</span></em>. Cambridge University Press.
</div>
<div id="ref-hamelijnck2019multi" class="csl-entry">
Hamelijnck, O, T Damoulas, K Wang, and MA Girolami. 2019. <span>“<span class="nocase">Multi-resolution multi-task Gaussian processes</span>.”</span> <em>Advances in Neural Information Processing Systems</em> 32.
</div>
<div id="ref-howes2023arealutils" class="csl-entry">
Howes, Adam. 2023. <em><span class="nocase">arealutils: Utility functions for beyond-borders</span></em>.
</div>
<div id="ref-johnson2019spatially" class="csl-entry">
Johnson, Olatunji, Peter Diggle, and Emanuele Giorgi. 2019. <span>“<span class="nocase">A spatially discrete approximation to log-Gaussian Cox processes for modelling aggregated disease count data</span>.”</span> <em>Statistics in Medicine</em> 38 (24): 4871–87.
</div>
<div id="ref-kelsall2002modeling" class="csl-entry">
Kelsall, Julia, and Jonathan Wakefield. 2002. <span>“<span class="nocase">Modeling spatial variation in disease risk: a geostatistical approach</span>.”</span> <em>Journal of the American Statistical Association</em> 97 (459): 692–701.
</div>
<div id="ref-kish1965survey" class="csl-entry">
Kish, Leslie. 1965. <em><span class="nocase">Survey sampling</span></em>. 04; HN29, K5.
</div>
<div id="ref-kristensen2016tmb" class="csl-entry">
Kristensen, Kasper, Anders Nielsen, Casper W Berg, Hans Skaug, Bradley M Bell, et al. 2016. <span>“<span class="nocase">TMB: Automatic Differentiation and Laplace Approximation</span>.”</span> <em>Journal of Statistical Software</em> 70 (i05).
</div>
<div id="ref-law2018variational" class="csl-entry">
Law, Ho Chung, Dino Sejdinovic, Ewan Cameron, Tim Lucas, Seth Flaxman, Katherine Battle, and Kenji Fukumizu. 2018. <span>“<span class="nocase">Variational learning on aggregate outputs with Gaussian processes</span>.”</span> <em>Advances in Neural Information Processing Systems</em> 31.
</div>
<div id="ref-lee2011comparison" class="csl-entry">
Lee, Duncan. 2011. <span>“<span class="nocase">A comparison of conditional autoregressive models used in Bayesian disease mapping</span>.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 2 (2): 79–89.
</div>
<div id="ref-leroux2000estimation" class="csl-entry">
Leroux, Brian G, Xingye Lei, and Norman Breslow. 2000. <span>“<span class="nocase">Estimation of disease rates in small areas: a new mixed model for spatial dependence</span>.”</span> In <em>Statistical Models in Epidemiology, the Environment, and Clinical Trials</em>, 179–91. Springer.
</div>
<div id="ref-matheson1976scoring" class="csl-entry">
Matheson, James E, and Robert L Winkler. 1976. <span>“<span class="nocase">Scoring rules for continuous probability distributions</span>.”</span> <em>Management Science</em> 22 (10): 1087–96.
</div>
<div id="ref-mayala2020predicting" class="csl-entry">
Mayala, Benjamin K., Samir Bhatt, and Peter Gething. 2020. <span>“<span class="nocase">Predicting HIV/AIDS at Subnational Levels using DHS Covariates related to HIV</span>.”</span> DHS Spatial Analysis Reports 18. Rockville, Maryland, USA: ICF.
</div>
<div id="ref-monnahan2018no" class="csl-entry">
Monnahan, Cole C, and Kasper Kristensen. 2018. <span>“<span class="nocase">No-U-turn sampling for fast Bayesian inference in ADMB and TMB: Introducing the adnuts and tmbstan R packages</span>.”</span> <em>PloS One</em> 13 (5): e0197954.
</div>
<div id="ref-morris2019bayesian" class="csl-entry">
Morris, Mitzi, Katherine Wheeler-Martin, Dan Simpson, Stephen J. Mooney, Andrew Gelman, and Charles DiMaggio. 2019. <span>“<span class="nocase">Bayesian hierarchical spatial models: Implementing the Besag York Mollié model in stan</span>.”</span> <em>Spatial and Spatio-Temporal Epidemiology</em> 31: 100301. https://doi.org/<a href="https://doi.org/10.1016/j.sste.2019.100301">https://doi.org/10.1016/j.sste.2019.100301</a>.
</div>
<div id="ref-nandi2023disaggregation" class="csl-entry">
Nandi, Anita K, Tim CD Lucas, Rohan Arambepola, Peter Gething, and Daniel J Weiss. 2023. <span>“<span class="nocase">disaggregation: An R Package for Bayesian Spatial Disaggregation Modeling</span>.”</span> <em>Journal of Statistical Software</em> 106: 1–19.
</div>
<div id="ref-openshow1979million" class="csl-entry">
Openshaw, S, and P. J. Taylor. 1979. <span>“<span class="nocase">A million or so correlation coefficients, three experiments on the modifiable areal unit problem</span>.”</span> <em>Statistical Applications in the Spatial Science</em>, 127–44.
</div>
<div id="ref-osgood2023statistical" class="csl-entry">
Osgood-Zimmerman, Aaron, and Jon Wakefield. 2023. <span>“<span class="nocase">A Statistical Review of Template Model Builder: A Flexible Tool for Spatial Modelling</span>.”</span> <em>International Statistical Review</em> 91 (2): 318–42.
</div>
<div id="ref-paciorek2013spatial" class="csl-entry">
Paciorek, Christopher J et al. 2013. <span>“<span class="nocase">Spatial models for point and areal data using Markov random fields on a fine grid</span>.”</span> <em>Electronic Journal of Statistics</em> 7: 946–72.
</div>
<div id="ref-parks2020anomalously" class="csl-entry">
Parks, Robbie M, James E Bennett, Helen Tamura-Wicks, Vasilis Kontis, Ralf Toumi, Goodarz Danaei, and Majid Ezzati. 2020. <span>“<span class="nocase">Anomalously warm temperatures are associated with increased injury deaths</span>.”</span> <em>Nature Medicine</em> 26 (1): 65–70.
</div>
<div id="ref-pebesma2018sf" class="csl-entry">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-rashid2023inequalities" class="csl-entry">
Rashid, T, JE Bennett, D Muller, A Cross, J Pearson-Stuttard, H Daby, D Fecht, B Davies, and M Ezzati. 2023. <span>“<span class="nocase">Inequalities in mortality from leading cancers in districts of England from 2002 to 2019: population-based high-resolution spatiotemporal analysis of vital registration data</span>.”</span> <em>The Lancet Oncology</em>. <a href="http://hdl.handle.net/10044/1/107364">http://hdl.handle.net/10044/1/107364</a>.
</div>
<div id="ref-riebler2016intuitive" class="csl-entry">
Riebler, Andrea, Sigrunn H Sørbye, Daniel Simpson, and Håvard Rue. 2016. <span>“<span class="nocase">An intuitive Bayesian spatial model for disease mapping that accounts for scaling</span>.”</span> <em>Statistical Methods in Medical Research</em> 25 (4): 1145–65.
</div>
<div id="ref-rue2020comment" class="csl-entry">
———. 2020. <span>“<span class="nocase">Comment on R-INLA Discussion Group thread</span>.”</span>
</div>
<div id="ref-rue2005gaussian" class="csl-entry">
Rue, Havard, and Leonhard Held. 2005. <em><span class="nocase">Gaussian Markov random fields: theory and applications</span></em>. CRC press.
</div>
<div id="ref-sailynoja2022graphical" class="csl-entry">
Säilynoja, Teemu, Paul-Christian Bürkner, and Aki Vehtari. 2022. <span>“<span class="nocase">Graphical test for discrete uniformity and its applications in goodness-of-fit evaluation and multiple sample comparison</span>.”</span> <em>Statistics and Computing</em> 32 (2): 32.
</div>
<div id="ref-saracco2010modeling" class="csl-entry">
Saracco, James F, J Andrew Royle, David F DeSante, and Beth Gardner. 2010. <span>“<span class="nocase">Modeling spatial variation in avian survival and residency probabilities</span>.”</span> <em>Ecology</em> 91 (7): 1885–91.
</div>
<div id="ref-saunders2023pymc" class="csl-entry">
Saunders, Daniel. 2023. <span>“<span class="nocase">The Besag-York-Mollie Model for Spatial Data</span>.”</span> In <em>PyMC Examples</em>, edited by PyMC Team. <a href="https://doi.org/10.5281/zenodo.5654871">https://doi.org/10.5281/zenodo.5654871</a>.
</div>
<div id="ref-schmid2006bayesian" class="csl-entry">
Schmid, Volker J, Brandon Whitcher, Anwar R Padhani, N Jane Taylor, and Guang-Zhong Yang. 2006. <span>“<span class="nocase">Bayesian methods for pharmacokinetic models in dynamic contrast-enhanced magnetic resonance imaging</span>.”</span> <em>IEEE Transactions on Medical Imaging</em> 25 (12): 1627–36.
</div>
<div id="ref-simpson2017penalising" class="csl-entry">
Simpson, Daniel, Håvard Rue, Andrea Riebler, Thiago G Martins, Sigrunn H Sørbye, et al. 2017. <span>“<span class="nocase">Penalising model component complexity: A principled, practical approach to constructing priors</span>.”</span> <em>Statistical Science</em> 32 (1): 1–28.
</div>
<div id="ref-sorbye2014scaling" class="csl-entry">
Sørbye, Sigrunn Holbek, and Håvard Rue. 2014. <span>“<span class="nocase">Scaling intrinsic Gaussian Markov random field priors in spatial modelling</span>.”</span> <em>Spatial Statistics</em> 8: 39–51.
</div>
<div id="ref-stein1999interpolation" class="csl-entry">
Stein, Michael L. 1999. <span>“<span class="nocase">Interpolation of spatial data: some theory for kriging</span>.”</span>
</div>
<div id="ref-stringer2021implementing" class="csl-entry">
Stringer, Alex. 2021. <span>“<span class="nocase">Implementing Approximate Bayesian Inference using Adaptive Quadrature: the aghq Package</span>.”</span> <em>arXiv Preprint arXiv:2101.04468</em>.
</div>
<div id="ref-stringer2022fast" class="csl-entry">
Stringer, Alex, Patrick Brown, and Jamie Stafford. 2022. <span>“<span class="nocase">Fast, scalable approximations to posterior distributions in extended latent Gaussian models</span>.”</span> <em>Journal of Computational and Graphical Statistics</em>, 1–15.
</div>
<div id="ref-tanaka2019spatially" class="csl-entry">
Tanaka, Yusuke, Toshiyuki Tanaka, Tomoharu Iwata, Takeshi Kurashima, Maya Okawa, Yasunori Akagi, and Hiroyuki Toda. 2019. <span>“<span class="nocase">Spatially aggregated Gaussian processes with multivariate areal outputs</span>.”</span> In <em>Advances in Neural Information Processing Systems</em>, 3005–15.
</div>
<div id="ref-teh2021efficient" class="csl-entry">
Teh, Yee Whye, Bryn Elesedy, Bobby He, Michael Hutchinson, Sheheryar Zaidi, Avishkar Bhoopchand, Ulrich Paquet, Nenad Tomasev, Jonathan Read, and Peter J. Diggle. 2022. <span>“<span class="nocase">Efficient Bayesian inference of Instantaneous Reproduction Numbers at Fine Spatial Scales, with an Application to Mapping and Nowcasting the Covid-19 Epidemic in British Local Authorities</span>.”</span> <em>Journal of the Royal Statistical Society Series A: Statistics in Society</em> 185 (1): S65–85. <a href="https://doi.org/10.1111/rssa.12971">https://doi.org/10.1111/rssa.12971</a>.
</div>
<div id="ref-utazi2019spatial" class="csl-entry">
Utazi, C Edson, Julia Thorley, VA Alegana, MJ Ferrari, Kristine Nilsen, Saki Takahashi, CJE Metcalf, Justin Lessler, and AJ Tatem. 2019. <span>“<span class="nocase">A spatial regression model for the disaggregation of areal unit based data to high-resolution grids with application to vaccination coverage mapping</span>.”</span> <em>Statistical Methods in Medical Research</em> 28 (10-11): 3226–41.
</div>
<div id="ref-vehtari2017practical" class="csl-entry">
Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. <span>“Practical Bayesian Model Evaluation Using Leave-One-Out Cross-Validation and WAIC.”</span> <em>Statistics and Computing</em> 27: 1413–32.
</div>
<div id="ref-wakefield1999spatial" class="csl-entry">
Wakefield, J, and S Morris. 1999. <span>“<span class="nocase">Spatial dependence and errors-in-variables in environmental epidemiology</span>.”</span> <em>Bayesian Statistics</em> 6: 657–84.
</div>
<div id="ref-wakefield2010aggregation" class="csl-entry">
Wakefield, Jonathan, and Hilary Lyons. 2010. <span>“<span class="nocase">Spatial Aggregation and the Ecological Fallacy</span>.”</span> In <em>Chapman &amp; Hall/CRC Handbooks of Modern Statistical Methods</em>, 2010:541–58. <a href="https://doi.org/10.1201/9781420072884-c30">https://doi.org/10.1201/9781420072884-c30</a>.
</div>
<div id="ref-weiss2015re" class="csl-entry">
Weiss, Daniel J, Bonnie Mappin, Ursula Dalrymple, Samir Bhatt, Ewan Cameron, Simon I Hay, and Peter W Gething. 2015. <span>“<span class="nocase">Re-examining environmental correlates of Plasmodium falciparum malaria endemicity: a data-intensive variable selection approach</span>.”</span> <em>Malaria Journal</em> 14 (1): 1–18.
</div>
<div id="ref-yousefi2019multi" class="csl-entry">
Yousefi, Fariba, Michael T Smith, and Mauricio Alvarez. 2019. <span>“<span class="nocase">Multi-task learning for aggregated data using Gaussian processes</span>.”</span> <em>Advances in Neural Information Processing Systems</em> 32.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayes-st.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multi-agyw.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
