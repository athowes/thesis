<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>C Fast approximate Bayesian inference | Bayesian spatio-temporal methods for small-area estimation of HIV indicators</title>
  <meta name="description" content="C Fast approximate Bayesian inference | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="C Fast approximate Bayesian inference | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="C Fast approximate Bayesian inference | Bayesian spatio-temporal methods for small-area estimation of HIV indicators" />
  
  
  

<meta name="author" content="Adam Howes" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="a-model-for-risk-group-proportions.html"/>
<link rel="next" href="references.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="templates/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#chapter-overview"><i class="fa fa-check"></i><b>1.1</b> Chapter overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="hiv-aids.html"><a href="hiv-aids.html"><i class="fa fa-check"></i><b>2</b> The HIV/AIDS epidemic</a>
<ul>
<li class="chapter" data-level="2.1" data-path="hiv-aids.html"><a href="hiv-aids.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a></li>
<li class="chapter" data-level="2.2" data-path="hiv-aids.html"><a href="hiv-aids.html#surveillance"><i class="fa fa-check"></i><b>2.2</b> HIV surveillance</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="hiv-aids.html"><a href="hiv-aids.html#data"><i class="fa fa-check"></i><b>2.2.1</b> Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="hiv-aids.html"><a href="hiv-aids.html#challenges"><i class="fa fa-check"></i><b>2.2.2</b> Challenges</a></li>
<li class="chapter" data-level="2.2.3" data-path="hiv-aids.html"><a href="hiv-aids.html#statistical-approaches"><i class="fa fa-check"></i><b>2.2.3</b> Statistical approaches</a></li>
<li class="chapter" data-level="2.2.4" data-path="hiv-aids.html"><a href="hiv-aids.html#future-directions"><i class="fa fa-check"></i><b>2.2.4</b> Future directions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bayes-st.html"><a href="bayes-st.html"><i class="fa fa-check"></i><b>3</b> Bayesian spatio-temporal statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-statistics"><i class="fa fa-check"></i><b>3.1</b> Bayesian statistics</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-modelling"><i class="fa fa-check"></i><b>3.1.1</b> Bayesian modelling</a></li>
<li class="chapter" data-level="3.1.2" data-path="bayes-st.html"><a href="bayes-st.html#bayesian-computation"><i class="fa fa-check"></i><b>3.1.2</b> Bayesian computation</a></li>
<li class="chapter" data-level="3.1.3" data-path="bayes-st.html"><a href="bayes-st.html#interplay-between-modelling-and-computation"><i class="fa fa-check"></i><b>3.1.3</b> Interplay between modelling and computation</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="bayes-st.html"><a href="bayes-st.html#spatio-temporal-statistics"><i class="fa fa-check"></i><b>3.2</b> Spatio-temporal statistics</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="bayes-st.html"><a href="bayes-st.html#properties-of-spatio-temporal-data"><i class="fa fa-check"></i><b>3.2.1</b> Properties of spatio-temporal data</a></li>
<li class="chapter" data-level="3.2.2" data-path="bayes-st.html"><a href="bayes-st.html#small-area-estimation"><i class="fa fa-check"></i><b>3.2.2</b> Small-area estimation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="bayes-st.html"><a href="bayes-st.html#hierarchical-lgm-elgm"><i class="fa fa-check"></i><b>3.3</b> Model structure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="bayes-st.html"><a href="bayes-st.html#linear-model"><i class="fa fa-check"></i><b>3.3.1</b> Linear model</a></li>
<li class="chapter" data-level="3.3.2" data-path="bayes-st.html"><a href="bayes-st.html#generalised-linear-model"><i class="fa fa-check"></i><b>3.3.2</b> Generalised linear model</a></li>
<li class="chapter" data-level="3.3.3" data-path="bayes-st.html"><a href="bayes-st.html#hierarchical"><i class="fa fa-check"></i><b>3.3.3</b> Hierarchical models</a></li>
<li class="chapter" data-level="3.3.4" data-path="bayes-st.html"><a href="bayes-st.html#generalised-linear-mixed-effects-model"><i class="fa fa-check"></i><b>3.3.4</b> Generalised linear mixed effects model</a></li>
<li class="chapter" data-level="3.3.5" data-path="bayes-st.html"><a href="bayes-st.html#lgm"><i class="fa fa-check"></i><b>3.3.5</b> Latent Gaussian model</a></li>
<li class="chapter" data-level="3.3.6" data-path="bayes-st.html"><a href="bayes-st.html#elgm"><i class="fa fa-check"></i><b>3.3.6</b> Extended latent Gaussian model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="bayes-st.html"><a href="bayes-st.html#model-comparison"><i class="fa fa-check"></i><b>3.4</b> Model comparison</a></li>
<li class="chapter" data-level="3.5" data-path="bayes-st.html"><a href="bayes-st.html#survey"><i class="fa fa-check"></i><b>3.5</b> Survey methods</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="bayes-st.html"><a href="bayes-st.html#survey-notation-and-key-terms"><i class="fa fa-check"></i><b>3.5.1</b> Survey notation and key terms</a></li>
<li class="chapter" data-level="3.5.2" data-path="bayes-st.html"><a href="bayes-st.html#survey-design"><i class="fa fa-check"></i><b>3.5.2</b> Survey design</a></li>
<li class="chapter" data-level="3.5.3" data-path="bayes-st.html"><a href="bayes-st.html#survey-analysis"><i class="fa fa-check"></i><b>3.5.3</b> Survey analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="beyond-borders.html"><a href="beyond-borders.html"><i class="fa fa-check"></i><b>4</b> Models for spatial structure</a>
<ul>
<li class="chapter" data-level="4.1" data-path="beyond-borders.html"><a href="beyond-borders.html#background-1"><i class="fa fa-check"></i><b>4.1</b> Background</a></li>
<li class="chapter" data-level="4.2" data-path="beyond-borders.html"><a href="beyond-borders.html#adjacency"><i class="fa fa-check"></i><b>4.2</b> Models based on adjacency</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="beyond-borders.html"><a href="beyond-borders.html#the-besag-model"><i class="fa fa-check"></i><b>4.2.1</b> The Besag model</a></li>
<li class="chapter" data-level="4.2.2" data-path="beyond-borders.html"><a href="beyond-borders.html#best-practises-for-the-besag-model"><i class="fa fa-check"></i><b>4.2.2</b> Best practises for the Besag model</a></li>
<li class="chapter" data-level="4.2.3" data-path="beyond-borders.html"><a href="beyond-borders.html#the-reparameterised-besag-york-mollié-model"><i class="fa fa-check"></i><b>4.2.3</b> The reparameterised Besag-York-Mollié model</a></li>
<li class="chapter" data-level="4.2.4" data-path="beyond-borders.html"><a href="beyond-borders.html#concerns-about-the-besag-models-representation-of-space"><i class="fa fa-check"></i><b>4.2.4</b> Concerns about the Besag model’s representation of space</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="beyond-borders.html"><a href="beyond-borders.html#models-using-kernels"><i class="fa fa-check"></i><b>4.3</b> Models using kernels</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="beyond-borders.html"><a href="beyond-borders.html#centroid-kernel"><i class="fa fa-check"></i><b>4.3.1</b> Centroid kernel</a></li>
<li class="chapter" data-level="4.3.2" data-path="beyond-borders.html"><a href="beyond-borders.html#integrated-kernel"><i class="fa fa-check"></i><b>4.3.2</b> Integrated kernel</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="beyond-borders.html"><a href="beyond-borders.html#simulation-study"><i class="fa fa-check"></i><b>4.4</b> Simulation study</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="beyond-borders.html"><a href="beyond-borders.html#synthetic-data-sets"><i class="fa fa-check"></i><b>4.4.1</b> Synthetic data-sets</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="beyond-borders.html"><a href="beyond-borders.html#hiv-prevalence-study"><i class="fa fa-check"></i><b>4.5</b> HIV prevalence study</a></li>
<li class="chapter" data-level="4.6" data-path="beyond-borders.html"><a href="beyond-borders.html#discussion"><i class="fa fa-check"></i><b>4.6</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multi-agyw.html"><a href="multi-agyw.html"><i class="fa fa-check"></i><b>5</b> A model for risk group proportions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="multi-agyw.html"><a href="multi-agyw.html#background-2"><i class="fa fa-check"></i><b>5.1</b> Background</a></li>
<li class="chapter" data-level="5.2" data-path="multi-agyw.html"><a href="multi-agyw.html#data-1"><i class="fa fa-check"></i><b>5.2</b> Data</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="multi-agyw.html"><a href="multi-agyw.html#behavioural-data-from-household-surveys"><i class="fa fa-check"></i><b>5.2.1</b> Behavioural data from household surveys</a></li>
<li class="chapter" data-level="5.2.2" data-path="multi-agyw.html"><a href="multi-agyw.html#other-data"><i class="fa fa-check"></i><b>5.2.2</b> Other data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="multi-agyw.html"><a href="multi-agyw.html#model-for-risk-group-proportions"><i class="fa fa-check"></i><b>5.3</b> Model for risk group proportions</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="multi-agyw.html"><a href="multi-agyw.html#st-multinomial"><i class="fa fa-check"></i><b>5.3.1</b> Spatio-temporal multinomial logistic regression</a></li>
<li class="chapter" data-level="5.3.2" data-path="multi-agyw.html"><a href="multi-agyw.html#s-logistic"><i class="fa fa-check"></i><b>5.3.2</b> Spatial logistic regression</a></li>
<li class="chapter" data-level="5.3.3" data-path="multi-agyw.html"><a href="multi-agyw.html#model-combination"><i class="fa fa-check"></i><b>5.3.3</b> Model combination</a></li>
<li class="chapter" data-level="5.3.4" data-path="multi-agyw.html"><a href="multi-agyw.html#female-sex-worker-population-size-adjustment"><i class="fa fa-check"></i><b>5.3.4</b> Female sex worker population size adjustment</a></li>
<li class="chapter" data-level="5.3.5" data-path="multi-agyw.html"><a href="multi-agyw.html#results"><i class="fa fa-check"></i><b>5.3.5</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multi-agyw.html"><a href="multi-agyw.html#prevalence-and-incidence-by-risk-group"><i class="fa fa-check"></i><b>5.4</b> Prevalence and incidence by risk group</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="multi-agyw.html"><a href="multi-agyw.html#disaggregation-of-naomi-prevalence-estimates"><i class="fa fa-check"></i><b>5.4.1</b> Disaggregation of Naomi prevalence estimates</a></li>
<li class="chapter" data-level="5.4.2" data-path="multi-agyw.html"><a href="multi-agyw.html#disaggregation-of-naomi-incidence-estimates"><i class="fa fa-check"></i><b>5.4.2</b> Disaggregation of Naomi incidence estimates</a></li>
<li class="chapter" data-level="5.4.3" data-path="multi-agyw.html"><a href="multi-agyw.html#expected-new-infections-reached"><i class="fa fa-check"></i><b>5.4.3</b> Expected new infections reached</a></li>
<li class="chapter" data-level="5.4.4" data-path="multi-agyw.html"><a href="multi-agyw.html#results-1"><i class="fa fa-check"></i><b>5.4.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="multi-agyw.html"><a href="multi-agyw.html#discussion-1"><i class="fa fa-check"></i><b>5.5</b> Discussion</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="multi-agyw.html"><a href="multi-agyw.html#limitations"><i class="fa fa-check"></i><b>5.5.1</b> Limitations</a></li>
<li class="chapter" data-level="5.5.2" data-path="multi-agyw.html"><a href="multi-agyw.html#conclusion"><i class="fa fa-check"></i><b>5.5.2</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="naomi-aghq.html"><a href="naomi-aghq.html"><i class="fa fa-check"></i><b>6</b> Fast approximate Bayesian inference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#inference-methods-and-software"><i class="fa fa-check"></i><b>6.1</b> Inference methods and software</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#la"><i class="fa fa-check"></i><b>6.1.1</b> The Laplace approximation</a></li>
<li class="chapter" data-level="6.1.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#quadrature"><i class="fa fa-check"></i><b>6.1.2</b> Quadrature</a></li>
<li class="chapter" data-level="6.1.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#inla"><i class="fa fa-check"></i><b>6.1.3</b> Integrated nested Laplace approximation</a></li>
<li class="chapter" data-level="6.1.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#software"><i class="fa fa-check"></i><b>6.1.4</b> Software</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#universal"><i class="fa fa-check"></i><b>6.2</b> A universal INLA implementation</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#epil"><i class="fa fa-check"></i><b>6.2.1</b> Epilepsy GLMM</a></li>
<li class="chapter" data-level="6.2.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#unknown"><i class="fa fa-check"></i><b>6.2.2</b> An example that <code>R-INLA</code> doesn’t work for</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi"><i class="fa fa-check"></i><b>6.3</b> The Naomi model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-model"><i class="fa fa-check"></i><b>6.3.1</b> Model structure</a></li>
<li class="chapter" data-level="6.3.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#naomi-elgm"><i class="fa fa-check"></i><b>6.3.2</b> Naomi as an ELGM</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#pca-aghq"><i class="fa fa-check"></i><b>6.4</b> AGHQ in moderate dimensions</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#aghq-with-variable-levels"><i class="fa fa-check"></i><b>6.4.1</b> AGHQ with variable levels</a></li>
<li class="chapter" data-level="6.4.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#principal-components-analysis"><i class="fa fa-check"></i><b>6.4.2</b> Principal components analysis</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="naomi-aghq.html"><a href="naomi-aghq.html#malawi"><i class="fa fa-check"></i><b>6.5</b> Malawi case-study</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#nuts-convergence"><i class="fa fa-check"></i><b>6.5.1</b> NUTS convergence</a></li>
<li class="chapter" data-level="6.5.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#use-of-pca-aghq"><i class="fa fa-check"></i><b>6.5.2</b> Use of PCA-AGHQ</a></li>
<li class="chapter" data-level="6.5.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#model-assessment"><i class="fa fa-check"></i><b>6.5.3</b> Model assessment</a></li>
<li class="chapter" data-level="6.5.4" data-path="naomi-aghq.html"><a href="naomi-aghq.html#inference-comparison"><i class="fa fa-check"></i><b>6.5.4</b> Inference comparison</a></li>
<li class="chapter" data-level="6.5.5" data-path="naomi-aghq.html"><a href="naomi-aghq.html#exceedance-probabilities"><i class="fa fa-check"></i><b>6.5.5</b> Exceedance probabilities</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="naomi-aghq.html"><a href="naomi-aghq.html#discussion-2"><i class="fa fa-check"></i><b>6.6</b> Discussion</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="naomi-aghq.html"><a href="naomi-aghq.html#a-universal-inla-implementation"><i class="fa fa-check"></i><b>6.6.1</b> A universal INLA implementation</a></li>
<li class="chapter" data-level="6.6.2" data-path="naomi-aghq.html"><a href="naomi-aghq.html#pca-aghq-with-application-to-inla-for-naomi"><i class="fa fa-check"></i><b>6.6.2</b> PCA-AGHQ with application to INLA for Naomi</a></li>
<li class="chapter" data-level="6.6.3" data-path="naomi-aghq.html"><a href="naomi-aghq.html#suggestions-for-future-work"><i class="fa fa-check"></i><b>6.6.3</b> Suggestions for future work</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>7</b> Future work and conclusions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="conclusions.html"><a href="conclusions.html#strengths"><i class="fa fa-check"></i><b>7.1</b> Strengths</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="conclusions.html"><a href="conclusions.html#chapter-refbeyond-borders"><i class="fa fa-check"></i><b>7.1.1</b> Chapter @ref(beyond-borders)</a></li>
<li class="chapter" data-level="7.1.2" data-path="conclusions.html"><a href="conclusions.html#chapter-refmulti-agyw"><i class="fa fa-check"></i><b>7.1.2</b> Chapter @ref(multi-agyw)</a></li>
<li class="chapter" data-level="7.1.3" data-path="conclusions.html"><a href="conclusions.html#chapter-refnaomi-aghq"><i class="fa fa-check"></i><b>7.1.3</b> Chapter @ref(naomi-aghq)</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="conclusions.html"><a href="conclusions.html#future-work"><i class="fa fa-check"></i><b>7.2</b> Future work</a></li>
<li class="chapter" data-level="7.3" data-path="conclusions.html"><a href="conclusions.html#conclusions-1"><i class="fa fa-check"></i><b>7.3</b> Conclusions</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="models-for-spatial-structure.html"><a href="models-for-spatial-structure.html"><i class="fa fa-check"></i><b>A</b> Models for spatial structure</a></li>
<li class="chapter" data-level="B" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html"><i class="fa fa-check"></i><b>B</b> A model for risk group proportions</a>
<ul>
<li class="chapter" data-level="B.1" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#the-global-aids-strategy"><i class="fa fa-check"></i><b>B.1</b> The Global AIDS Strategy</a></li>
<li class="chapter" data-level="B.2" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#household-survey-data"><i class="fa fa-check"></i><b>B.2</b> Household survey data</a></li>
<li class="chapter" data-level="B.3" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#spatial-analysis-levels"><i class="fa fa-check"></i><b>B.3</b> Spatial analysis levels</a></li>
<li class="chapter" data-level="B.4" data-path="a-model-for-risk-group-proportions.html"><a href="a-model-for-risk-group-proportions.html#survey-questions"><i class="fa fa-check"></i><b>B.4</b> Survey questions and risk group allocation</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html"><i class="fa fa-check"></i><b>C</b> Fast approximate Bayesian inference</a>
<ul>
<li class="chapter" data-level="C.1" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#epilepsy-example"><i class="fa fa-check"></i><b>C.1</b> Epilepsy example</a>
<ul>
<li class="chapter" data-level="C.1.1" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#tmb-epil"><i class="fa fa-check"></i><b>C.1.1</b> TMB C++ template</a></li>
</ul></li>
<li class="chapter" data-level="C.2" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#naomi-math"><i class="fa fa-check"></i><b>C.2</b> Simplified Naomi model description</a>
<ul>
<li class="chapter" data-level="C.2.1" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#naomi-process"><i class="fa fa-check"></i><b>C.2.1</b> Process specification</a></li>
<li class="chapter" data-level="C.2.2" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#naomi-likelihood"><i class="fa fa-check"></i><b>C.2.2</b> Additional likelihood specification</a></li>
<li class="chapter" data-level="C.2.3" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#naomi-identifiability"><i class="fa fa-check"></i><b>C.2.3</b> Identifiability constraints</a></li>
<li class="chapter" data-level="C.2.4" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#naomi-implementation"><i class="fa fa-check"></i><b>C.2.4</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#model-assessment-1"><i class="fa fa-check"></i><b>C.3</b> Model assessment</a></li>
<li class="chapter" data-level="C.4" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#aghq-and-pca-aghq-details"><i class="fa fa-check"></i><b>C.4</b> AGHQ and PCA-AGHQ details</a></li>
<li class="chapter" data-level="C.5" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#normalising-constant-estimation"><i class="fa fa-check"></i><b>C.5</b> Normalising constant estimation</a></li>
<li class="chapter" data-level="C.6" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#inference-comparison-1"><i class="fa fa-check"></i><b>C.6</b> Inference comparison</a></li>
<li class="chapter" data-level="C.7" data-path="fast-approximate-bayesian-inference.html"><a href="fast-approximate-bayesian-inference.html#mcmc-convergence-and-suitability"><i class="fa fa-check"></i><b>C.7</b> MCMC convergence and suitability</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><p>Bayesian spatio-temporal methods for small-area estimation of HIV indicators</p></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fast-approximate-bayesian-inference" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">C</span> Fast approximate Bayesian inference<a href="fast-approximate-bayesian-inference.html#fast-approximate-bayesian-inference" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="epilepsy-example" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">C.1</span> Epilepsy example<a href="fast-approximate-bayesian-inference.html#epilepsy-example" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="tmb-epil" class="section level3 hasAnchor" number="10.1.1">
<h3><span class="header-section-number">C.1.1</span> TMB C++ template<a href="fast-approximate-bayesian-inference.html#tmb-epil" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="fast-approximate-bayesian-inference.html#cb14-1" tabindex="-1"></a><span class="co">// epil.cpp</span></span>
<span id="cb14-2"><a href="fast-approximate-bayesian-inference.html#cb14-2" tabindex="-1"></a></span>
<span id="cb14-3"><a href="fast-approximate-bayesian-inference.html#cb14-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;TMB.hpp&gt;</span></span>
<span id="cb14-4"><a href="fast-approximate-bayesian-inference.html#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="fast-approximate-bayesian-inference.html#cb14-5" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> Type<span class="op">&gt;</span></span>
<span id="cb14-6"><a href="fast-approximate-bayesian-inference.html#cb14-6" tabindex="-1"></a>Type objective_function<span class="op">&lt;</span>Type<span class="op">&gt;::</span><span class="kw">operator</span><span class="op">()()</span></span>
<span id="cb14-7"><a href="fast-approximate-bayesian-inference.html#cb14-7" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-8"><a href="fast-approximate-bayesian-inference.html#cb14-8" tabindex="-1"></a>  DATA_INTEGER<span class="op">(</span>N<span class="op">);</span></span>
<span id="cb14-9"><a href="fast-approximate-bayesian-inference.html#cb14-9" tabindex="-1"></a>  DATA_INTEGER<span class="op">(</span>J<span class="op">);</span></span>
<span id="cb14-10"><a href="fast-approximate-bayesian-inference.html#cb14-10" tabindex="-1"></a>  DATA_INTEGER<span class="op">(</span>K<span class="op">);</span></span>
<span id="cb14-11"><a href="fast-approximate-bayesian-inference.html#cb14-11" tabindex="-1"></a>  DATA_MATRIX<span class="op">(</span>X<span class="op">);</span></span>
<span id="cb14-12"><a href="fast-approximate-bayesian-inference.html#cb14-12" tabindex="-1"></a>  DATA_VECTOR<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb14-13"><a href="fast-approximate-bayesian-inference.html#cb14-13" tabindex="-1"></a>  DATA_MATRIX<span class="op">(</span>E<span class="op">);</span> <span class="co">// Epsilon matrix</span></span>
<span id="cb14-14"><a href="fast-approximate-bayesian-inference.html#cb14-14" tabindex="-1"></a>  </span>
<span id="cb14-15"><a href="fast-approximate-bayesian-inference.html#cb14-15" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>beta<span class="op">);</span></span>
<span id="cb14-16"><a href="fast-approximate-bayesian-inference.html#cb14-16" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>epsilon<span class="op">);</span></span>
<span id="cb14-17"><a href="fast-approximate-bayesian-inference.html#cb14-17" tabindex="-1"></a>  PARAMETER_VECTOR<span class="op">(</span>nu<span class="op">);</span></span>
<span id="cb14-18"><a href="fast-approximate-bayesian-inference.html#cb14-18" tabindex="-1"></a>  PARAMETER<span class="op">(</span>l_tau_epsilon<span class="op">);</span></span>
<span id="cb14-19"><a href="fast-approximate-bayesian-inference.html#cb14-19" tabindex="-1"></a>  PARAMETER<span class="op">(</span>l_tau_nu<span class="op">);</span></span>
<span id="cb14-20"><a href="fast-approximate-bayesian-inference.html#cb14-20" tabindex="-1"></a>  </span>
<span id="cb14-21"><a href="fast-approximate-bayesian-inference.html#cb14-21" tabindex="-1"></a>  Type tau_epsilon <span class="op">=</span> exp<span class="op">(</span>l_tau_epsilon<span class="op">);</span></span>
<span id="cb14-22"><a href="fast-approximate-bayesian-inference.html#cb14-22" tabindex="-1"></a>  Type tau_nu <span class="op">=</span> exp<span class="op">(</span>l_tau_nu<span class="op">);</span></span>
<span id="cb14-23"><a href="fast-approximate-bayesian-inference.html#cb14-23" tabindex="-1"></a>  Type sigma_epsilon <span class="op">=</span> sqrt<span class="op">(</span><span class="dv">1</span> <span class="op">/</span> tau_epsilon<span class="op">);</span></span>
<span id="cb14-24"><a href="fast-approximate-bayesian-inference.html#cb14-24" tabindex="-1"></a>  Type sigma_nu <span class="op">=</span> sqrt<span class="op">(</span><span class="dv">1</span> <span class="op">/</span> tau_nu<span class="op">);</span></span>
<span id="cb14-25"><a href="fast-approximate-bayesian-inference.html#cb14-25" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> eta<span class="op">(</span>X <span class="op">*</span> beta <span class="op">+</span> nu <span class="op">+</span> E <span class="op">*</span> epsilon<span class="op">);</span> <span class="co">// Linear predictor</span></span>
<span id="cb14-26"><a href="fast-approximate-bayesian-inference.html#cb14-26" tabindex="-1"></a>  vector<span class="op">&lt;</span>Type<span class="op">&gt;</span> lambda<span class="op">(</span>exp<span class="op">(</span>eta<span class="op">));</span></span>
<span id="cb14-27"><a href="fast-approximate-bayesian-inference.html#cb14-27" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="fast-approximate-bayesian-inference.html#cb14-28" tabindex="-1"></a>  Type nll<span class="op">;</span></span>
<span id="cb14-29"><a href="fast-approximate-bayesian-inference.html#cb14-29" tabindex="-1"></a>  nll <span class="op">=</span> Type<span class="op">(</span><span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb14-30"><a href="fast-approximate-bayesian-inference.html#cb14-30" tabindex="-1"></a>  </span>
<span id="cb14-31"><a href="fast-approximate-bayesian-inference.html#cb14-31" tabindex="-1"></a>  <span class="co">// Note: dgamma() is parameterised as (shape, scale)</span></span>
<span id="cb14-32"><a href="fast-approximate-bayesian-inference.html#cb14-32" tabindex="-1"></a>  <span class="co">// R-INLA is parameterised as (shape, rate)</span></span>
<span id="cb14-33"><a href="fast-approximate-bayesian-inference.html#cb14-33" tabindex="-1"></a>  nll <span class="op">-=</span> dlgamma<span class="op">(</span>l_tau_epsilon<span class="op">,</span> Type<span class="op">(</span><span class="fl">0.001</span><span class="op">),</span> Type<span class="op">(</span><span class="fl">1.0</span> <span class="op">/</span> <span class="fl">0.001</span><span class="op">),</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb14-34"><a href="fast-approximate-bayesian-inference.html#cb14-34" tabindex="-1"></a>  nll <span class="op">-=</span> dlgamma<span class="op">(</span>l_tau_nu<span class="op">,</span> Type<span class="op">(</span><span class="fl">0.001</span><span class="op">),</span> Type<span class="op">(</span><span class="fl">1.0</span> <span class="op">/</span> <span class="fl">0.001</span><span class="op">),</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb14-35"><a href="fast-approximate-bayesian-inference.html#cb14-35" tabindex="-1"></a>  nll <span class="op">-=</span> dnorm<span class="op">(</span>epsilon<span class="op">,</span> Type<span class="op">(</span><span class="dv">0</span><span class="op">),</span> sigma_epsilon<span class="op">,</span> <span class="kw">true</span><span class="op">).</span>sum<span class="op">();</span></span>
<span id="cb14-36"><a href="fast-approximate-bayesian-inference.html#cb14-36" tabindex="-1"></a>  nll <span class="op">-=</span> dnorm<span class="op">(</span>nu<span class="op">,</span> Type<span class="op">(</span><span class="dv">0</span><span class="op">),</span> sigma_nu<span class="op">,</span> <span class="kw">true</span><span class="op">).</span>sum<span class="op">();</span></span>
<span id="cb14-37"><a href="fast-approximate-bayesian-inference.html#cb14-37" tabindex="-1"></a>  nll <span class="op">-=</span> dnorm<span class="op">(</span>beta<span class="op">,</span> Type<span class="op">(</span><span class="dv">0</span><span class="op">),</span> Type<span class="op">(</span><span class="dv">100</span><span class="op">),</span> <span class="kw">true</span><span class="op">).</span>sum<span class="op">();</span></span>
<span id="cb14-38"><a href="fast-approximate-bayesian-inference.html#cb14-38" tabindex="-1"></a>  </span>
<span id="cb14-39"><a href="fast-approximate-bayesian-inference.html#cb14-39" tabindex="-1"></a>  nll <span class="op">-=</span> dpois<span class="op">(</span>y<span class="op">,</span> lambda<span class="op">,</span> <span class="kw">true</span><span class="op">).</span>sum<span class="op">();</span></span>
<span id="cb14-40"><a href="fast-approximate-bayesian-inference.html#cb14-40" tabindex="-1"></a>  </span>
<span id="cb14-41"><a href="fast-approximate-bayesian-inference.html#cb14-41" tabindex="-1"></a>  ADREPORT<span class="op">(</span>tau_epsilon<span class="op">);</span></span>
<span id="cb14-42"><a href="fast-approximate-bayesian-inference.html#cb14-42" tabindex="-1"></a>  ADREPORT<span class="op">(</span>tau_nu<span class="op">);</span></span>
<span id="cb14-43"><a href="fast-approximate-bayesian-inference.html#cb14-43" tabindex="-1"></a>  </span>
<span id="cb14-44"><a href="fast-approximate-bayesian-inference.html#cb14-44" tabindex="-1"></a>  <span class="cf">return</span><span class="op">(</span>nll<span class="op">);</span></span>
<span id="cb14-45"><a href="fast-approximate-bayesian-inference.html#cb14-45" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div id="naomi-math" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">C.2</span> Simplified Naomi model description<a href="fast-approximate-bayesian-inference.html#naomi-math" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section describes the simplified version of the Naomi model <span class="citation">(<a href="#ref-eaton2021naomi">Eaton et al. 2021</a>)</span> in complete detail.
The more concise <span class="math inline">\(i\)</span> indexing used in Section <a href="naomi-aghq.html#naomi">6.3</a> is replaced by more complete <span class="math inline">\(x, s, a\)</span> indexing.
There are four sections:</p>
<ol style="list-style-type: decimal">
<li>Section <a href="fast-approximate-bayesian-inference.html#naomi-process">C.2.1</a> describes the process specification, giving the terms in each structured additive predictor, along with their distributions.</li>
<li>Section <a href="fast-approximate-bayesian-inference.html#naomi-likelihood">C.2.2</a></li>
<li>Section <a href="fast-approximate-bayesian-inference.html#naomi-identifiability">C.2.3</a></li>
<li>Section <a href="fast-approximate-bayesian-inference.html#naomi-implementation">C.2.4</a></li>
</ol>
<div id="naomi-process" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">C.2.1</span> Process specification<a href="fast-approximate-bayesian-inference.html#naomi-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<caption><span id="tab:process">Table C.1: </span></caption>
<colgroup>
<col width="27%" />
<col width="29%" />
<col width="19%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Model component</th>
<th>Latent field</th>
<th>Hyperparameter</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="fast-approximate-bayesian-inference.html#hiv-prev">C.2.1.1</a></td>
<td>HIV prevalence</td>
<td><span class="math inline">\(22 + 5n\)</span></td>
<td>9</td>
</tr>
<tr class="even">
<td><a href="fast-approximate-bayesian-inference.html#art-cov">C.2.1.2</a></td>
<td>ART coverage</td>
<td><span class="math inline">\(25 + 5n\)</span></td>
<td>9</td>
</tr>
<tr class="odd">
<td><a href="fast-approximate-bayesian-inference.html#hiv-inc">C.2.1.3</a></td>
<td>HIV incidence rate</td>
<td><span class="math inline">\(2 + n\)</span></td>
<td>3</td>
</tr>
<tr class="even">
<td><a href="fast-approximate-bayesian-inference.html#anc-test">C.2.1.4</a></td>
<td>ANC testing</td>
<td><span class="math inline">\(2 + 2n\)</span></td>
<td>2</td>
</tr>
<tr class="odd">
<td><a href="fast-approximate-bayesian-inference.html#art-attend">C.2.1.5</a></td>
<td>ART attendance</td>
<td><span class="math inline">\(n\)</span></td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td>Total</td>
<td><span class="math inline">\(51 + 14n\)</span></td>
<td>24</td>
</tr>
</tbody>
</table>
<div id="hiv-prev" class="section level4 hasAnchor" number="10.2.1.1">
<h4><span class="header-section-number">C.2.1.1</span> HIV prevalence<a href="fast-approximate-bayesian-inference.html#hiv-prev" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>HIV prevalence <span class="math inline">\(\rho_{x, s, a} \in [0, 1]\)</span> was modelled on the logit scale using the structured additive predictor
<span class="math display" id="eq:prev">\[\begin{equation}
\text{logit}(\rho_{x, s, a}) = \beta^\rho_0 + \beta_{S}^{\rho, s = \text{M}} + \mathbf{u}^\rho_a + \mathbf{u}_a^{\rho, s = \text{M}} + \mathbf{u}^\rho_x + \mathbf{u}_x^{\rho, s = \text{M}} + \mathbf{u}_x^{\rho, a &lt; 15} + \boldsymbol{\mathbf{\eta}}^\rho_{R_x, s, a}. \tag{C.1}
\end{equation}\]</span>
Table <a href="fast-approximate-bayesian-inference.html#tab:prev">C.2</a> provides a description of the terms included in Equation <a href="fast-approximate-bayesian-inference.html#eq:prev">(C.1)</a>.
Independent half-normal prior distributions were chosen for the five standard deviation terms
<span class="math display">\[\begin{equation}
\{\sigma_A^\rho, \sigma_{AS}^\rho, \sigma_X^\rho, \sigma_{XS}^\rho, \sigma_{XA}^\rho\} \sim \mathcal{N}^{+}(0, 2.5),
\end{equation}\]</span>
independent uniform prior distributions for the two AR1 correlation parameters
<span class="math display">\[\begin{equation}
\{\phi_A^\rho, \phi_{AS}^\rho\} \sim \mathcal{U}(-1, 1),
\end{equation}\]</span>
and independent beta prior distributions for the two BYM2 proportion parameters
<span class="math display">\[\begin{equation}
\{\phi_X^\rho, \phi_{XS}^\rho\} \sim \text{Beta}(0.5, 0.5).
\end{equation}\]</span></p>
<table>
<caption><span id="tab:prev">Table C.2: </span></caption>
<colgroup>
<col width="17%" />
<col width="25%" />
<col width="57%" />
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Distribution</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta^\rho_0\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, 5)\)</span></td>
<td>Intercept</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_{s}^{\rho, s = \text{M}}\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, 5)\)</span></td>
<td>The difference in logit prevalence for men compared to women</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\mathbf{u}^\rho_a\)</span></td>
<td><span class="math inline">\(\text{AR}1(\sigma_A^\rho, \phi_A^\rho)\)</span></td>
<td>Age random effects for women</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\mathbf{u}_a^{\rho, s = \text{M}}\)</span></td>
<td><span class="math inline">\(\text{AR}1(\sigma_{AS}^\rho, \phi_{AS}^\rho)\)</span></td>
<td>Age random effects for the difference in logit prevalence for men compared to women age <span class="math inline">\(a\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\mathbf{u}^\rho_x\)</span></td>
<td><span class="math inline">\(\text{BYM}2(\sigma_X^\rho, \phi_X^\rho)\)</span></td>
<td>Spatial random effects for women</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\mathbf{u}_x^{\rho, s = \text{M}}\)</span></td>
<td><span class="math inline">\(\text{BYM}2(\sigma_{XS}^\rho, \phi_{XS}^\rho)\)</span></td>
<td>Spatial random effects for the difference in logit prevalence for men compared to women in district <span class="math inline">\(x\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\mathbf{u}_x^{\rho, a &lt; 15}\)</span></td>
<td><span class="math inline">\(\text{ICAR}(\sigma_{XA}^\rho)\)</span></td>
<td>Spatial random effects for the ratio of paediatric prevalence to adult women prevalence</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\boldsymbol{\mathbf{\eta}}^\rho_{R_x, s, a}\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>Fixed offsets specifying assumed odds ratios for prevalence outside the age ranges for which data were available, calculated from Spectrum model <span class="citation">(<a href="#ref-stover2019updates">Stover et al. 2019</a>)</span> outputs for region <span class="math inline">\(R_x\)</span></td>
</tr>
</tbody>
</table>
</div>
<div id="art-cov" class="section level4 hasAnchor" number="10.2.1.2">
<h4><span class="header-section-number">C.2.1.2</span> ART coverage<a href="fast-approximate-bayesian-inference.html#art-cov" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>ART coverage <span class="math inline">\(\alpha_{x, s, a} \in [0, 1]\)</span> was modelled on the logit scale using the structured additive predictor
<span class="math display">\[\begin{equation}
\text{logit}(\alpha_{x, s, a}) = \beta^\alpha_0 + \beta_{S}^{\alpha, s = \text{M}} + \mathbf{u}^\alpha_a + \mathbf{u}_a^{\alpha, s = \text{M}} + \mathbf{u}^\alpha_x + \mathbf{u}_x^{\alpha, s = \text{M}} + \mathbf{u}_x^{\alpha, a &lt; 15} + \boldsymbol{\mathbf{\eta}}^\alpha_{R_x, s, a}
\end{equation}\]</span>
with terms and priors analogous to the HIV prevalence process model in Section <a href="fast-approximate-bayesian-inference.html#hiv-prev">C.2.1.1</a> above.</p>
</div>
<div id="hiv-inc" class="section level4 hasAnchor" number="10.2.1.3">
<h4><span class="header-section-number">C.2.1.3</span> HIV incidence rate<a href="fast-approximate-bayesian-inference.html#hiv-inc" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>HIV incidence rate <span class="math inline">\(\lambda_{x, s, a} &gt; 0\)</span> was modelled on the log scale using the structured additive predictor
<span class="math display" id="eq:inc">\[\begin{equation}
\log(\lambda_{x, s, a}) = \beta_0^\lambda + \beta_S^{\lambda, s = \text{M}} + \log(\rho_{x}^{\text{15-49}}) + \log(1 - \omega \cdot \alpha_{x}^{\text{15-49}}) + \mathbf{u}_x^\lambda + \boldsymbol{\mathbf{\eta}}_{R_x, s, a}^\lambda. \tag{C.2}
\end{equation}\]</span>
Table <a href="fast-approximate-bayesian-inference.html#tab:inc">C.3</a> provides a description of the terms included in Equation <a href="fast-approximate-bayesian-inference.html#eq:inc">(C.2)</a>.</p>
<table>
<caption><span id="tab:inc">Table C.3: </span></caption>
<colgroup>
<col width="15%" />
<col width="14%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Distribution</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta^\lambda_0\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, 5)\)</span></td>
<td>Intercept term proportional to the average HIV transmission rate for untreated HIV positive adults</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_S^{\lambda, s = \text{M}}\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, 5)\)</span></td>
<td>The log incidence rate ratio for men compared to women</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\rho_{x}^{\text{15-49}}\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>The HIV prevalence among adults 15-49 calculated by aggregating age-specific HIV prevalences</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\alpha_{x}^{\text{15-49}}\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>The ART coverage among adults 15-49 calculated by aggregating age-specific ART coverages</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\omega = 0.7\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>Average reduction in HIV transmission rate per increase in population ART coverage fixed based on inputs to the Estimation and Projection Package (EPP) model</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\mathbf{u}_x^\lambda\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, \sigma^\lambda)\)</span></td>
<td>IID spatial random effects with <span class="math inline">\(\sigma^\lambda \sim \mathcal{N}^+(0, 1)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\boldsymbol{\mathbf{\eta}}^\lambda_{R_x, s, a}\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>Fixed log incidence rate ratios by sex and age group calculated from Spectrum model outputs for region <span class="math inline">\(R_x\)</span></td>
</tr>
</tbody>
</table>
<p>The proportion recently infected among HIV positive persons <span class="math inline">\(\kappa_{x, s, a} \in [0, 1]\)</span> was modelled as
<span class="math display">\[\begin{equation}
\kappa_{x, s, a} = 1 - \exp \left(- \lambda_{x, s, a} \cdot \frac{1 - \rho_{x, s, a}}{\rho_{x, s, a}} \cdot (\Omega_T - \beta_T ) - \beta_T \right),
\end{equation}\]</span>
where <span class="math inline">\(\Omega_T \sim \mathcal{N}(\Omega_{T_0}, \sigma^{\Omega_T})\)</span> is the mean duration of recent infection, and <span class="math inline">\(\beta_T \sim \mathcal{N}^{+}(\beta_{T_0}, \sigma^{\beta_T})\)</span> is the false recent ratio.
The prior distribution for <span class="math inline">\(\Omega_T\)</span> was informed by the characteristics of the recent infection testing algorithm.
For PHIA surveys this was <span class="math inline">\(\Omega_{T_0} = 130 \text{ days}\)</span> and <span class="math inline">\(\sigma^{\Omega_T} = 6.12 \text{ days}\)</span>, and there was assumed to be no false recency, such that <span class="math inline">\(\beta_{T_0} = 0.0\)</span> and <span class="math inline">\(\sigma^{\beta_T} = 0.0\)</span>.</p>
</div>
<div id="anc-test" class="section level4 hasAnchor" number="10.2.1.4">
<h4><span class="header-section-number">C.2.1.4</span> ANC testing<a href="fast-approximate-bayesian-inference.html#anc-test" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>HIV prevalence <span class="math inline">\(\rho_{x, a}^\text{ANC}\)</span> and ART coverage <span class="math inline">\(\alpha_{x, a}^\text{ANC}\)</span> among pregnant women were modelled as being offset on the logit scale from the corresponding district-age indicators <span class="math inline">\(\rho_{x, F, a}\)</span> and <span class="math inline">\(\alpha_{x, F, a}\)</span> according to
<span class="math display" id="eq:anc2" id="eq:anc1">\[\begin{align}
\text{logit}(\rho_{x, a}^{\text{ANC}}) &amp;= \text{logit}(\rho_{x, F, a}) + \beta^{\rho^{\text{ANC}}} + \mathbf{u}_x^{\rho^{\text{ANC}}} + \boldsymbol{\mathbf{\eta}}_{R_x, a}^{\rho^{\text{ANC}}}, \tag{C.3} \\
\text{logit}(\alpha_{x, a}^{\text{ANC}}) &amp;= \text{logit}(\alpha_{x, F, a}) + \beta^{\alpha^{\text{ANC}}} + \mathbf{u}_x^{\alpha^{\text{ANC}}} + \boldsymbol{\mathbf{\eta}}_{R_x, a}^{\alpha^{\text{ANC}}} \tag{C.4}.
\end{align}\]</span>
Table <a href="fast-approximate-bayesian-inference.html#tab:anc">C.4</a> provides a description of the terms included in Equation <a href="fast-approximate-bayesian-inference.html#eq:anc1">(C.3)</a> and Equation <a href="fast-approximate-bayesian-inference.html#eq:anc2">(C.4)</a>.</p>
<table>
<caption><span id="tab:anc">Table C.4: </span></caption>
<colgroup>
<col width="13%" />
<col width="16%" />
<col width="69%" />
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Distribution</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta^{\theta^{\text{ANC}}}\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, 5)\)</span></td>
<td>Intercept giving the average difference between population and ANC outcomes</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\mathbf{u}_x^{\theta^{\text{ANC}}}\)</span></td>
<td><span class="math inline">\(\mathcal{N}(0, \sigma_X^{\theta^{\text{ANC}}})\)</span></td>
<td>IID district random effects with <span class="math inline">\(\sigma_X^{\theta^{\text{ANC}}} \sim \mathcal{N}^+(0, 1)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\boldsymbol{\mathbf{\eta}}_{R_x, a}^{\theta^{\text{ANC}}}\)</span></td>
<td><span class="math inline">\(-\)</span></td>
<td>Offsets for the log fertility rate ratios for HIV positive women compared to HIV negative women and for women on ART to HIV positive women not on ART, calculated from Spectrum model outputs for region <span class="math inline">\(R_x\)</span></td>
</tr>
</tbody>
</table>
<p>In the full Naomi model, for adult women 15-49 the number of ANC clients <span class="math inline">\(\Psi_{x, a} &gt; 0\)</span> were modelled as
<span class="math display">\[\begin{equation}
\log (\Psi_{x, a}) = \log (N_{x, \text{F}, a}) + \psi_{R_x, a} + \beta^\psi + \mathbf{u}_x^\psi,
\end{equation}\]</span>
where <span class="math inline">\(N_{x, \text{F}, a}\)</span> are the female population sizes, <span class="math inline">\(\psi_{R_x, a}\)</span> are fixed age-sex fertility ratios in Spectrum region <span class="math inline">\(R_x\)</span>, <span class="math inline">\(\beta^\psi\)</span> are log rate ratios for the number of ANC clients relative to the predicted fertility, and <span class="math inline">\(\mathbf{u}_x^\psi \sim \mathcal{N}(0, \sigma^\psi)\)</span> are district random effects.
Here these terms are fixed to <span class="math inline">\(\beta^\psi = 0\)</span> and <span class="math inline">\(\mathbf{u}_x^\psi = \mathbf{0}\)</span> such that <span class="math inline">\(\Psi_{x, a}\)</span> are simply constants.</p>
</div>
<div id="art-attend" class="section level4 hasAnchor" number="10.2.1.5">
<h4><span class="header-section-number">C.2.1.5</span> ART attendance<a href="fast-approximate-bayesian-inference.html#art-attend" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Let <span class="math inline">\(\gamma_{x, x&#39;} \in [0, 1]\)</span> be the probability that a person on ART residing in district <span class="math inline">\(x\)</span> receives ART in district <span class="math inline">\(x&#39;\)</span>.
Assume that <span class="math inline">\(\gamma_{x, x&#39;} = 0\)</span> for <span class="math inline">\(x \notin \{x, \text{ne}(x)\}\)</span> such that individuals seek treatment only in their residing district or its neighbours <span class="math inline">\(\text{ne}(x) = \{x&#39;: x&#39; \sim x\}\)</span>, where <span class="math inline">\(\sim\)</span> is an adjacency relation, and <span class="math inline">\(\sum_{x&#39; \in \{x, \text{ne}(x)\}} \gamma_{x, x&#39;} = 1\)</span>.
The probabilities <span class="math inline">\(\gamma_{x, x&#39;}\)</span> for <span class="math inline">\(x \sim x&#39;\)</span> were modelled using multinomial logistic regression model, based on the log-odds ratios
<span class="math display" id="eq:log-or">\[\begin{equation}
\tilde \gamma_{x, x&#39;} = \log \left( \frac{\gamma_{x, x&#39;}}{1 - \gamma_{x, x&#39;}} \right) = \tilde \gamma_0 + \mathbf{u}_x^{\tilde \gamma}, \tag{C.5}
\end{equation}\]</span>
where <span class="math inline">\(\tilde \gamma_0 = -4\)</span> is a fixed intercept, and <span class="math inline">\(\mathbf{u}_x^{\tilde \gamma} \sim \mathcal{N}(0, \sigma_X^{\tilde \gamma})\)</span> were district random effects with <span class="math inline">\(\sigma_X^{\tilde \gamma} \sim \mathcal{N}^+(0, 2.5)\)</span>.
Equation <a href="fast-approximate-bayesian-inference.html#eq:log-or">(C.5)</a> is independent of <span class="math inline">\(x&#39;\)</span>, such that <span class="math inline">\(\gamma_{x, x&#39;}\)</span> is only a function of <span class="math inline">\(x\)</span>.
Choice of <span class="math inline">\(\tilde \gamma_0 = -4\)</span> implies a prior mean on <span class="math inline">\(\gamma_{x, x&#39;}\)</span> of 1.8%, such that <span class="math inline">\((100 - 1.8 \times \text{ne}(x))\%\)</span> of ART clients in district <span class="math inline">\(x\)</span> obtain treatment in their home district, a-priori.
Fixing <span class="math inline">\(\tilde \gamma_{x, x} = 0\)</span> then the multinomial probabilities may be recoverd using the softmax
<span class="math display">\[\begin{equation}
\gamma_{x, x&#39;} = \frac{\exp(\tilde \gamma_{x, x&#39;})}{\sum_{x^\star \in \{x, \text{ne}(x)\}} \exp(\tilde \gamma_{x, x^\star})}.
\end{equation}\]</span>
Given the total number of PLHIV on ART
<span class="math display">\[\begin{equation}
A_{x, s, a} = N_{x, s, a} \cdot \rho_{x, s, a} \cdot \alpha_{x, s, a},
\end{equation}\]</span>
the number of ART clients who reside in district <span class="math inline">\(x\)</span> and obtain ART in district <span class="math inline">\(x&#39;\)</span> are
<span class="math display">\[\begin{equation}
A_{x, x&#39;, s, a} = A_{x, s, a} \cdot \gamma_{x, x&#39;},
\end{equation}\]</span>
and the total attending ART facilities in district <span class="math inline">\(x&#39;\)</span> are
<span class="math display">\[\begin{equation}
\tilde A_{x&#39;, s, a} = \sum_{x \in \{x&#39;, \text{ne}(x&#39;)\}} A_{x, x&#39;, s, a}.
\end{equation}\]</span></p>
</div>
</div>
<div id="naomi-likelihood" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">C.2.2</span> Additional likelihood specification<a href="fast-approximate-bayesian-inference.html#naomi-likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Section <a href="naomi-aghq.html#naomi">6.3</a> provides a complete description of the likelihood specification of the model.
Any additional useful details are provided here.</p>
<div id="household-survey-data-1" class="section level4 hasAnchor" number="10.2.2.1">
<h4><span class="header-section-number">C.2.2.1</span> Household survey data<a href="fast-approximate-bayesian-inference.html#household-survey-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The generalised binomial <span class="math inline">\(y \sim \text{xBin}(m, p)\)</span> is defined for <span class="math inline">\(y, m \in \mathbb{R}^+\)</span> with <span class="math inline">\(y \leq m\)</span> such that
<span class="math display">\[\begin{equation}
\log p(y) = \log \Gamma(m + 1) - \log \Gamma(y + 1) - \log \Gamma(m - y + 1) + y \log p + (m - y) \log(1 - p),
\end{equation}\]</span>
where the gamma function <span class="math inline">\(\Gamma\)</span> is such that <span class="math inline">\(\forall n \in \mathbb{N}\)</span>, <span class="math inline">\(\Gamma(n) = (n - 1)!\)</span>.</p>
</div>
<div id="anc-testing-data" class="section level4 hasAnchor" number="10.2.2.2">
<h4><span class="header-section-number">C.2.2.2</span> ANC testing data<a href="fast-approximate-bayesian-inference.html#anc-testing-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Additional details here.</p>
</div>
<div id="art-attendence-data" class="section level4 hasAnchor" number="10.2.2.3">
<h4><span class="header-section-number">C.2.2.3</span> ART attendence data<a href="fast-approximate-bayesian-inference.html#art-attendence-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Additional details here.</p>
</div>
</div>
<div id="naomi-identifiability" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">C.2.3</span> Identifiability constraints<a href="fast-approximate-bayesian-inference.html#naomi-identifiability" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If data are missing, some parameters are fixed to default values to help with identifiability.
In particular:</p>
<ol style="list-style-type: decimal">
<li>If survey data on HIV prevalence or ART coverage by age and sex are not available then <span class="math inline">\(\mathbf{u}_a^\theta = 0\)</span> and <span class="math inline">\(\mathbf{u}_{a, s = \text{M}}^\theta = 0\)</span>.
In this case, the average age-sex pattern from the Spectrum offset <span class="math inline">\(\boldsymbol{\mathbf{\eta}}_{R_x, s, a}^\theta\)</span> is used.
For the Malawi example considered in the main text, HIV prevalence and ART coverage data are not available for those aged 65+.
As a result, there are <span class="math inline">\(|\{\text{0-4}, \ldots, \text{50-54}\}| = 13\)</span> age groups included for the age random effects.</li>
<li>If no ART data, either survey or ART programme, are available but data on ART coverage among ANC clients are available, the level of ART coverage is not identifiable, but spatial variation is identifiable.
In this instance, overall ART coverage is determined by the Spectrum offset, and only area random effects are estimated such that <span class="math inline">\(\text{logit} \left(\alpha_{x, s, a} \right) = \mathbf{u}_x^\alpha + \boldsymbol{\mathbf{\eta}}_{R_x, s, a}^\alpha\)</span>.</li>
<li>If survey data on recent HIV infection are not included in the model, then <span class="math inline">\(\beta_0^\lambda = \beta_S^{\lambda, s = \text{M}} = 0\)</span> and <span class="math inline">\(\mathbf{u}_x^\lambda = \mathbf{0}\)</span>.
The sex ratio for HIV incidence is determined by the sex incidence rate ratio from Spectrum in the same years and the incidence rate in all districts is modelled assuming the same average HIV transmission rate for untreated adults, but varies according to district estimates of HIV prevalence and ART coverage.</li>
</ol>
</div>
<div id="naomi-implementation" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">C.2.4</span> Implementation<a href="fast-approximate-bayesian-inference.html#naomi-implementation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>TMB</code> C++ code for the negative log-posterior of the simplified Naomi model is available from <a href="https://github.com/athowes/naomi-aghq"><code>https://github.com/athowes/naomi-aghq</code></a>.
(It is not given here, as it is over 500 lines.)
For ease of understanding, Table <a href="fast-approximate-bayesian-inference.html#tab:tmb-lookup">C.5</a> provides correspondence between the mathematical notation used in Section <a href="fast-approximate-bayesian-inference.html#naomi-math">C.2</a> and the variable names used in the <code>TMB</code> code, for all hyperparameters and latent field parameters.
For further reference on the <code>TMB</code> software see <span class="citation">Kristensen (<a href="#ref-tmbdocumentation">2021</a>)</span>.</p>
<table style="width:100%;">
<caption><span id="tab:tmb-lookup">Table C.5: </span></caption>
<colgroup>
<col width="14%" />
<col width="33%" />
<col width="4%" />
<col width="3%" />
<col width="11%" />
<col width="9%" />
<col width="10%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Notation</th>
<th>Type</th>
<th>Size</th>
<th>Domain</th>
<th><span class="math inline">\(\rho\)</span> input?</th>
<th><span class="math inline">\(\alpha\)</span> input?</th>
<th><span class="math inline">\(\lambda\)</span> input?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>logit_phi_rho_x</code></td>
<td><span class="math inline">\(\text{logit}(\phi_X^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_rho_x</code></td>
<td><span class="math inline">\(\log(\sigma_X^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>logit_phi_rho_xs</code></td>
<td><span class="math inline">\(\text{logit}(\phi_{XS}^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_rho_xs</code></td>
<td><span class="math inline">\(\log(\sigma_{XS}^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>logit_phi_rho_a</code></td>
<td><span class="math inline">\(\text{logit}(\phi_A^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_rho_a</code></td>
<td><span class="math inline">\(\log(\sigma_A^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>logit_phi_rho_as</code></td>
<td><span class="math inline">\(\text{logit}(\phi_{AS}^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_rho_as</code></td>
<td><span class="math inline">\(\log(\sigma_{AS}^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_rho_xa</code></td>
<td><span class="math inline">\(\log(\sigma_{XA}^\rho)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>logit_phi_alpha_x</code></td>
<td><span class="math inline">\(\text{logit}(\phi_X^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_alpha_x</code></td>
<td><span class="math inline">\(\log(\sigma_X^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>logit_phi_alpha_xs</code></td>
<td><span class="math inline">\(\text{logit}(\phi_{XS}^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_alpha_xs</code></td>
<td><span class="math inline">\(\log(\sigma_{XS}^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>logit_phi_alpha_a</code></td>
<td><span class="math inline">\(\text{logit}(\phi_A^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_alpha_a</code></td>
<td><span class="math inline">\(\log(\sigma_A^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>logit_phi_alpha_as</code></td>
<td><span class="math inline">\(\text{logit}(\phi_{AS}^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_alpha_as</code></td>
<td><span class="math inline">\(\log(\sigma_{AS}^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_alpha_xa</code></td>
<td><span class="math inline">\(\log(\sigma_{XA}^\alpha)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>OmegaT_raw</code></td>
<td><span class="math inline">\(\Omega_T\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="even">
<td><code>log_betaT</code></td>
<td><span class="math inline">\(\log(\beta_T)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><code>log_sigma_lambda_x</code></td>
<td><span class="math inline">\(\log(\sigma^\lambda)\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="even">
<td><code>log_sigma_ancrho_x</code></td>
<td><span class="math inline">\(\log(\sigma_X^{\rho^{\text{ANC}}})\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_sigma_ancalpha_x</code></td>
<td><span class="math inline">\(\log(\sigma_X^{\alpha^{\text{ANC}}})\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>log_sigma_or_gamma</code></td>
<td><span class="math inline">\(\log(\sigma_X^{\tilde \gamma})\)</span></td>
<td>Hyper</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>beta_rho</code></td>
<td><span class="math inline">\((\beta^\rho_0, \beta_{s}^{\rho, s = \text{M}})\)</span></td>
<td>Latent</td>
<td>2</td>
<td><span class="math inline">\(\mathbb{R}^2\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>beta_alpha</code></td>
<td><span class="math inline">\((\beta^\alpha_0, \beta_{S}^{\alpha, s = \text{M}})\)</span></td>
<td>Latent</td>
<td>2</td>
<td><span class="math inline">\(\mathbb{R}^2\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>beta_lambda</code></td>
<td><span class="math inline">\((\beta_0^\lambda, \beta_S^{\lambda, s = \text{M}})\)</span></td>
<td>Latent</td>
<td>2</td>
<td><span class="math inline">\(\mathbb{R}^2\)</span></td>
<td></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="even">
<td><code>beta_anc_rho</code></td>
<td><span class="math inline">\(\beta^{\rho^{\text{ANC}}}\)</span></td>
<td>Latent</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>beta_anc_alpha</code></td>
<td><span class="math inline">\(\beta^{\alpha^{\text{ANC}}}\)</span></td>
<td>Latent</td>
<td>1</td>
<td><span class="math inline">\(\mathbb{R}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>u_rho_x</code></td>
<td><span class="math inline">\(\mathbf{w}^\rho_x\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>us_rho_x</code></td>
<td><span class="math inline">\(\mathbf{v}^\rho_x\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>u_rho_xs</code></td>
<td><span class="math inline">\(\mathbf{w}_x^{\rho, s = \text{M}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>us_rho_xs</code></td>
<td><span class="math inline">\(\mathbf{v}_x^{\rho, s = \text{M}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>u_rho_a</code></td>
<td><span class="math inline">\(\mathbf{u}^\rho_a\)</span></td>
<td>Latent</td>
<td>10</td>
<td><span class="math inline">\(\mathbb{R}^{10}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>u_rho_as</code></td>
<td><span class="math inline">\(\mathbf{u}_a^{\rho, s = \text{M}}\)</span></td>
<td>Latent</td>
<td>10</td>
<td><span class="math inline">\(\mathbb{R}^{10}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>u_rho_xa</code></td>
<td><span class="math inline">\(\mathbf{u}_x^{\rho, a &lt; 15}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td>Yes</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>u_alpha_x</code></td>
<td><span class="math inline">\(\mathbf{w}^\alpha_x\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>us_alpha_x</code></td>
<td><span class="math inline">\(\mathbf{v}^\alpha_x\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>u_alpha_xs</code></td>
<td><span class="math inline">\(\mathbf{w}_x^{\alpha, s = \text{M}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>us_alpha_xs</code></td>
<td><span class="math inline">\(\mathbf{v}_x^{\alpha, s = \text{M}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>u_alpha_a</code></td>
<td><span class="math inline">\(\mathbf{u}^\alpha_a\)</span></td>
<td>Latent</td>
<td>13</td>
<td><span class="math inline">\(\mathbb{R}^{13}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>u_alpha_as</code></td>
<td><span class="math inline">\(\mathbf{u}_a^{\alpha, s = \text{M}}\)</span></td>
<td>Latent</td>
<td>10</td>
<td><span class="math inline">\(\mathbb{R}^{10}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>u_alpha_xa</code></td>
<td><span class="math inline">\(\mathbf{u}_x^{\alpha, a &lt; 15}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>ui_lambda_x</code></td>
<td><span class="math inline">\(\mathbf{u}_x^\lambda\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td></td>
<td>Yes</td>
</tr>
<tr class="odd">
<td><code>ui_anc_rho_x</code></td>
<td><span class="math inline">\(\mathbf{u}_x^{\rho^{\text{ANC}}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td><code>ui_anc_alpha_x</code></td>
<td><span class="math inline">\(\mathbf{u}_x^{\alpha^{\text{ANC}}}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td><code>log_or_gamma</code></td>
<td><span class="math inline">\(\mathbf{u}_x^{\tilde \gamma}\)</span></td>
<td>Latent</td>
<td><span class="math inline">\(n\)</span></td>
<td><span class="math inline">\(\mathbb{R}^{n}\)</span></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="model-assessment-1" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">C.3</span> Model assessment<a href="fast-approximate-bayesian-inference.html#model-assessment-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="aghq-and-pca-aghq-details" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">C.4</span> AGHQ and PCA-AGHQ details<a href="fast-approximate-bayesian-inference.html#aghq-and-pca-aghq-details" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="normalising-constant-estimation" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">C.5</span> Normalising constant estimation<a href="fast-approximate-bayesian-inference.html#normalising-constant-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="inference-comparison-1" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">C.6</span> Inference comparison<a href="fast-approximate-bayesian-inference.html#inference-comparison-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="mcmc-convergence-and-suitability" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">C.7</span> MCMC convergence and suitability<a href="fast-approximate-bayesian-inference.html#mcmc-convergence-and-suitability" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="figure" style="text-align: centre"><span style="display:block;" id="fig:rhat"></span>
<img src="resources/naomi-aghq/20230811-095752-5b8181d8/depends/rhat.png" alt="The potential scale reduction factor compares between- and within- estimates of univariate parameters. It is recommended only to use NUTS results if the value is less than 1.05, which it is for all parameters." width="95%" />
<p class="caption">
Figure C.1: The potential scale reduction factor compares between- and within- estimates of univariate parameters. It is recommended only to use NUTS results if the value is less than 1.05, which it is for all parameters.
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-eaton2021naomi" class="csl-entry">
Eaton, Jeffrey W, Laura Dwyer-Lindgren, Steve Gutreuter, Megan O’Driscoll, Oliver Stevens, Sumali Bajaj, Rob Ashton, et al. 2021. <span>“Naomi: A New Modelling Tool for Estimating HIV Epidemic Indicators at the District Level in Sub-Saharan Africa.”</span>
</div>
<div id="ref-tmbdocumentation" class="csl-entry">
Kristensen, Kasper. 2021. <span>“The Comprehensive TMB Documentation.”</span> <a href="https://kaskr.github.io/adcomp/_book/Introduction.html" class="uri">https://kaskr.github.io/adcomp/_book/Introduction.html</a>.
</div>
<div id="ref-stover2019updates" class="csl-entry">
Stover, John, Robert Glaubius, Lynne Mofenson, Caitlin M Dugdale, Mary-Ann Davies, Gabriela Patten, and Constantin Yiannoutsos. 2019. <span>“Updates to the Spectrum/AIM Model for Estimating Key HIV Indicators at National and Subnational Levels.”</span> <em>AIDS (London, England)</em> 33 (Suppl 3): S227.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-model-for-risk-group-proportions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ulyngs/oxforddown/tree/master/92-appendixC.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
