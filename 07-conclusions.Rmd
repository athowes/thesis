---
#########################################
# options for knitting a single chapter #
#########################################
output:
  bookdown::pdf_document2:
    template: templates/brief_template.tex
    citation_package: biblatex
  bookdown::html_document2: default
  bookdown::word_document2: default
documentclass: book
bibliography: references.bib
---

# Conclusions {#conclusions}
\adjustmtc
\markboth{Conclusions}{}
<!-- For PDF output, include these two LaTeX commands after unnumbered chapter headings, otherwise the mini table of contents and the running header will show the previous chapter -->

<!-- JWE: Minor corrections often involve (1) fixing typos, (2) clarifying things, (3) elaborating on the contributions to science and implications of the PhD in the conclusions chapter [by far the most common point of examiner feedback] -->

This chapter concludes the thesis by discussing the most important contributions, limitations, promising avenues for future work, and broader reflections about the work.

## Contributions

Chapter \@ref(beyond-borders) used tools for model assessment such as proper scoring rules and posterior predictive checks to comprehensively compare adjacency- and kernel-based models for spatial structure.
The experiments conducted provide useful data to guide the use of spatial random effect models by applied practitioners, as well as to base methodological developments on.
The most important findings were as follows.

(ref:global-update) Panel A shows the front page of @unaids2023global. Panel B shows the page containing text and a figure based on the work done in Chapter \@ref(multi-agyw). In this figure, 30 countries are included.

```{r global-update, fig.cap="(ref:global-update)"}
knitr::include_graphics("figures/conclusions/global-update.png")
```

Chapter \@ref(multi-agyw) estimated HIV risk group proportions for AGYW to enable implementation of the Global AIDS strategy [@unaids2021global].
Risk group proportion estimates were used to disaggregate HIV prevalence and incidence estimates by behaviour, and assess the benefits of a variety of risk stratification strategies.
This work forms the basis for a tool used to prioritise delivery of HIV prevention services by countries in SSA.
At least 30 countries have now been included in the tool, extending from the 13 initially included [Figure \@ref(fig:global-update); @unaids2023global].
The models informing the tool will be rerun each year with updated data as a part of UNAIDS annual HIV estimates process.
Alongside these applied contributions, Chapter \@ref(multi-agyw) exemplified specification of complex multinomial spatio-temporal models in `R-INLA` using the Poisson-multinomial transformation, including using two- and three-way Kronecker product interactions.

Chapter \@ref(naomi-aghq) developed deterministic Bayesian inference methods, motivated by a challenging and practically important problem in evidence synthesis for small-area estimation of HIV indicators.
Its most important contributions are two-fold.
First, an implementation of INLA which is compatible with models specified using a `TMB` C++ template.
Notably, this contribution enables practitioners to fit essentially any model using INLA for the first time.
Second, a quadrature rule which naturally extends the applicability of INLA methods to moderate hyperparameter dimension, by combining PCA and AGHQ.

## Limitations

The work done in this thesis, particularly Chapters \@ref(beyond-borders) and \@ref(naomi-aghq), focused on producing empirical evidence experimentally.
In part, this approach reflects the complexity of the models and methods used in this thesis.
Understanding complex systems from a theoretical perspective can be challenging.
That being said, much of the work done in this thesis would benefit from closer integration with statistical theory.
Though end-to-end theoretical understanding is overly hopeful, significant advantages could come from better understanding of limiting cases, simplified versions, and components of complete procedures.

In working most tangibly with real world data, Chapter \@ref(multi-agyw) inherits a wide range of limitations.
To highlight a few:
the external validity of risk ratios derived from cohort studies.

## Future work

Promising avenues for future work that I would prioritise include:

1. Although AGYW are disproportionately at risk of HIV infection, 56% of new infections in SSA occur in other demographic groups.
As such, it would be valuable to extend the risk group model developed in Chapter \@ref(multi-agyw), and the derived prioritisation tool, to include all adults 15-49.
This might involve modelling of age-stratified sexual partnerships [@wolock2021evaluating].
Such a model would likely fall out of the scope of `R-INLA`, but would be possible to write with `TMB` and therefore amenable to the inference methods advanced in Chapter \@ref(naomi-aghq).

2. Practical use of the INLA implementation developed in Chapter \@ref(naomi-aghq) would benefit significantly from improvements to its speed and usability.
The most important speed enhancement would likely come from using the simplified approximation to the Laplace marginals developed by @wood2020simplified.
Usability would be improved by integration of the method into statistical software, first and foremost via the `aghq` package.
The primary difficulty, as it appears now, which would have to be overcome is that the `random` argument of `TMB::MakeADFun` does not allow indexing.

(ref:conditional-simulation-diff-k-fixed) For the Loa loa ELGM, increasing the number of quadrature nodes per hyperparameter dimension from $k = 3$ to $k = 7$ did little to improve accuracy. On the other hand, using Laplace marginals rather than Gaussian marginals did have a substantial effect (Figures \@ref(fig:conditional-simulation-phi-diff-fixed) and \@ref(fig:conditional-simulation-rho-diff-fixed)). More broadly, it would be valuable to better understand, and aspirationally have diagnostics for, the circumstances under which more accurate approximations are required.

```{r conditional-simulation-diff-k-fixed, fig.cap="(ref:conditional-simulation-diff-k-fixed)"}
knitr::include_graphics("figures/naomi-aghq/conditional-simulation-diff-k-fixed.png")
```

3. The universal INLA implementation developed in Chapter \@ref(naomi-aghq) enables methodological research.
For example, INLA-like methods can now be tested for a broader class of models, such as the Loa loa and Naomi ELGMs (Sections \@ref(loaloa) and \@ref(malawi)).
This type of research benefits greatly from a single `TMB` C++ template for the log-posterior supporting inference using multiple methods, including gold-standard NUTS via `tmbstan`.

    Within this broader class of models, I wonder about the best way to achieve accurate results given a certain computational budget.
    How should computational effort be traded-off between additional hyperparameter grid points and more accurate latent field approximations?
    For example, for the Loa loa ELGM, the accuracy benefit of using Laplace marginals was more than using a higher number of AGHQ nodes per dimension (Figure \@ref(fig:conditional-simulation-diff-k-fixed)).

    Additionally, theoretical work could be conducted to complement the empirical work described above, extending the findings of @bilodeau2022stochastic.
    This work is benefited by the exhaustive specification of the INLA-like algorithms used in this thesis.

## Broader reflections

Conducting the work in this thesis involved testing the boundaries of available statistical software.
For example, I found it challenging, if not impossible, to implement a common model using different inferential software.
As the frequently asked questions section of the `R-INLA` website [@rinla2023faq] notes: "the devil is in the details".
Similarly, I encountered issues implementing a desired collection of different models in a common inferential software.
From personal experience, my colleagues have also encountered similar problems.
If not addressed, these difficulties would result in conflation of statistical models and inference methodologies, limiting the validity of any findings.
Ultimately, I resolved these issues by implementing all models in Chapters \@ref(beyond-borders) and \@ref(naomi-aghq) using `TMB` model templates.
(Additionally, I would recommend implementing the model used in Chapter \@ref(multi-agyw) in `TMB` for future development.)
Alongside being sufficiently flexible to meet my model specification requirements, `TMB` is compatible with a range of inference methodologies, including those advanced in this thesis.
As such, `TMB` remains [@osgood2023statistical] an under-rated statistical tool.
In demonstrating some of its capabilities, I hope this thesis contributes to its wider adoption.

There are both direct and indirect paths to impact for the work in this thesis.
Directly, the methodological contributions of Chapters \@ref(beyond-borders) and \@ref(naomi-aghq) may eventually lead to marginally more accurate indicator estimates, contributing to a broadly more effective response.
However, these improvements in accuracy seem of minor consequence within the broader context of the HIV response, and factors limiting its effectiveness.
The applied contributions of Chapter \@ref(multi-agyw) have a more promising case for direct impact, and indeed I have seen evidence of engagement with the work by decision makers.

To the best of my abilities, this thesis, and the work described within it, was written in keeping with the principles of open science.
I hope that having done so facilitates my work to be scrutinised, and more optimistically, built upon.
In part this hope has already been realised, as with limited input from me, Dr. Kathryn Risher was able to extend my code for Chapter \@ref(multi-agyw) to include additional countries (Panel \@ref(fig:global-update)B).
This would not have been possible without tools from the R ecosystem such as `rmarkdown` and `rticles` for reporting, `devtools` for R package development, as well as those written by software engineers within the MRC Centre for Global Infectious Disease Analysis such as `orderly` and `didehpc`.
It is crucial that academia adjusts to appropriately incentivises software contributions, and encourages adaption of open science best practices.
Work done to inform public health decision making should be held to high standards of transparency, reproducibility and collaboration.
Especially so in an outbreak response scenario, where time is limited and decisions may be of significant consequence.

<!-- Aims for HIV response going forward, and the surveillance capabilities needed to meet them. -->
<!-- Greater reliance on routine health system data. -->
<!-- It is not recommended to include HIV testing in nationally representative household surveys in low (<2%) HIV prevalence settings [@world2005guidelines]. -->
<!-- Patient-level HIV data systems [@world2017consolidated] and case-based surveillance (CBS). -->
<!-- Integration of HIV services with other health programs and strengthening of health systems. -->
